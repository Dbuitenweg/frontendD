_stTracker.insertTags({"tags":[{"markerCondition":"[]","selector":"head","id":1023,"version":7,"content":"(function() {\n    window.DAS = window.DAS || {};\n    window.DAS.errors = window.DAS.errors || [];\n})();\n"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1138,"version":21,"content":"(function() {\n\tif (typeof(sessionStorage) !== \"undefined\" && (window.location.href.indexOf('embed.klm.com') !== -1) && (window.location.href.indexOf('/search/advanced') !== -1 || (window.location.href.indexOf('/search/open-date') !== -1 && window.location.href.indexOf('flow=open-dates') !== -1))) {\n\t\tsessionStorage.setItem('z_parent_application', _st.data.getProperty(\"z_parent_application\"));\n\t} else if (typeof(sessionStorage) !== \"undefined\" && _st.data.getProperty(\"z_application\") && _st.data.getProperty(\"z_application\").toLowerCase() === \"search\" && window.location.href.indexOf('embed.klm.com') === -1 ) {\n\t\tsessionStorage.removeItem('z_parent_application');\n\t}\n})();\n        ","group":1},{"markerCondition":"[]","selector":"head","id":1199,"version":56,"content":"(function() {\n    // Set default country and language for the case where z_lang or z_country is not available on the page. \n    var brand = 'KL';\n    var language = 'EN';\n    var country = 'NL';\n    country = _st.data.getProperty('z_country') || _st.data.getProperty('country');\n    language = _st.data.getProperty('z_language') || _st.data.getProperty('language');\n    \n    var app_clientID = [\n            'dj2pn954nny34g93w5u3m3ev', //Android ITE1\n            'dj2p****************m3ev', //Android ITE1\n            //'n2v4cge35u589hsbs2afxbhs', //WEB UTE1\n            //'n2v4****************xbhs', //WEB UTE1\n            'nfuf9p2s6wm3cgh4xnyw6pw2', //Android UTE1\n            'nfuf****************6pw2', //Android UTE1  \n            'cqa6m89ns2nufddbqgg9737s', //Android UTE1\n            'cqa6****************737s', //Android UTE1\n            'cvt9ezsd7n7b2n6qbz83czzw', //Android UTE2\n            'cvt9****************czzw', //Android UTE2\n            'n7anb953xmqvfvercad4evtf', //Android UTE3\n            'n7an****************evtf', //Android UTE3\n            '6hqrts4uwhq5unrsfrjh2kus', //Android UTE3\n            '4u4cm6vec593385qfqpk9ajh', //LE\n            'q2cbejvwc4zcsxzq9qkj4tv7', //LE\n            'q2cb****************4tv7', //LE\n            //'4pm9rktn3a689dy6593r29vr', //Web LE\n            //'4pm9****************29vr', //Web LE\n            //'wp28ebtwdtp74wdtc9gfsjmv', //Web UTE3\n            //'wp28****************sjmv', //Web UTE3\n            '7h7cgfa9qdr5d9hw9jcwrzjc', //iOS UTE1\n            '7h7c****************rzjc', //iOS UTE1\n            'd8bmwu4c4htw9gqehdtg4rpk', //iOS UTE2\n            'd8bm****************4rpk', //iOS UTE2\n            'vuv6****************qnge', //iOS UTE2\n            '72xk3fxvenybcm4hkvrv38r3', //iOS UTE3\n            '72xk****************38r3', //iOS UTE3\n            'pq94bkm87y78s9xq2frrwbgp', //iOS APP Prod\n            'pq94****************wbgp', //iOS APP Prod\n            'w53y7kv97nbcdmgmkr9watkj', //iOS APP Prod\n            'w53y****************atkj', //iOS APP Prod\n        ];\n    if (app_clientID.indexOf(_st.data.getProperty('z_client_id')) === -1 ) {\n        if(!window.uses_own_tracking_banner && !document.getElementById('cookie-banner-script')) {\n            _st.inject.script('https://www.static-kl.com/assets/cookie-banner/cookie-banner.js', {\n                        id: 'cookie-banner-script',\n                        callback: function () {\n                            window.BWCookieBanner.setup(brand, language, country);\n                            window.BWCookieBanner.openAutomatically();\n                            //window.BWCookieBanner.openManually();\n                        }\n            });\n        }\n    } else { //For KLM iOS app\n            _st.cookiepermission.setCookiePreferences({1: true, 2: false, 3: false});\n    }\n\n})();\n"},{"markerCondition":"[]","selector":"head","id":1258,"version":27,"content":"(function() {\n    // DAS test property Tracker\n    var measurementID = 'G-FVF23K8M17';\n    var removeProperties = ['z_tracking', 'z_conversion_rates', 'tms_converted_to_euros'];\n\n    // Initialize Custom Error Tracking for DAS Tags\n    var sendErrorsToGa = function sendErrorsToGa(tagName, error, origin) {\n\n        var payload;\n        if (error && error.name && error.message) {\n            payload = error.name + \": \" + error.message;\n        } else if (typeof error !== 'string') {\n            payload = JSON.stringify(error);\n        } else {\n            payload = error;\n        }\n\t\t\n\t\tif(!tagName) {\n\t\t\ttagName = 'Unknown Tag';\n\t\t}\n\n        var errorDataLayer = getDataLayer(tagName, payload, origin);\n        var dataToSend = removeProperty(errorDataLayer);        \n\n        //Call GA4 error\n        window.gtag('event', 'blueweb_error', dataToSend);\n        callDasQmonAPI(dataToSend);\n    };\n\n\n    var removeProperty = function(data) {\n        var result = {};\n        for (var key in data) {\n            var propertyValue = data[key];\n            if (removeProperties.indexOf(key) === -1) {\n                result[key] = propertyValue;\n            }\n        }\n        return result;\n    };\n\n    var callDasQmonAPI = function(dataToSend) {\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", \"https://dynamic.dimml.io/_/prod!87Rt6wSw@das.klm.com.qa/data?dimml.concept=/DataAPI___das_blueweb\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json; charset=UTF-8\");\n        var body = JSON.stringify({\n            queue: '___das_blueweb',\n            event: 'blueweb_error',\n            element: dataToSend,\n            url: location.href,\n        });\n        xhr.send(body);\n    };\n\n\n    var getDataLayer = function(tagName, payload, origin) {\n        var data = {\n            event_category: 'Error',\n            send_to: measurementID,\n        };\n        _st.util.extend(data, errorTagging(tagName, origin, payload));\n        _st.util.extend(data, _st.data._localTagProperties);\n        _st.util.extend(data, _st.data._tagProperties);\n        return data;\n    };\n\n    var errorTagging = function(tagName, origin, payload) {\n        return {\n            event_action: tagName,\n            error_origin: origin,\n            event_label: payload\n        };\n    };\n\n\n    window.DAS.errors.push = function() {\n        var items = Array.prototype.slice.call(arguments);\n        items.forEach(function(item) {\n            if (Array.isArray(item)) {\n                sendErrorsToGa(item[0], item[1], item[2]);\n            } else {\n                DAS.errors.push([tagName, 'Expected Array input, but received ' + typeof item + ' input in DAS.errors array']);\n            }\n        });\n        return Array.prototype.push.apply(this, arguments);\n    };\n\n    if (!window.DAS.errorInit) {\n        window.DAS.errorInit = true;\n        window.DAS.errors.forEach(function(item) {\n            if (Array.isArray(item)) {\n                sendErrorsToGa(item[0], item[1], item[2]);\n            }\n        });\n    }\n})();"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1281,"version":2,"content":"(function() {\n\t\n\t//Please make sure to add the commented code below to your basescript prepend (for this you can contact support@relay42.com)\n\t\n\t/*\n\t_stq.unshift(['addInitCallback', function() {\n\t\tvar svtri = _st.util.getCookie(_st.tracking._idCookieName);\n\t\tvar cookie = _st.util.getCookie('klm_id');\n\t\t_st.debug.log('svtri value on addInitCallback:' + svtri);\n\t\t_st.debug.log('server cookie value on addInitCallback:' + cookie);\n\n\n\t\tif(cookie === '' || typeof cookie == 'undefined' || cookie.length != 36){\n\t\t\t//throw 'cookie not valid:' + cookie;\n\t\t} else if(svtri === '' || typeof svtri === 'undefined' || svtri === undefined || svtri === 'undefined' || !svtri){\n\t\t\t_st.tracking._forwardedIdentifier = cookie;\n\t\t} else if(svtri != cookie){\n\t\t\t//_st.tracking.storeMapping(42,cookie);\n\t\t} else if(svtri == cookie){\n\t\t\t//do nothing, situation desired.\n\t\t}\n\t}]);\n\t*/\n\t\n\tvar svtri = _st.tracking.getUserIdentifier();\n\tvar cookie = _st.util.getCookie('klm_id');\n\t_st.debug.log('svtri :' + svtri);\n\t_st.debug.log('cookie :' + cookie);\n\t\n\tif(cookie === '' || typeof cookie == 'undefined' || cookie.length != 36){\n\t\tthrow 'cookie not valid:' + cookie;\n\t} else if(svtri === '' || typeof svtri === 'undefined' || svtri === undefined || svtri === 'undefined' || !svtri){\n\t\tthrow 'svtri not valid :' + svtri;\n\t} else if(svtri != cookie){\n\t\t_st.tracking.storeMapping(42,cookie);\n\t} else if(svtri == cookie){\n\t\t//do nothing, situation desired.\n\t}\n})();\n","group":3},{"markerCondition":"[]","selector":"head","id":1317,"version":34,"content":"window.dataLayer = window.dataLayer || [];\nfunction gtag(){dataLayer.push(arguments);}\n(function(){\n\tvar pref = _st.cookiepermission.getCookiePreferences();\n\tvar ad_storage = 'denied';\n\tvar ad_user_data = 'denied';\n  \tvar ad_personalization = 'denied';\n  \tvar analytics_storage = 'denied';\n\tif (pref[1] == true) {\n  \t\tanalytics_storage = 'granted';\n\t}\n\tif (pref[2] == true) {\n  \t\tanalytics_storage = 'granted';\n\t}\n\tif (pref[3] == true) {\n\t\tad_storage = 'granted';\n\t\tad_user_data = 'granted';\n  \t\tad_personalization = 'granted';\n  \t\tanalytics_storage = 'granted';\n\t}\n\tgtag('consent', 'default', {\n\t\t'ad_storage': ad_storage,\n\t\t'ad_user_data': ad_user_data,\n\t\t'ad_personalization': ad_personalization,\n\t\t'analytics_storage': analytics_storage\n\t});\n\t_st.debug.log('executed gtag consent default: ' + ad_storage + ad_user_data + ad_personalization + analytics_storage);\n})();"},{"markerCondition":"[]","selector":"head","id":203,"version":13,"content":"(function(){var e=function(){try{return(c=_st.util.decodeJson(decodeURIComponent(window.localStorage.r42CustomMarkers)))||{}}catch(a){return{}}},k=function(a){try{window.localStorage.r42CustomMarkers=encodeURIComponent(_st.util.encodeJson(a))}catch(b){}};_st.data.setCustomMarker=function(a,b,d){if(window.localStorage){var f=e();f[a]=f[a]||{};f[a][b]=d;k(f)}else _st.data.setMarker(a,b,d)};_st.data.getCustomMarker=function(a,b){return window.localStorage?(markerGroup=e()[a]||{},markerGroup[b]):_st.data.getMarker(a,\nb)};_st.data.removeCustomMarker=function(a,b){if(window.localStorage){var d=e();markerGroup=d[a]||{};delete markerGroup[b];k(d)}else return _st.data.removeMarker(a,b)};var l,g;try{var c=e();var m=(new Date).getTime();if(c){for(l in c)if(c.hasOwnProperty(l)){var h=c[l];for(g in h)h.hasOwnProperty(g)&&h[g]<m&&delete h[g]}k(c)}}catch(a){}})();"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":722,"version":85,"content":"_st.inject.script(\"//www.googletagmanager.com/gtag/js?id=AW-980474582\", { callback: function() {\n        window.dataLayer = window.dataLayer || [];\n        window.gtag = function () {\n            window.dataLayer.push(arguments);\n        };\n        window.gtag(\"js\", new Date());\n        window.gtag('config', 'AW-980474582');\n        window.gtag('config', 'AW-1068849169');\n        window.gtag('config', 'DC-5165512');\n        window.gtag('config', 'DC-4232724');\n    }\n});\nsetTimeout(function(){ _st('publishEvent', 'gtm_configured', '', ''); }, 2000);\n","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":916,"version":298,"content":"(function () {\n    'use strict';\n    var tagName = 'DAS -  Euro conversion';\n\n    /**\n     * Helper Functions\n     */\n    function getParamValue(param, data) {\n        return data[param] || '';\n    }\n\n    function getCurrentDataLayer() {\n        var util = _st.util;\n        var data = _st.data;\n        return util.extend(util.extend({}, data._localTagProperties), data._tagProperties);\n    }\n\n    function isConversionRequired(currency) {\n        return currency && !String(currency).match(/^(eur|miles)$/i);\n    }\n\n    function isEmptyObject(obj) {\n        return Object.keys(obj).length === 0 && obj.constructor === Object;\n    }\n\n    /**\n     * Fetch conversion rate from 'z_conversion_rates' object for the\n     * currency provided as argument.\n     */\n    function getConversionRateFor(currency) {\n        var currencyLower = currency.toLowerCase();\n        var conversionKey = 'common.shared.conversion_rate.to_eur.' + currencyLower;\n        var conversionRates = _st.data.getProperty('z_conversion_rates');\n\n        if (conversionRates && !isEmptyObject(conversionRates)) {\n            if (!conversionRates[conversionKey] && currencyLower !== 'miles') {\n                DAS.errors.push([tagName, {\n                    name: 'Conversion Rate not found',\n                    message: 'Conversion Key is:' + conversionKey + ';Conversion Rate is:' + JSON.stringify(conversionRates[conversionKey])\n                }, 'ga3']);\n            }\n\n            _st.data.setProperty('tms_conversion_rate_selected', conversionRates[conversionKey]);\n            return conversionRates[conversionKey];\n        }\n        return 1;\n    }\n\n    /**\n     * When conversion is required Convert the given amount\n     * using the conversion rate for the given currency.\n     */\n    function convertInEuros(amount, currency) {\n        if (!isConversionRequired(currency)) {\n            return amount;\n        }\n\n        return Number((getConversionRateFor(currency) * Number(amount)).toFixed(2));\n    }\n\n    /**\n     * Get ancillary cart data from session storage\n     * If it exists return a simplified Array with the relevant data\n     */\n    function getStoredAncProducts() {\n        var ancProductData;\n        try {\n            ancProductData = JSON.parse(sessionStorage.getItem('bwc-AncillariesShoppingCart'));\n        } catch (e) {\n            DAS.errors.push([tagName, e, 'ga3']);\n        }\n\n        if (ancProductData) {\n            if (Array.isArray(ancProductData.cartProducts)) {\n                ancProductData = ancProductData.cartProducts.map(function mapProducts(product) {\n                    if (product.sku && product.displayPrice && product.displayPrice.currencyCode) {\n                        return {\n                            sku: product.sku,\n                            currency: product.displayPrice.currencyCode\n                        };\n                    }\n\n                    return {\n                        sku: undefined,\n                        currency: undefined\n                    };\n                });\n            }\n        }\n\n        return ancProductData;\n    }\n\n    /**\n     * Special Conversion function for 'tx_s' parameter. This is because\n     * for some ancillaries products we need to check the currency in the\n     * 'ancillaries shopping cart' in session Storage. When the currency in\n     * that object is different form the currency provided through the MI layer, we\n     * need to use the currency in the sessionStorage object. [DAS-1078]\n     */\n    function handleBookingTxs(txsValue, currency, products) {\n        var storedAncillaryProducts = getStoredAncProducts();\n        var matchingAncillaryProduct;\n        return txsValue.split(';').map(function (value, index) {\n            if (storedAncillaryProducts && Array.isArray(storedAncillaryProducts)) {\n                matchingAncillaryProduct = storedAncillaryProducts.filter(function (p) {\n                    return p.sku === products.split(';')[index];\n                })[0];\n                if (matchingAncillaryProduct && matchingAncillaryProduct.currencyCode && matchingAncillaryProduct.currencyCode !== currency) {\n                    return convertInEuros(value, matchingAncillaryProduct.currencyCode);\n                }\n            }\n            return convertInEuros(value, currency);\n        }).join(';');\n    }\n    /**\n    * Special Conversion function for 'z_voucher' parameter. This is because\n    * for vouchers we can have a different conversion currency for each voucher value\n    * Eg: z_evouchervalue : 102.83;102.83\n    * z_evoucherused : 118.26;118.26\n    * z_evouchercurrency : EUR;EUR\n    */\n    function handleVoucher(voucherValue, currency) {\n        // create a new method to get sum of total value used and total value and append it to the data layer (check add tms addition to data layer)\n        return voucherValue.split(';').map(function (value, index) {\n            return convertInEuros(value, currency.split(';')[index]);\n        }).join(';');\n    }\n\n    /**\n     * Handle  (semi-colon seperated) string monetary parameters by splitting on ';'\n     * and converting the individual values. A specific function is used for tx_s [DAS-1078].\n     */\n    function handleStringParameters(param, stringValue, currency, data) {\n        if (param === 'tx_s' && getParamValue('z_flow_name', data) === 'booking') {\n            return handleBookingTxs(stringValue, currency, getParamValue('pn_sku', data));\n        }\n        if (param === 'z_evouchervalue' || param === 'z_evoucherused') {\n            currency = getParamValue('z_evouchercurrency', data);\n            return handleVoucher(stringValue, currency);\n        }\n        return stringValue.split(';').map(function (value) {\n            return convertInEuros(value, currency);\n        }).join(';');\n    }\n\n    /**\n     * Convert monetary parameters present in the given data Object.\n     */\n    function convertMonetaryParams(data) {\n        var convertedValues = {};\n        var monetaryParameters = DAS.euroConversion.getMonetaryParams();\n\n        monetaryParameters.forEach(function (monetaryParam) {\n            var monetaryValue = getParamValue(monetaryParam, data);\n            var currency = getParamValue('z_currency', data);\n\n            // Handle 0 or '0' or 0;0 values\n            if (!String(monetaryValue).match('[^0;]+') && String(monetaryValue).length > 0) {\n                convertedValues[monetaryParam] = monetaryValue;\n\n                // Handle missing Currency\n            } else if (monetaryValue && !currency) {\n                convertedValues[monetaryParam] = 0; //[DAS-774]\n                DAS.errors.push([tagName, 'Currency missing while trying to convert ' + monetaryParam + ':' + monetaryValue, 'ga3']);\n\n                // Convert Number values\n            } else if (monetaryValue && typeof monetaryValue === 'number') {\n                var milesParams = [\"z_pnr_total_value\", \"z_pnr_sales_value\"];\n                var isMilesParam = milesParams.indexOf(monetaryParam) !== -1;\n                if ((monetaryParam.indexOf('z_pnr_sales_value') !== -1 && monetaryValue < 0) || (String(currency).toLowerCase() === 'miles' && isMilesParam)) {\n                    if (monetaryParam === 'z_pnr_total_value') {\n                        _st.data.setProperty('tms_value_in_miles', monetaryValue);\n                    }\n                    convertedValues[monetaryParam] = 0; // [DAS-744]\n                } else {\n                    convertedValues[monetaryParam] = convertInEuros(monetaryValue, currency);\n                }\n\n                // Convert string values\n            } else if (monetaryValue && typeof monetaryValue === 'string') {\n                convertedValues[monetaryParam] = handleStringParameters(monetaryParam, monetaryValue, currency, data);\n            }\n        });\n        // Create tms voucher variables for voucher string values\n        createTmsTotalVoucherParams(convertedValues);\n        return convertedValues;\n    }\n\n    function createTmsTotalVoucherParams(convertedValues) {\n        if (convertedValues.z_evouchervalue) {\n            var tms_evouchertotalvalue = convertedValues.z_evouchervalue.toString().split(';').reduce(function (value, result) {\n            return Number((Number(result) + Number(value)).toFixed(2));\n            });\n            _st.data.setProperty('tms_evouchertotalvalue', tms_evouchertotalvalue);\n        }\n        if (convertedValues.z_evoucherused) {\n            var tms_evouchertotalused = convertedValues.z_evoucherused.toString().split(';').reduce(function (value, result) {\n                return Number((Number(result) + Number(value)).toFixed(2));\n            });\n            if (convertedValues.z_evoucherremaining) {\n                tms_evouchertotalused = tms_evouchertotalused - Number(convertedValues.z_evoucherremaining);\n            }\n            _st.data.setProperty('tms_evouchertotalused', tms_evouchertotalused);\n        }\n    }\n\n    /**\n     * Function to create 'Net Traffic Revenue' in euros\n     * based on z_base_fare & z_carrier_surcharge\n     */\n    function createNetTrafficRevenue(convertedValues) {\n        var baseFare = convertedValues.z_base_fare || 0;\n        var carrierSurcharge = convertedValues.z_carrier_surcharge || 0;\n\n        return (Number(baseFare) + Number(carrierSurcharge)).toFixed(2);\n    }\n\n    /**\n     * Function to create 'Net Traffic Revenue' in local currency\n     * based on z_base_fare & z_carrier_surcharge\n     */\n    function createNetTrafficRevenueLocal() {\n        var baseFare = _st.data.getProperty('z_base_fare') || 0;\n        var carrierSurcharge = _st.data.getProperty('z_carrier_surcharge') || 0;\n\n        return (Number(baseFare) + Number(carrierSurcharge)).toFixed(2);\n    }\n\n    window.DAS.euroConversion = window.DAS.euroConversion || {};\n\n    /**\n     * Return list of monetary parameters that need to be converted.\n     */\n    DAS.euroConversion.getMonetaryParams = function getMonetaryParams() {\n        return [\n            'tx_s',\n            'z_tax',\n            'z_base_fare',\n            'z_booking_fee',\n            'z_pnr_total_value',\n            'z_pnr_sales_value',\n            'z_carrier_surcharge',\n            'z_impr_price',\n            'z_evouchervalue',\n            'z_evoucherused',\n            'z_evoucherremaining',\n            'z_fare_accuracy',\n            'z_outbound_flight_value',\n            'z_inbound_flight_value',\n            'z_cash_amount'\n        ];\n    };\n\n    /**\n     * Add a new object to the dataLayer which contains the converted values\n     * for the monetary parameters in the given data object. If no data object is\n     * provided, the current existing dataLayer will be used as default input.\n     */\n    DAS.euroConversion.addConvertedValueToDataLayer = function addConvertedValueToDataLayer(data) {\n        var sourceData = data || getCurrentDataLayer();\n\n        var convertedValues = convertMonetaryParams(sourceData);\n        var existingConvertedData = _st.data.getProperty('tms_converted_to_euros');\n        var currency = getParamValue('z_currency', sourceData);\n\n        // If not empty we add converted values to the data layer.\n        if (!isEmptyObject(convertedValues)) {\n            // Set used exchanged rate if currency exists\n            convertedValues.z_exchange_rate = currency ? getConversionRateFor(currency) : undefined;\n\n            // Set net traffic revenue parameters\n            convertedValues.tms_net_traffic_revenue = createNetTrafficRevenue(convertedValues);\n            _st.data.setProperty('tms_net_traffic_revenue_local', createNetTrafficRevenueLocal());\n\n            // Set object with converted values\n            _st.data.setProperty('tms_converted_to_euros', convertedValues);\n\n            // if there are no new converted values added remove the 'net traffic revenue' parameters\n        } else if (_st.data.getProperty('tms_converted_to_euros')) {\n            if (_st.data.getProperty('tms_converted_to_euros').tms_net_traffic_revenue) {\n                existingConvertedData.tms_net_traffic_revenue = undefined;\n                _st.data.setProperty('tms_net_traffic_revenue_local', undefined);\n                _st.data.setProperty('tms_converted_to_euros', existingConvertedData);\n            }\n        }\n    };\n\n    try {\n        DAS.convertMonetaryParams = convertMonetaryParams;\n        /*\n        * 'bw' Check is required as for KL Login the z_converged is passed as a local property\n        * so the Relay condition on remote properties is not effective enough on its own.\n        */\n        if (_st.data.getProperty('z_converged').toLowerCase() === 'bw') {\n            DAS.euroConversion.addConvertedValueToDataLayer();\n        }\n    } catch (e) {\n        DAS.errors.push([tagName, e, 'ga3']);\n    }\n}());\n","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1156,"version":14,"content":"(function () {\n\t_st.event.subscribe('', '', function (category, name, data) {\n\t\tif (data.ti && (data.ti.indexOf('.searchbox') !== -1 || data.ti.toLowerCase() == 'doct.landingpage')){\n\t\t\tif (typeof (sessionStorage) !== \"undefined\" && data.z_login === 1 && data.z_contract_name) {\n\t\t\t\tsessionStorage.setItem('tms_bts_contract_name', data.z_contract_name);\n\t\t\t}\n\t\t}\n\t});\n\t//Remove teh bts_contract_name in case of a logout.\n\tif (_st.data.getProperty('z_login') === 0 && sessionStorage.getItem('tms_bts_contract_name')) {\n\t\tsessionStorage.removeItem('tms_bts_contract_name');\n\t}\n})();","group":1},{"markerCondition":"[]","selector":"head","id":1239,"version":3,"content":"var Sha256={};Sha256.HEX_CHARS=\"0123456789abcdef\".split(\"\"),Sha256.EXTRA=[-2147483648,8388608,32768,128],Sha256.SHIFT=[24,16,8,0],Sha256.K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Sha256.sha224=function(S){return Sha256.sha256(S,!0)},Sha256.sha256=function(S,H){var a=\"string\"!=typeof S,h=[];a&&S.constructor==root.ArrayBuffer&&(S=new Uint8Array(S));var A,C,E,R,X,_,r,o,t,T,e,F,I,f,n,s,c,i,u,v,K,d,l=!0,y=!1,g=0,p=0,w=0,b=S.length;H?(A=3238371032,C=914150663,E=812702999,R=4144912697,X=4290775857,_=1750603025,r=1694076839,o=3204075428):(A=1779033703,C=3144134277,E=1013904242,R=2773480762,X=1359893119,_=2600822924,r=528734635,o=1541459225),t=0;do{if(h[0]=t,h[16]=h[1]=h[2]=h[3]=h[4]=h[5]=h[6]=h[7]=h[8]=h[9]=h[10]=h[11]=h[12]=h[13]=h[14]=h[15]=0,a)for(e=p;b>g&&64>e;++g)h[e>>2]|=S[g]<<Sha256.SHIFT[3&e++];else for(e=p;b>g&&64>e;++g)T=S.charCodeAt(g),128>T?h[e>>2]|=T<<Sha256.SHIFT[3&e++]:2048>T?(h[e>>2]|=(192|T>>6)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|63&T)<<Sha256.SHIFT[3&e++]):55296>T||T>=57344?(h[e>>2]|=(224|T>>12)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|T>>6&63)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|63&T)<<Sha256.SHIFT[3&e++]):(T=65536+((1023&T)<<10|1023&S.charCodeAt(++g)),h[e>>2]|=(240|T>>18)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|T>>12&63)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|T>>6&63)<<Sha256.SHIFT[3&e++],h[e>>2]|=(128|63&T)<<Sha256.SHIFT[3&e++]);w+=e-p,p=e-64,g==b&&(h[e>>2]|=Sha256.EXTRA[3&e],++g),t=h[16],g>b&&56>e&&(h[15]=w<<3,y=!0);var B=A,U=C,j=E,k=R,m=X,q=_,x=r,z=o;for(F=16;64>F;++F)s=h[F-15],I=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,s=h[F-2],f=(s>>>17|s<<15)^(s>>>19|s<<13)^s>>>10,h[F]=h[F-16]+I+h[F-7]+f<<0;for(d=U&j,F=0;64>F;F+=4)l?(H?(u=300032,s=h[0]-1413257819,z=s-150054599<<0,k=s+24177077<<0):(u=704751109,s=h[0]-210244248,z=s-1521486534<<0,k=s+143694565<<0),l=!1):(I=(B>>>2|B<<30)^(B>>>13|B<<19)^(B>>>22|B<<10),f=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7),u=B&U,n=u^B&j^d,i=m&q^~m&x,s=z+f+i+Sha256.K[F]+h[F],c=I+n,z=k+s<<0,k=s+c<<0),I=(k>>>2|k<<30)^(k>>>13|k<<19)^(k>>>22|k<<10),f=(z>>>6|z<<26)^(z>>>11|z<<21)^(z>>>25|z<<7),v=k&B,n=v^k&U^u,i=z&m^~z&q,s=x+f+i+Sha256.K[F+1]+h[F+1],c=I+n,x=j+s<<0,j=s+c<<0,I=(j>>>2|j<<30)^(j>>>13|j<<19)^(j>>>22|j<<10),f=(x>>>6|x<<26)^(x>>>11|x<<21)^(x>>>25|x<<7),K=j&k,n=K^j&B^v,i=x&z^~x&m,s=q+f+i+Sha256.K[F+2]+h[F+2],c=I+n,q=U+s<<0,U=s+c<<0,I=(U>>>2|U<<30)^(U>>>13|U<<19)^(U>>>22|U<<10),f=(q>>>6|q<<26)^(q>>>11|q<<21)^(q>>>25|q<<7),d=U&j,n=d^U&k^K,i=q&x^~q&z,s=m+f+i+Sha256.K[F+3]+h[F+3],c=I+n,m=B+s<<0,B=s+c<<0;A=A+B<<0,C=C+U<<0,E=E+j<<0,R=R+k<<0,X=X+m<<0,_=_+q<<0,r=r+x<<0,o=o+z<<0}while(!y);var D=Sha256.HEX_CHARS[A>>28&15]+Sha256.HEX_CHARS[A>>24&15]+Sha256.HEX_CHARS[A>>20&15]+Sha256.HEX_CHARS[A>>16&15]+Sha256.HEX_CHARS[A>>12&15]+Sha256.HEX_CHARS[A>>8&15]+Sha256.HEX_CHARS[A>>4&15]+Sha256.HEX_CHARS[15&A]+Sha256.HEX_CHARS[C>>28&15]+Sha256.HEX_CHARS[C>>24&15]+Sha256.HEX_CHARS[C>>20&15]+Sha256.HEX_CHARS[C>>16&15]+Sha256.HEX_CHARS[C>>12&15]+Sha256.HEX_CHARS[C>>8&15]+Sha256.HEX_CHARS[C>>4&15]+Sha256.HEX_CHARS[15&C]+Sha256.HEX_CHARS[E>>28&15]+Sha256.HEX_CHARS[E>>24&15]+Sha256.HEX_CHARS[E>>20&15]+Sha256.HEX_CHARS[E>>16&15]+Sha256.HEX_CHARS[E>>12&15]+Sha256.HEX_CHARS[E>>8&15]+Sha256.HEX_CHARS[E>>4&15]+Sha256.HEX_CHARS[15&E]+Sha256.HEX_CHARS[R>>28&15]+Sha256.HEX_CHARS[R>>24&15]+Sha256.HEX_CHARS[R>>20&15]+Sha256.HEX_CHARS[R>>16&15]+Sha256.HEX_CHARS[R>>12&15]+Sha256.HEX_CHARS[R>>8&15]+Sha256.HEX_CHARS[R>>4&15]+Sha256.HEX_CHARS[15&R]+Sha256.HEX_CHARS[X>>28&15]+Sha256.HEX_CHARS[X>>24&15]+Sha256.HEX_CHARS[X>>20&15]+Sha256.HEX_CHARS[X>>16&15]+Sha256.HEX_CHARS[X>>12&15]+Sha256.HEX_CHARS[X>>8&15]+Sha256.HEX_CHARS[X>>4&15]+Sha256.HEX_CHARS[15&X]+Sha256.HEX_CHARS[_>>28&15]+Sha256.HEX_CHARS[_>>24&15]+Sha256.HEX_CHARS[_>>20&15]+Sha256.HEX_CHARS[_>>16&15]+Sha256.HEX_CHARS[_>>12&15]+Sha256.HEX_CHARS[_>>8&15]+Sha256.HEX_CHARS[_>>4&15]+Sha256.HEX_CHARS[15&_]+Sha256.HEX_CHARS[r>>28&15]+Sha256.HEX_CHARS[r>>24&15]+Sha256.HEX_CHARS[r>>20&15]+Sha256.HEX_CHARS[r>>16&15]+Sha256.HEX_CHARS[r>>12&15]+Sha256.HEX_CHARS[r>>8&15]+Sha256.HEX_CHARS[r>>4&15]+Sha256.HEX_CHARS[15&r];return H||(D+=Sha256.HEX_CHARS[o>>28&15]+Sha256.HEX_CHARS[o>>24&15]+Sha256.HEX_CHARS[o>>20&15]+Sha256.HEX_CHARS[o>>16&15]+Sha256.HEX_CHARS[o>>12&15]+Sha256.HEX_CHARS[o>>8&15]+Sha256.HEX_CHARS[o>>4&15]+Sha256.HEX_CHARS[15&o]),D},Sha256.hash=Sha256.sha256;"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1245,"version":175,"content":"(function() {\n    var tagName = 'Analytics - GA4 - Mapping';\n    var afklMapping = {\n        z_channel: 'booking_channel',\n        z_checkin_passenger: 'checkin_passenger_count',\n        z_payment_status: 'confirmation_payment_status',\n        z_error_errorcode: 'error_code',\n        z_error_errordescription: 'error_description',\n        z_error_severity: 'error_severity_level',\n        dl: 'event_hit_type',\n        z_day_before_flight: 'flight_days_before_departure_count',\n        z_stay_duration: 'flight_days_stay_count',\n        z_departure_date: 'flight_departure_date',\n        z_destination: 'flight_destination_iata_code',\n        z_direct_flight: 'flight_direct_flight',\n        z_haul: 'flight_haul_type',\n        z_inbound_cabin_code: 'flight_inbound_cabin_class',\n        z_inbound_fare_selected: 'flight_inbound_fare_type_selected',\n        tms_inbound_fare_selected: 'flight_inbound_fare_type_selected',\n        z_booking_motive: 'flight_motive',\n        z_itics_cabin: 'flight_multiple_cabin_class',\n        z_itics_stay_duration: 'flight_multiple_days_stay_count',\n        z_flight_nr: 'flight_number',\n        z_origin: 'flight_origin_iata_code',\n        z_outbound_cabin_code: 'flight_outbound_cabin_class',\n        z_outbound_fare_selected: 'flight_outbound_fare_type_selected',\n        tms_outbound_fare_selected: 'flight_outbound_fare_type_selected',\n        z_passenger: 'flight_passenger_count',\n        z_rebooking_cause: 'flight_rebooking_cause',\n        z_return_date: 'flight_return_date',\n        z_trip_type: 'flight_trip_type',\n        z_umnr: 'flight_umnr',\n        z_flow_name: 'flow_name',\n        z_application: 'flow_step_ubc_name',\n        z_captcha_type: 'form_captcha_type',\n        z_login: 'form_login_status',\n        z_recovery_type: 'form_password_recovery_type',\n        z_impression: 'impression',\n        z_impr_miles: 'impression_price_miles',\n        z_impr_price: 'impression_price_regular',\n        z_impr_status: 'impression_status',\n        z_impr_ref: 'impression_reference',\n        cg_n: 'page_content_group',\n        cg_s: 'page_content_subgroup',\n        ti: 'page_name',\n        z_redir: 'page_redirect',\n        z_referrer: 'page_referrer',\n        z_referer: 'page_referrer',\n        z_host: 'platform_airline_code',\n        z_converged: 'platform_converged',\n        z_country: 'platform_country',\n        z_currency: 'platform_currency',\n        z_env: 'platform_environment',\n        z_language: 'platform_language',\n        z_parent_application: 'platform_parent_application',\n        z_parent_page_name: 'parent_page_name',\n        z_state_id: 'platform_state_id',\n        tx_e: 'product_cart_status',\n        z_changed_item: 'product_changed_cart',\n        pn_sku: 'product_id',\n        tx_s: 'product_price',\n        tx_u: 'product_quantity_count',\n        tms_ancillary_flow: 'tms_ancillary_flow',\n        tx_i: 'transaction_invoice_id',\n        z_used_miles: 'transaction_mix_used_miles',\n        z_payment_method: 'transaction_payment_method',\n        z_widget: 'ubc_widget_name',\n        tms_bts_contract_name: 'user_bts_contract_name',\n        z_corporate_contract: 'user_corporate_contract_login_status',\n        z_type_of_contract: 'user_corporate_contract_type',\n        z_enrol_type: 'user_enrol_type',\n        z_identification_type: 'user_identification_type',\n        z_subscription: 'user_subscription',\n        z_evoucher: 'evoucher',\n        z_inbound_best_fare_offered: 'flight_inbound_best_fare_price',\n        z_inbound_direct_flight: 'flight_inbound_direct_flight',\n        z_inbound_upsell_cabin: 'flight_inbound_upsell_carrier',\n        z_outbound_direct_flight: 'flight_outbound_direct_flight',\n        z_outbound_upsell_cabin: 'flight_outbound_upsell_carrier',\n        z_nb_adults: 'flight_adult_count',\n        z_base_fare: 'flight_base_fare_price',\n        z_carrier_surcharge: 'flight_carrier_surcharge_price',\n        z_nb_children: 'flight_children_count',\n        z_nb_infants: 'flight_infant_count',\n        z_booking_fee: 'flight_payment_fee',\n        z_nb_seniors: 'flight_seniors_count',\n        z_nb_students_major: 'flight_students_major_count',\n        z_nb_students_minor: 'flight_students_minor_count',\n        z_nb_youth_major: 'flight_youth_major_count',\n        z_nb_youth_minor: 'flight_youth_minor_count',\n        z_pnr_total_value: 'transaction_revenue',\n        z_pagetype: 'page_type',\n        tms_testcase: 'bluedata_test', // tms_testcase is not MI parameter\n        z_support: 'support',\n        z_pnr_number: 'pnr_number',\n        z_pnr_number_1: 'pnr_number_1', // these pnr's are encrypted values sent from Aftersales team\n        z_pnr_number_2: 'pnr_number_2',\n        z_pnr_number_3: 'pnr_number_3',\n        z_pnr_number_4: 'pnr_number_4',\n        z_pnr_number_5: 'pnr_number_5',\n        z_pnr_number_6: 'pnr_number_6',\n        z_seat_nr: 'flight_seat_nr',\n        z_aircraft_config: 'flight_aircraft_type',\n        tms_previous_page_path: 'previous_page_path',\n        z_captcha: 'form_captcha_validation_type',\n        ss_haul: 'ss_flight_haul_type',\n        z_signin_method: 'signin_method',\n        z_reservation_type: 'reservation_type',\n        z_nba_offer: 'nba_offer',\n\t\tz_inbound_marketing_carrier: 'flight_inbound_marketing_carrier',\n        z_inbound_operating_carrier: 'flight_inbound_operating_carrier',\n        z_outbound_marketing_carrier: 'flight_outbound_marketing_carrier',\n        z_outbound_operating_carrier: 'flight_outbound_operating_carrier',\n\t\tz_cabin_code:'flight_cabin_class',\n\t\tz_outbound_transfer_time:'flight_outbound_transfer_time',\n\t\tz_inbound_transfer_time:'flight_inbound_transfer_time',\n\t\tz_client_id: 'form_login_client_id',\n    };\n\n    var loginMapping = {\n        ti: 'page_name',\n        z_country: 'platform_country',\n        z_language: 'platform_language',\n        z_error_errorcode: 'error_code',\n        z_error_errordescription: 'error_description',\n        z_eventtype: 'event_action',\n        z_eventplace: 'event_category',\n        z_eventvalue: 'event_label',\n        z_login: 'form_login_status',\n        z_client_id: 'form_login_client_id',\n        z_redir: 'page_redirect',\n        z_referrer: 'login_referrer',\n        z_referer: 'login_referrer',\n        z_error_severity: 'error_severity_level',\n        z_recovery_type: 'form_password_recovery_type',\n        z_identification_type: 'user_identification_type',\n        dl: 'event_hit_type',\n        z_host: 'platform_airline_code',\n        z_signin_method: 'signin_method',\n        z_captcha_type: 'form_captcha_type',\n        z_flow_name: 'flow_name',\n    };\n\n    var convertToLowercaseAndString = function(key, value) {\n        var allowKeys = ['z_pnr_number_1', 'z_pnr_number_2', 'z_pnr_number_3', 'z_pnr_number_4', 'z_pnr_number_5', 'z_pnr_number_6'];\n        var convertToStringKeys = ['dl'];\n        if (allowKeys.indexOf(key) > -1) {\n            return value;\n        } else if (typeof value === 'string') {\n            return value.toLowerCase();\n        } else if (convertToStringKeys.indexOf(value) > -1) {\n            return value.toString();\n        } else {\n            return value;\n        }\n    };\n\n    var setCampaignConfig = function(miData) {\n        if (miData.utm_campaign && miData.z_eventplace !== 'webchat') {\n            var campaignData = {\n                campaign_id: miData.utm_id,\n                campaign_name: miData.utm_campaign,\n                campaign_source: miData.utm_source,\n                campaign_medium: miData.utm_medium,\n                campaign_term: miData.utm_term,\n                campaign_content: miData.utm_content,\n            };\n            gtag('set', campaignData);\n        }\n    };\n\n    var getPagePath = function() {\n        var pagePath = document.location.pathname;\n        return /^\\/[a-zA-Z]{2}(\\/.*)/.test(pagePath) ? pagePath.substring(3) : pagePath.length === 3 ? '/' : pagePath;\n    };\n\n\n    var setBtsContractName = function(miData) {\n        var btsContractName = {};\n        if (typeof(sessionStorage) !== \"undefined\" && sessionStorage.getItem('tms_bts_contract_name')) {\n            btsContractName = {\n                tms_bts_contract_name: sessionStorage.getItem('tms_bts_contract_name'),\n            };\n        }\n        _st.util.extend(miData, btsContractName);\n    };\n\n    var setParentApplication = function(miData) {\n        var parentApplication = {};\n        if (typeof(sessionStorage) !== \"undefined\" && sessionStorage.getItem('z_parent_application')) {\n            parentApplication = {\n                z_parent_application: sessionStorage.getItem('z_parent_application'),\n            };\n        }\n        _st.util.extend(miData, parentApplication);\n    };\n\n    var setHaulType = function(miData) {\n        var haulType = {};\n        if (typeof(sessionStorage) !== \"undefined\" && sessionStorage.getItem('ss_haul')) {\n            haulType = {\n                ss_haul: sessionStorage.getItem('ss_haul'),\n            };\n        }\n        _st.util.extend(miData, haulType);\n    };\n\n    var setOutboundFareSelected = function(miData) {\n        var outboundFareSelected = {};\n        if (typeof(sessionStorage) !== \"undefined\" && sessionStorage.getItem('tms_outbound_fare_selected')) {\n            outboundFareSelected = {\n                z_outbound_fare_selected: sessionStorage.getItem('tms_outbound_fare_selected'),\n            };\n        }\n        _st.util.extend(miData, outboundFareSelected);\n    };\n\n    var setNBAOfferSelected = function(miData) {\n        var nbaSelected = {};\n        var pageName = miData && miData.ti;\n        var isPurchase = miData && miData.tx_e === 'p';\n        if (pageName && pageName.indexOf('.confirmation') > -1 && sessionStorage.getItem('ss_nba_selected') && isPurchase) {\n            nbaSelected = {\n                z_nba_offer: sessionStorage.getItem('ss_nba_selected'),\n            };\n        }\n        _st.util.extend(miData, nbaSelected);\n    };\n\n    window.DAS.getGA4Mapping = function(miData, tracker) {\n        var ga4Data = {};\n\n        if (typeof miData === 'string') {\n            return;\n        }\n\n        try {\n            setCampaignConfig(miData);\n            setBtsContractName(miData);\n            setParentApplication(miData);\n            setHaulType(miData);\n            setOutboundFareSelected(miData);\n            setNBAOfferSelected(miData);\n\n            ga4Data.page_path = getPagePath();\n\n            var monetaryParams = DAS.euroConversion ? DAS.euroConversion.getMonetaryParams() : [];\n\n            var tmsConvertedToEuros = _st.data.getProperty('tms_converted_to_euros');\n\n            Object.keys(miData).forEach(function(key) {\n                var value = convertToLowercaseAndString(key, miData[key]); // change all the values to lowercase\n                var ga4Key = tracker === 'login' ? loginMapping[key] : afklMapping[key];\n                if (ga4Key) {\n                    ga4Data[ga4Key] = value;\n                    if (monetaryParams.indexOf(key) !== -1 && tmsConvertedToEuros[key]) {\n                        ga4Data[ga4Key] = convertToLowercaseAndString(key, tmsConvertedToEuros[key]); // Euro conversion of monetary values\n                    }\n                }\n\n                if (key === 'z_pnr_number') {\n                    var originalPNR = miData[key];\n                    ga4Data.pnr_number = Sha256.hash(originalPNR);\n                }\n\n                //Check if tx_i is pnr then encrypt the value\n                if (key === 'tx_i' && typeof value === 'string' && value.match(/^[a-z0-9]{5,6}$/)) {\n                    var originalTXI = miData[key];\n                    ga4Data.transaction_invoice_id = Sha256.hash(originalTXI);\n                }\n\n                if (key === 'z_promo_click') {\n                    ga4Data.impression = value;\n                    ga4Data.impression_status = 's';\n                } else if (key === 'z_promo_display') {\n                    ga4Data.impression = value;\n                    ga4Data.impression_status = 'o';\n                } else if (key === 'z_promo_ref') {\n                    ga4Data.impression_reference = value;\n                }\n            });\n\n            return ga4Data;\n        } catch (err) {\n            DAS.errors.push([tagName, err, 'ga4']);\n            return null;\n        }\n    };\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1285,"version":45,"content":"(function() {\n\n    var setOutboundFareSelectedInDataLayer = function () {\n        if (sessionStorage.getItem('tms_outbound_fare_selected') && _st.data.getProperty('ti') === 'booking.confirmation') {\n            var outbound_fare_selected = sessionStorage.getItem('tms_outbound_fare_selected');\n            _st.data.setProperty('z_outbound_fare_selected', outbound_fare_selected);\n        }\n    };\n\t\n\n    var setNBAOfferInDataLayer = function() {\n        var resetPages = ['booking.searchbox', 'homepage.homepage', 'checkin.entryform', 'trip.entryform'];\n        var currentPageName = _st.data.getProperty('ti');\n        var purchase = _st.data.getProperty('tx_e');\n        var ss_nba_selected = sessionStorage.getItem('ss_nba_selected');\n        if (ss_nba_selected && currentPageName.indexOf('.confirmation') > -1 && purchase === 'p') {\n            _st.data.setProperty('z_nba_offer', ss_nba_selected);\n        }\n\t\t_st.event.subscribe('', '', function (category, name, data) {\n\t\t\tcurrentPageName = data.ti;\n\t\t\tpurchase = data.tx_e;\n\t\t\tif (ss_nba_selected && currentPageName.indexOf('.confirmation') > -1 && purchase === 'p') {\n\t\t\t\t_st.data.setProperty('z_nba_offer', ss_nba_selected);\n\t\t\t}\n\t\t});\n        if(resetPages.indexOf(currentPageName) > -1) {\n            sessionStorage.removeItem(\"ss_nba_selected\");\n        }\n    };\n\n    var updateNBAOfferSession = function() {\n        var z_widget = _st.data.getProperty('z_widget');\n        var z_eventtype = _st.data.getProperty('z_eventtype');\n        var z_eventvalue = _st.data.getProperty('z_eventvalue');\n\t\tvar z_application = _st.data.getProperty('z_application');\n        setNBAValues(z_widget, z_eventtype, z_eventvalue, z_application);\n        _st.event.subscribe('', '', function (category, name, data) {\n            setNBAValues(data.z_widget, data.z_eventtype, data.z_eventvalue, data.z_application);\n        });\n    };\n\n    var setNBAValues = function(z_widget, z_eventtype, z_eventvalue, z_application) {\n        if(z_widget === 'nba' && z_eventtype === 'clicked') {\n            sessionStorage.setItem(\"ss_nba_selected\", z_eventvalue + ';' + z_application);\n        }\n    };\n\n    try {\n        if (typeof(Storage) !== \"undefined\") {\n            var outboundFareSelected = _st.data.getProperty(\"z_outbound_fare_selected\");\n            if(outboundFareSelected && outboundFareSelected !== '-') {\n                sessionStorage.setItem(\"tms_outbound_fare_selected\", outboundFareSelected);\n            }\n            var inboundFareSelected = _st.data.getProperty(\"z_inbound_fare_selected\");\n            if(inboundFareSelected && inboundFareSelected !== '-') {\n                sessionStorage.setItem(\"tms_inbound_fare_selected\", inboundFareSelected);\n            }\n            var outboundFlightNBR = _st.data.getProperty(\"z_outbound_flight_nbr\");\n            if(outboundFlightNBR && outboundFlightNBR !== '-') {\n                sessionStorage.setItem(\"tms_outbound_flight_nbr\", outboundFlightNBR);\n            }\n            var inboundFlightNBR = _st.data.getProperty(\"z_inbound_flight_nbr\");\n            if(inboundFlightNBR && inboundFlightNBR !== '-') {\n                sessionStorage.setItem(\"tms_inbound_flight_nbr\", inboundFlightNBR);\n            }\n            var originIataCode = _st.data.getProperty(\"z_origin\");\n            if (originIataCode && _st.data.getProperty('ti') !== \"booking.inboundflight\"){\n                sessionStorage.setItem(\"tms_origin\", originIataCode);\n            }\n\n            setOutboundFareSelectedInDataLayer();\n            setNBAOfferInDataLayer();\n            updateNBAOfferSession();\n        } \n    }\n    catch(e) {\n        _st.debug.log('Getting DL vars in sessionStorage or cookie generated this error: ', e);\n    }\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1297,"version":9,"content":"(function() {\n    window.DAS = window.DAS || {};\n\n    var tagName = 'Analytics-GA4-Session-storage-Manager';\n    var allowedFlowNames = ['homepage', 'booking', 'advanced'];\n\tvar resetPages = ['booking.searchbox', 'homepage.homepage'];\n\n    var loadSessionManager = function(data) {\n        try {\n            var flowName = data.z_flow_name;\n\t\t\tvar currentPageName = data.ti;\n            if (typeof(Storage) !== \"undefined\") {\n\t\t\t\tif(resetPages.indexOf(currentPageName) > -1) {\n\t\t\t\t\tsessionStorage.removeItem(\"ss_haul\");\n\t\t\t\t}\n                if(allowedFlowNames.indexOf(flowName) > -1) {\n                    var ssHaul = sessionStorage.getItem(\"ss_haul\");\n                    var zHaul = data.z_haul;\n                    if (ssHaul) {\n                        _st.data.setProperty(\"ss_haul\", ssHaul);\n                    } \n                    if (zHaul && ssHaul !== zHaul) {\n                        sessionStorage.setItem(\"ss_haul\", zHaul);\n                        _st.data.setProperty(\"ss_haul\", zHaul);\n                    }\n                } else {\n\t\t\t\t\tsessionStorage.removeItem(\"ss_haul\");\n\t\t\t\t}\n            }\n        }\n        catch(err) {\n            DAS.errors.push([tagName, err, 'ga4']);\n        }\n    };\n    var miData = _st.util.extend(_st.util.extend({}, _st.data._localTagProperties), _st.data._tagProperties);\n    loadSessionManager(miData);\n\n    _st.event.subscribe('', '', function (category, name, data) {\n        if(['QM/', 'gtm_configured/', 'ignore_domains/'].indexOf(category) === -1) {\n            loadSessionManager(data);\n        }\n    });\n\n})();","group":1},{"markerCondition":"[]","selector":"head","id":1318,"version":27,"content":"_st('setPermissionCallback', function(pref) {\n\t_st.debug.log('consent changed to :' + _st.util.encodeJson(pref));\n\tvar ad_storage = 'denied';\n\tvar ad_user_data = 'denied';\n  \tvar ad_personalization = 'denied';\n  \tvar analytics_storage = 'denied';\n\tif (pref[1] == true) {\n  \t\tanalytics_storage = 'granted';\n\t}\n\tif (pref[2] == true) {\n  \t\tanalytics_storage = 'granted';\n\t}\n\tif (pref[3] == true) {\n\t\tad_storage = 'granted';\n\t\tad_user_data = 'granted';\n  \t\tad_personalization = 'granted';\n  \t\tanalytics_storage = 'granted';\n\t}\n\tgtag('consent', 'update', {\n\t\t'ad_storage': ad_storage,\n\t\t'ad_user_data': ad_user_data,\n  \t\t'ad_personalization': ad_personalization,\n  \t\t'analytics_storage': analytics_storage\n\t});\n\t_st.debug.log('executed gtag consent default: ' + ad_storage + ad_user_data + ad_personalization + analytics_storage);\n});"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":761,"version":188,"content":"(function() {\nvar GoogleGlobalTag = (function() {\n\t_st.inject.script(\"//www.googletagmanager.com/gtag/js?id=AW-980474582\", {\n\t  callback: function () {\n\t\twindow.dataLayer = window.dataLayer || [];\n\t\tfunction gtag() { dataLayer.push(arguments); }\n\n\t\t//  domain linker for BW countries. Keep in comments to make sure no extra text is pasted behind URL. could break the packagedeals page.\n\n\t\t//gtag('set', 'linker', {\n\t\t// 'domains': ['.klm.com', '.klm.nl', '.klm.es', '.klm.co.za', '.klm.at', '.klm.com.mx']\n\t\t//});\n\n\t\tvar tracking = _st.data.getProperty('z_tracking');\n\n\t\tvar converged = _st.data.getProperty('z_converged');\n\t\t/*\n\t\tvar cookies = {\n\t\t  gclid: {\n\t\t\tcookiePrefix: 'GCL',\n\t\t\tcookieName: '_gcl_aw',\n\t\t\tttlDays: 30\n\t\t  },\n\t\t  dclid: {\n\t\t\tcookiePrefix: 'GCL',\n\t\t\tcookieName: '_gcl_dc',\n\t\t\tttlDays: 30\n\t\t  }\n\t\t};\n\t\tvar googleAdwordsParams = ['gclid', 'gclsrc', 'dclid'];\n\t\t// Add parameters to google location url and set the page_location in gtag\n\t\tif (tracking) {\n\t\t  var documentLocationUrl =\n\t\t\tdocument.location.origin +\n\t\t\tdocument.location.pathname +\n\t\t\tdocument.location.search;\n\t\t  var isQueryParamPresent = documentLocationUrl.indexOf('?') !== -1;\n\t\t  var queryParams = isQueryParamPresent ? '&' : '?';\n\t\t  googleAdwordsParams.forEach(function (adword, index) {\n\t\t\tqueryParams += _st.data.getProperty('z_tracking')[adword] ? ((queryParams.length > 1 ? '&' + adword : adword) +\n\t\t\t  '=' +\n\t\t\t  _st.data.getProperty('z_tracking')[adword]) : '';\n\t\t  });\n\t\t  if (queryParams.length > 1) {\n\t\t\tdocumentLocationUrl += queryParams;\n\t\t\tgtag('set', 'page_location', documentLocationUrl);\n\t\t  }\n\t\t}\n\n\t\tfor (var trackingId in cookies) {\n\t\t  if (cookies.hasOwnProperty(trackingId)) {\n\t\t\tif (isCookieRequired(cookies[trackingId].cookieName, trackingId)) {\n\t\t\t  createCookie(cookies[trackingId].cookieName, cookies[trackingId].cookiePrefix, cookies[trackingId].ttlDays, trackingId);\n\t\t\t}\n\t\t  }\n\t\t}\n\n\n\t\tfunction isCookieUpdated(cookieName, clickId) {\n\t\t  var cookieValue = _st.util.getCookie(cookieName);\n\t\t  if (cookieValue) {\n\t\t\tvar cookieValueList = cookieValue.split('.');\n\t\t\tif (cookieValueList.length === 3) {\n\t\t\t  var trackingId = cookieValueList[2];\n\t\t\t  if (trackingId !== tracking[clickId]) {\n\t\t\t\treturn true;\n\t\t\t  }\n\t\t\t}\n\t\t  }\n\t\t  return false;\n\t\t}\n\n\t\tfunction createCookie(cookieName, cookiePrefix, ttlDays, trackingId) {\n\t\t  var currentTime = Math.floor(new Date().getTime() / 1000);\n\t\t  var delimeter = \".\";\n\t\t  var cookieValue = cookiePrefix + delimeter + currentTime + delimeter + tracking[trackingId];\n\t\t  _st.util.setCookie(cookieName, cookieValue, ttlDays);\n\t\t}\n\n\t\tfunction isCookieRequired(cookieName, trackingId) {\n\t\t  var cookieValue = _st.util.getCookie(cookieName);\n\t\t  if (converged && tracking) {\n\t\t\tif (tracking[trackingId] && (!cookieValue || (cookieValue && isCookieUpdated(cookieName, trackingId)))) {\n\t\t\t  return true;\n\t\t\t}\n\t\t  }\n\t\t}\n\t*/\n\t\t// configure gtag for AW & DC accounts\n\t\tgtag('js', new Date());\n\n\n\t\t//get experiment data\n\t\tvar experimentId = '149';\n\t\tvar groups = {};\n\t\tgroups['150'] = 'Control_Group';\n\t\tgroups['151'] = 'Display_Group';\n\t\tgroups['152'] = 'GDN_Group';\n\t\tgroups['153'] = 'Display-GDN_Group';\n\t\tvar store_group = \"\";\n\n\t\tif (_st.data.getUserData() !== undefined &&\n\t\t  _st.data.getUserData().e !== undefined &&\n\t\t  _st.data.getUserData().e[experimentId] !== undefined) {\n\n\t\t  var groupName = groups[_st.data.getUserData().e[experimentId].group];\n\t\t  if (groupName !== undefined) {\n\t\t\tstore_group = groupName;\n\t\t  }\n\t\t}\n\t\tgtag('event', 'conversion', {\n\t\t  'allow_custom_scripts': true,\n\t\t  'u1': ('' + _st.data.getProperty('z_country') + '').toLowerCase(),\n\t\t  'u2': '' + _st.data.getProperty('z_language') + '',\n\t\t  'u3': '' + _st.data.getProperty('z_origin') + '',\n\t\t  'u4': '' + _st.data.getProperty('z_destination') + '',\n\t\t  'u5': '' + _st.data.getProperty('z_currency') + '',\n\t\t  'u6': '' + _st.data.getProperty('z_base_fare') + '',\n\t\t  'u7': '' + _st.data.getProperty('z_timestamp') + '',\n\t\t  //'u8': '' + _st.data.getProperty('z_pnr_number') + '',\n\t\t  'u9': '' + _st.data.getProperty('z_cabin_code') + '',\n\t\t  'u10': '' + _st.data.getProperty('pn_sku') + '',\n\t\t  'u11': z_pnr_total_value,\n\t\t  'u12': '' + _st.data.getProperty('z_departure_date') + '',\n\t\t  'u13': '' + _st.data.getProperty('z_return_date') + '',\n\t\t  'u14': '' + _st.data.getProperty('z_day_before_flight') + '',\n\t\t  'u15': '' + _st.data.getProperty('z_stay_duration') + '',\n\t\t  'u16': '(' + _st.data.getProperty('z_nb_children') + '+' + _st.data.getProperty('z_nb_adults') + ')',\n\t\t  'u17': '' + _st.data.getProperty('z_trip_type') + '',\n\t\t  'u18': '' + _st.data.getProperty('z_inbound_subclass') + '',\n\t\t  'u19': '' + _st.data.getProperty('z_inbound_marketing_carrier_flight_nr') + '',\n\t\t  'u20': _st.data.getProperty('ti'),\n\t\t  'u21': '' + _st.data.getProperty('z_origin') + '+\"_\"+' + _st.data.getProperty('z_destination') + '',\n\t\t  'u22': store_group,\n\t\t  'send_to': 'DC-4232724/klm_gl/klm_g0+standard'\n\t\t});\n\t  }\n\t});\n});\n\t\n// Default initialize variables.\nz_pnr_total_value = _st.data.getProperty('z_pnr_total_value');\n\n// Check if it is BW and has the currency parameter only then do currency conversion.\nif(_st.data.getProperty('z_converged') && _st.data.getProperty('tms_converted_to_euros') && (_st.data.getProperty('z_pnr_total_value'))){\n\tz_pnr_total_value = Number(_st.data.getProperty('tms_converted_to_euros').z_pnr_total_value).toFixed(2);  \n\t// Call usual functionality\n\tGoogleGlobalTag();\n} \nelse {\n\t// Call usual functionality without currency conversion\n\tGoogleGlobalTag();\n}           \n})();","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1119,"version":187,"content":"(function () {\n\n    var tagName = 'Analytics-Universal-Utility';\n\n    var mandatoryParameters = ['z_application', 'z_country', 'z_language', 'ti', 'dl', 'z_converged', 'z_env', 'z_host', 'z_login'];\n\n    /** This method sends the events hit to the GA property.\n     * Input: property - This expects an object with following property.\n     * tracker: Name of the ga property tracker where the data is sent.\n     * tagNameDim: The dimension mapped for the Relay tag name used for debugging hits in GA.\n     * Eg: { tracker: '', tagNameDim: 'dimension149',  }\n     * Returns: Throws error in case the property object is not present else sends the event view hit.\n     */\n    DAS.sendEvents = function (category, name, data, property) {\n\n        try {\n            if (category && name && data) {\n                _st('addTagProperties', data);\n                // Conversion only works for BW not for other converged apps (Eg: LNGP)\n                // TODO: Replace the check to window.DAS.euroConversion once we are sure we always have euroConversion for all BW events.\n                if (_st.data.getProperty('z_converged').toLowerCase() === 'bw') {\n                    DAS.euroConversion.addConvertedValueToDataLayer(data);\n                    // Add webchat Status to data layer.\n                    DAS.webchat.updateWebchatStatusToDataLayer(data);\n                }\n\n                var eventLabel = '';\n                var eventAction = '';\n                var eventCategory = '';\n                var event_metric;\n\n                if (data.event) {\n                    eventLabel = data.event;\n                    eventAction = data.event.split('.').pop();\n                } else {\n                    eventLabel = typeof data.z_eventvalue === 'string' ? data.z_eventvalue.trim() : 'No Label';\n                    eventAction = data.z_eventtype ? data.z_eventtype : eventLabel.split('.').pop();\n                }\n\n                eventCategory = data.z_eventplace ? data.z_eventplace :\n                    data.ti ? data.ti.split('.').pop() : 'No Category';\n                if (data.z_eventmetric) { event_metric = data.z_eventmetric; }\n\n                if (data.z_error_errorcode) {\n                    eventLabel = data.z_error_errorcode;\n                    eventCategory = eventLabel;\n                    eventAction = 'Error';\n                    if (data.z_error_errordescription) {\n                        eventLabel = data.z_error_errordescription;\n                    }\n                    if (data.z_error_severity) {\n                        eventAction = data.z_error_severity.trim() + '.Error';\n                    }\n                }\n                /* DAS-1208 Add a new parameter for ancillaries offered to find the conversion rate of ancillaries on ancillary.confirmation.\n                *  This is added to events as the offered ancillary is part of an event.*/\n                if (_st.data.getProperty(\"tx_e\") == 'o' && typeof (sessionStorage) !== \"undefined\" &&\n                    (_st.data.getProperty(\"ti\").indexOf(\"booking.confirmation\") != -1 ||\n                        (!sessionStorage.getItem(\"tms_ancillary_flow\") && _st.data.getProperty(\"ti\").indexOf(\"trip.details\") != -1))) {\n                    //Get the flow_name from the page_name instead of the flow_name variable as the flow_variable is not consistent.\n                    var flow_name = _st.data.getProperty(\"z_flow_name\");\n                    var booking_motive = _st.data.getProperty(\"z_booking_motive\");\n                    var seperator = booking_motive ? '.' + booking_motive : '';\n                    sessionStorage.setItem(\"tms_ancillary_flow\", flow_name + seperator);\n                }\n                if (typeof (sessionStorage) !== \"undefined\" && sessionStorage.getItem(\"tms_ancillary_flow\")) {\n                    _st.data.setProperty('tms_ancillary_flow', sessionStorage.getItem(\"tms_ancillary_flow\"));\n                    data.tms_ancillary_flow = sessionStorage.getItem(\"tms_ancillary_flow\");\n                }\n                //Set the correct tracker for the property with a '.' Eg: 'loginTracker.'\n                var tracker = property.tracker ? property.tracker + '.' : '';\n                var hitData = {};\n                hitData[property.tagNameDim] = tagName + ':Events';\n                if (data.ti === 'BW.send_tier_level' || data.z_eventplace === 'notification') {\n                    hitData.nonInteraction = true;\n                }\n\n                //GA4 testing \n                if (/BW|bw/.test(data.z_converged)) {\n                    data.tms_testcase = 'ga3-ga4_1';\n                    data.tms_eventname = 'web_event';\n                }\n\n                _st.util.extend(data, setMandatoryParameterIncomplete(data, mandatoryParameters));\n\n                var dataToSend = _st.util.extend(hitData, DAS.UniversalAnalyticsMapping(data, property.tracker));\n\n                //Send data to the correct tracker\n                ga(tracker + 'send', 'event', eventCategory, eventAction, eventLabel, event_metric, dataToSend);\n\n                sendLoginDataToDAS(data, 'web_event', dataToSend);\n\n                if (_st.data.getProperty('tms_converted_to_euros')) {\n                    data.tms_converted_to_euros = _st.data.getProperty('tms_converted_to_euros');\n                }\n\n                if (_st.data.getProperty('tms_webchat_status')) {\n                    data.tms_webchat_status = _st.data.getProperty('tms_webchat_status');\n                }\n                // Trigger Qmon validation only once.\n                if (!tracker && data.z_eventplace !== 'webchat' && data.ti !== 'BW.send_tier_level' && category !=='ignore_domains/' && category !== 'gtm_configured') {\n                    window.adv_event = window.adv_event || [];\n                    window.adv_event.push(['bw-mi-event', data]);\n                }\n            }\n        }\n        catch (err) {\n            DAS.errors.push([tagName, err, 'ga3']);\n        }\n    };\n    /** This method sends the page view hit to the GA property.\n     * Input: property - This expects an object with following property.\n     * tracker: Name of the ga property tracker where the data is sent.\n     * tagNameDim: The dimension mapped for the Relay tag name used for debugging hits in GA.\n     * Eg: { tracker: '', tagNameDim: 'dimension149',  }\n     * Returns: Throws error in case the property object is not present else sends the page view hit.\n     */\n    DAS.sendPageView = function (property) {\n\n        try {\n            // Add webchat Status to data layer.\n            DAS.webchat.updateWebchatStatusToDataLayer();\n            // Get Properties\n            var data = _st.util.extend(_st.util.extend({}, _st.data._localTagProperties), _st.data._tagProperties);\n\n            var tracker = property.tracker ? property.tracker + '.' : '';\n            var hitData = {};\n            hitData[property.tagNameDim] = tagName + ':PageView';\n            hitData.hitType = 'pageview';\n            if (typeof (sessionStorage) !== \"undefined\" && sessionStorage.getItem(\"tms_ancillary_flow\")) {\n                data.tms_ancillary_flow = sessionStorage.getItem(\"tms_ancillary_flow\");\n            }\n\n            //GA4 testing \n            if (/BW|bw/.test(data.z_converged)) {\n                data.tms_testcase = 'ga3-ga4_1';\n                data.tms_eventname = 'web_pageview';\n            }\n\n            _st.util.extend(data, setMandatoryParameterIncomplete(data, mandatoryParameters));\n\n            var dataToSend = _st.util.extend(hitData, DAS.UniversalAnalyticsMapping(data, property.tracker));\n\n            // Send GA pageview using mapped properties\n            ga(tracker + 'send', dataToSend);\n\n            sendLoginDataToDAS(data, 'page_view', dataToSend);\n\n            //Fix: Remove already present tc_cj_v2 cookie for BW users.\n            if (_st.util.getCookie(\"tc_cj_v2\")) {\n                _st.util.eraseCookie(\"tc_cj_v2\");\n                _st.util.eraseCookie(\"tc_cj_v2\", \".\" + document.domain);\n            }\n            // Trigger Qmon validation only once\n            if (!tracker) {\n                window.adv_event = window.adv_event || [];\n                window.adv_event.push(['bw-mi-page', data]);\n            }\n        }\n        catch (e) {\n            DAS.errors.push([tagName, e, 'ga3']);\n        }\n    };\n\n    var setMandatoryParameterIncomplete = function(data, mandatoryParameters) {\n        var isMandatoryParameterMissing = isMandatoryParameterIncomplete(data, mandatoryParameters);\n        if (isMandatoryParameterMissing) {\n            if (data.z_converged === undefined || data.z_converged === '' || data.z_converged ==='BW') {\n                return {\n                    param_incomplete: true\n                };\n            } else {\n                return {\n                    param_incomplete: false\n                };\n            }\n        } else {\n            return {\n                param_incomplete: false\n            };\n        }\n\n    };\n\n    var isMandatoryParameterIncomplete = function(data, mandatoryParameters) {\n        var isParamEmpty = false;\n        mandatoryParameters.forEach(function (param) {\n            if (data[param] === undefined || data[param] === '') {\n                isParamEmpty = true;\n            }\n        });\n        return isParamEmpty;\n    };\n\n    var cleanValue = function cleanValue(type, value) {\n        if (type === 'metric') {\n            return Number(value);\n        }\n\n        if (type === 'dimension') {\n            // Set max Characters in dimension to 150\n            var valueString = String(value).substring(0, 150);\n            if (valueString.length === 150 && valueString.indexOf(';') === -1) {\n                return valueString.substr(0, valueString.lastIndexOf(';'));\n            } else {\n                return valueString;\n            }\n        }\n\n        if (type === 'other') {\n            return String(value);\n        }\n    };\n\n    var validValueCheck = function validValueCheck(value) {\n        return typeof value !== 'undefined' && value !== null && String(value) !== \"\";\n    };\n\n    var getType = function getType(gaMapping) {\n        if (gaMapping.indexOf('metric') !== -1) {\n            return 'metric';\n        }\n\n        if (gaMapping.indexOf('dimension') !== -1) {\n            return 'dimension';\n        }\n\n        return 'other';\n    };\n\n    var getMapping = function getMapping(tracker) {\n        tracker = tracker || 'default';\n        return DAS.mapping[tracker].getMapping();\n    };\n\n    var setBtsContractName = function (extraParameters, miMapping) {\n        if (typeof (sessionStorage) !== \"undefined\" && sessionStorage.getItem('tms_bts_contract_name')) {\n            extraParameters[miMapping.tms_bts_contract_name.ga] = sessionStorage.getItem('tms_bts_contract_name');\n            return extraParameters;\n        }\n        return extraParameters;\n    };\n\n    var getPassengerCount = function (data) {\n        var z_passenger = 0;\n        var passengerParams = [\"z_nb_adults\", \"z_nb_children\", \"z_nb_seniors\", \"z_nb_of_students_minor\", \"z_nb_of_students_major\", \"z_nb_youth\", \"z_nb_youth_major\", \"z_nb_youth_minor\"];\n        passengerParams.forEach(function (passengerParam) {\n            if (data[passengerParam])\n                z_passenger += parseInt(data[passengerParam]);\n        });\n        return z_passenger;\n    };\n\n    var sendLoginDataToDAS = function (miData, eventType, dataToSend) {\n        var dasMeasurementID = 'G-FVF23K8M17';\n        var headerEventPlace = miData.z_eventplace ? miData.z_eventplace.toLowerCase() : null;\n        var headerEventType = miData.z_eventtype ? miData.z_eventtype.toLowerCase() : null;\n        if(headerEventPlace === 'header' && headerEventType === 'login') {\n            var dasData = {\n                event_category: 'DAS-1994',\n                event_action: 'login',\n                event_label: miData.z_eventvalue,\n                ga3_count: 1,\n            };\n\n            _st.util.extend(dasData, miData);\n            _st.util.extend(dasData, dataToSend);\n\n            dasData.send_to = dasMeasurementID;\n            window.gtag('event', eventType, dasData);\n        }\n    };\n\n    /** This method maps the MI data to the GA property.\n     * Input: data - The MI data send for the hit/pageview.\n     * gaTracker: Name of the ga property tracker where the data is sent. In case gaTracker is not present maps data to the default KL property.\n     * Eg: {z_application:'checkout'}, 'loginTracker'\n     * Returns: Returns a mapped GA object.\n     */\n    DAS.UniversalAnalyticsMapping = function universalAnalyticsMapping(data, gaTracker) {\n        var tagName = 'Analytics-Universal-Mapping';\n        // set the valid tracker for the ga property (Eg: login), default tracker is empty. \n        var tracker = gaTracker ? gaTracker + '.' : '';\n        try {\n            var result = {};\n            var extraParameters = {};\n            var monetaryParams = DAS.euroConversion ? DAS.euroConversion.getMonetaryParams() : [];\n            data.z_passenger = getPassengerCount(data);\n            var miMapping = getMapping(gaTracker);\n            for (var parameter in data) {\n                if (Object.prototype.hasOwnProperty.call(data, parameter)) {\n                    //Convert Mi keys to lowercase to avoid key mismatch and case checks.\n                    var mappingObject = miMapping[parameter.toLowerCase()] || {};\n                    var gaMapping = mappingObject.ga || \"\";\n\n                    var operation = mappingObject.operation || function (x) {\n                        return x;\n                    };\n                    var originalParameterValue = data[parameter];\n\n                    // Euro Conversion\n                    if (monetaryParams.indexOf(parameter) !== -1 && validValueCheck(_st.data.getProperty('tms_converted_to_euros')[parameter])) {\n                        originalParameterValue = _st.data.getProperty('tms_converted_to_euros')[parameter];\n                    }\n                    \n                    // Run the operation function over the original parameter value\n                    var processedParameterValue = operation(originalParameterValue, extraParameters, gaTracker);\n\n                    // Check to make sure The defined operation doesn't return an unexpected value\n                    if (gaMapping && originalParameterValue && !processedParameterValue) {\n                        DAS.errors = DAS.errors || [];\n                        DAS.errors.push([tagName, {\n                            name: 'valueError',\n                            message: 'Unexpected processedParameterValue for: ' + parameter + '. originalParameterValue was: ' + encodeURIComponent(String(originalParameterValue))\n                        }, 'ga3']);\n                    }\n                    // Map parameters\n                    if (gaMapping && validValueCheck(processedParameterValue)) {\n                        processedParameterValue = cleanValue(getType(gaMapping), processedParameterValue);\n                        if (mappingObject.persistent) {\n                            // if tracker present send data to the appropriate property.\n                            ga(tracker + 'set', gaMapping, processedParameterValue);\n                        }\n\n                        result[gaMapping] = processedParameterValue;\n                    }\n                    // Enhanced Ecommerce mapping\n                    if (parameter === 'tx_e' && typeof DAS.handleEcommerce === 'function') {\n                        DAS.handleEcommerce(data);\n                    }\n                }\n            }\n            //Add bts_contract_name if present in session storage.\n            extraParameters = setBtsContractName(extraParameters, miMapping);\n            if (miMapping && miMapping.z_correlation_id) {\n                extraParameters[miMapping.z_correlation_id.ga] =  _st.util.getCookie('klm_tracking_id');\n            }\n            if(tracker.indexOf('serverCookieTracker') !== -1) {\n                extraParameters[miMapping.z_env.ga] = 'ute';\n            }\n\n            var correlation_id = _st.util.getCookie('correlation_id');\n            if(correlation_id) {\n                extraParameters[miMapping.bw_correlation_id.ga] = correlation_id;\n            } else if (window.bwDynamicGlobal && window.bwDynamicGlobal.correlationId !== '') {\n                extraParameters[miMapping.bw_correlation_id.ga] = window.bwDynamicGlobal.correlationId;\n            }\n\n            //Check if the z_parent_application is present in the Session Storage if yes send the value with the hit.\n            if (typeof (sessionStorage) !== \"undefined\" && sessionStorage.getItem('z_parent_application')) {\n                extraParameters[miMapping.z_parent_application.ga] = sessionStorage.getItem('z_parent_application');\n            }\n            // Map extraParameters\n            _st.util.extend(result, extraParameters);\n\n            return result;\n        } catch (err) {\n            DAS.errors.push([tagName, err, 'ga3']);\n        }\n    };\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1173,"version":13,"content":"(function() {\n\ttry {\n\t\tvar webchat = {\n\t\t\tsetWebchatStatus : function setWebchatStatus(interaction) {\n\t\t\t\tvar status = (interaction === 'impression') ? 'offered' : 'clicked';\n\t\t\t\tif (typeof (sessionStorage) !== \"undefined\") {\n\t\t\t\t\tvar webchat_status = status + '_' + _st.data.getProperty('ti');\n\t\t\t\t\tvar webchat_session = sessionStorage.getItem('tms_webchat_status');\n\t\t\t\t\tif(!webchat_session || (webchat_session && status == 'clicked') || (webchat_session && webchat_session.indexOf('clicked') === -1 && status === 'offered')) {\n\t\t\t\t\t\tsessionStorage.setItem('tms_webchat_status', webchat_status);\n\t\t\t\t\t}\n\t\t\t\t\tDAS.webchat.updateWebchatStatusToDataLayer();\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdateWebchatStatusToDataLayer : function updateWebchatStatusToDataLayer() {\n\t\t\t\t// Add the tms_webchat_status to each pageview \n\t\t\t\tif(sessionStorage.getItem('tms_webchat_status')&& !_st.data.getProperty('tms_webchat_status')) {\n\t\t\t\t\t_st.data.setProperty('tms_webchat_status', sessionStorage.getItem('tms_webchat_status'));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tDAS.webchat = webchat;\n\t} catch (err) {\n\t\tDAS.errors.push([\"Saleforce Proactive WebChat Status\", err]);\n\t}\n})();\n        ","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1249,"version":323,"content":"(function() {\n    var tagName = 'Analytics-GA4-Utility';\n    var klmMeasurementID = 'G-1QEDZ9D8R2';\n    var loginMeasurementID = 'G-54M8QSSE1Q';\n    var removeProperty = ['dcsid', 'z_tracking', 'z_conversion_rates', 'tms_converted_to_euros'];\n    var mandatoryParameters = ['z_application', 'z_country', 'z_language', 'ti', 'dl', 'z_converged', 'z_env', 'z_host', 'z_login'];\n\n    var sendPageView = function(data, tracker) {\n        if (DAS.webchat) {\n            DAS.webchat.updateWebchatStatusToDataLayer();\n        }\n        var paxCount = getPassengerCount(data);\n        if (paxCount) {\n            data.z_passenger = paxCount;\n        }\n        var ga4Data = _st.util.extend(DAS.getGA4Mapping(data, tracker), getAncillaries(data));\n        var dataToSend = removeAndTrimProperty(ga4Data);\n        dataToSend.page_count = 1;\n        dataToSend.hit_count = 1;\n        dataToSend.send_to = tracker === 'login' ? loginMeasurementID : klmMeasurementID;\n        if (dataToSend.z_currency && ['unknown', 'MILES'].indexOf(dataToSend.z_currency) === -1) {\n            dataToSend.currency = dataToSend.z_currency;\n        }\n        _st.util.extend(dataToSend, getUTMParameters(data, tracker));\n        _st.util.extend(dataToSend, getUserProperties(data, tracker));\n        _st.util.extend(dataToSend, getCorrelationId());\n        _st.util.extend(dataToSend, getRelay42Path());\n        _st.util.extend(dataToSend, getPreviousPagePath());\n        _st.util.extend(dataToSend, getCustomTimestamp());\n        _st.util.extend(dataToSend, getPersonalization(data, dataToSend));\n        _st.util.extend(dataToSend, setMandatoryParameterIncomplete(data, mandatoryParameters));\n\n        if (dataToSend.page_name === \"booking.confirmation\") {\n            _st.util.extend(dataToSend, setOutboundAndInboundData());\n        }\n\n        if (data.tx_e && typeof DAS.handleGA4Ecommerce === 'function') {\n            DAS.handleGA4Ecommerce(data, dataToSend);\n        }\n        sendDataToQmon(data, mandatoryParameters);\n        window.gtag('event', 'page_view', dataToSend);\n    };\n\n    var getGA4CookieDomainConfig = function() {\n        return {\n            cookie_domain: 'auto',\n            cookie_update: true,\n            linker: {\n                accept_incoming: true\n            }\n        };\n    };\n\n    var setOutboundAndInboundData = function(data) {\n        if (typeof(sessionStorage) !== \"undefined\" && sessionStorage.getItem('tms_outbound_fare_selected')) {\n            return {\n                flight_outbound_fare_selected: sessionStorage.getItem('tms_outbound_fare_selected'),\n                flight_outbound_flight_nbr: sessionStorage.getItem('tms_outbound_flight_nbr'),\n                flight_inbound_fare_selected: sessionStorage.getItem('tms_inbound_fare_selected'),\n                flight_inbound_flight_nbr: sessionStorage.getItem('tms_inbound_flight_nbr')\n            };\n        } else {\n            return {};\n        }\n    };\n\n    var getPreviousPagePath = function() {\n        var pages = sessionStorage.getItem('qualtricsPages');\n        var pagePath = JSON.parse(pages);\n        if (pagePath && window.document.location.href !== pagePath.currentPage) {\n            var previousPageURL = new URL(pagePath.currentPage);\n            var previousPagePath = (/^\\/[a-zA-Z]{2}(\\/|$)/.test(previousPageURL.pathname)) ? (previousPageURL.pathname.length === 3 ? '/' : previousPageURL.pathname.substring(3)) : previousPageURL.pathname;\n            return {\n                previous_page_path: previousPagePath\n            };\n        }\n        return {};\n    };\n\n    var getCorrelationId = function() {\n        var correlation_id = _st.util.getCookie('correlation_id');\n        if (correlation_id) {\n            return {\n                correlation_id: correlation_id\n            };\n        }\n        if (window.bwDynamicGlobal && window.bwDynamicGlobal.correlationId !== '') {\n            return {\n                correlation_id: window.bwDynamicGlobal.correlationId\n            };\n        }\n        return {};\n    };\n\n    var getUserProperties = function(data, tracker) {\n        var tierLevel = data.z_ffp_tier_level ? data.z_ffp_tier_level.toLowerCase() : null;\n        var userEnrolType = data.z_enrol_type ? data.z_enrol_type.toLowerCase() : null;\n        var userSubscription = data.z_subscription ? data.z_subscription.toLowerCase() : null;\n        var userInfo = getUserInfo(userEnrolType, userSubscription, tracker);\n        return {\n            cookie_consent_level: getUserConsentLevel(),\n            event_tier_level: tierLevel,\n            user_properties: _st.util.extend(userInfo, getUserTierLevel(tierLevel))\n        };\n    };\n\n    var getUserTierLevel = function(tierLevel) {\n        if (tierLevel) {\n            return {\n                user_tier_level: tierLevel\n            };\n        } else {\n            return {};\n        }\n    };\n\n    var getUserInfo = function(userEnrolType, userSubscription, tracker) {\n        var userInfo = {};\n        if (tracker !== \"login\") {\n            userInfo.user_cookie_consent = getUserConsentLevel();\n        }\n        if (tracker === \"login\") {\n            if (userEnrolType) {\n                userInfo.user_enrol_type = userEnrolType;\n            }\n            if (userSubscription) {\n                userInfo.user_subscription = userSubscription;\n            }\n        }\n        return userInfo;\n    };\n\n    var getCustomTimestamp = function() {\n        var newTimestamp = {\n            custom_timestamp: new Date().getTime()\n        };\n        return newTimestamp;\n    };\n\n    var getUserConsentLevel = function() {\n        var consent = _st.cookiepermission.getCookiePreferences();\n        return consent[3] ? 3 : consent[2] ? 2 : 1;\n    };\n\n    var getRelay42Path = function() {\n        if (_st.core.getPageStructureString() && _st.core.getPageStructureString() !== '') {\n            return {\n                relay42_path: _st.core.getPageStructureString()\n            };\n        }\n        return {};\n    };\n\n    var getPersonalization = function(miData, gaData) {\n        var personalization = false;\n        if (miData.z_widget === 'nba') {\n            personalization = true;\n        }\n        if (gaData.impression === 'pre_fill_document' || gaData.event_action === 'scan_exist_manual') {\n            personalization = true;\n        }\n        return {\n            personalization: personalization\n        };\n    };\n\n    var sendEventView = function(data, tracker) {\n        if (_st.data.getProperty('z_converged').toLowerCase() === 'bw') {\n            DAS.euroConversion.addConvertedValueToDataLayer(data);\n            if (DAS.webchat) {\n                DAS.webchat.updateWebchatStatusToDataLayer();\n            }\n        }\n        var paxCount = getPassengerCount(data);\n        if (paxCount) {\n            data.z_passenger = paxCount;\n        }\n        setAncillaries(data);\n        var eventData = _st.util.extend(getEventMapping(data), getAncillaries(data));\n        var ga4Data = _st.util.extend(DAS.getGA4Mapping(data, tracker), eventData);\n        var dataToSend = removeAndTrimProperty(ga4Data);\n        dataToSend.event_count = 1;\n        dataToSend.hit_count = 1;\n        dataToSend.send_to = tracker === 'login' ? loginMeasurementID : klmMeasurementID;\n        if (dataToSend.z_currency && ['unknown', 'MILES'].indexOf(dataToSend.z_currency) === -1) {\n            dataToSend.currency = dataToSend.z_currency;\n        }\n        _st.util.extend(dataToSend, getCorrelationId());\n        _st.util.extend(dataToSend, getUserProperties(data, tracker));\n        _st.util.extend(dataToSend, getRelay42Path());\n        _st.util.extend(dataToSend, getCustomTimestamp());\n        _st.util.extend(dataToSend, getPersonalization(data, dataToSend));\n        _st.util.extend(dataToSend, setMandatoryParameterIncomplete(data, mandatoryParameters));\n\n        if (dataToSend.page_name === \"booking.confirmation\") {\n            _st.util.extend(dataToSend, setOutboundAndInboundData());\n        }\n\n        sendDataToQmon(data, mandatoryParameters);\n        window.gtag('event', 'web_event', dataToSend);\n    };\n\n    var removeAndTrimProperty = function(data) {\n        var result = {};\n        for (var key in data) {\n            var propertyValue = data[key];\n            if (typeof propertyValue === 'string') {\n                propertyValue = propertyValue.substring(0, 99);\n            }\n            if (removeProperty.indexOf(key) === -1) {\n                result[key] = propertyValue;\n            }\n        }\n        return result;\n    };\n\n    var getEventMapping = function(data) {\n        var result = {};\n        if (data) {\n            var miEvents = data.event && data.event.split('.');\n            result.event_label = data.z_eventvalue ? data.z_eventvalue : (miEvents && miEvents.length > 1) ? miEvents[0] : 'no label';\n            result.event_action = data.z_eventtype ? data.z_eventtype : data.z_event ? data.z_event : 'no action';\n            result.event_category = data.z_eventplace ? data.z_eventplace : (miEvents && miEvents.length > 1) ? miEvents[1] : 'no Category';\n            result.event = data.event;\n            result.z_event = data.z_event;\n\n        }\n        return result;\n    };\n\n    var getAncillaries = function(data) {\n        var ancillaries = sessionStorage.getItem(\"tms_ancillary_flow\");\n        if (ancillaries) {\n            return {\n                tms_ancillary_flow: ancillaries\n            };\n        } else {\n            return {};\n        }\n\n    };\n\n    var getPassengerCount = function(data) {\n        var z_passenger = 0;\n        var passengerParams = [\"z_nb_adults\", \"z_nb_children\", \"z_nb_seniors\", \"z_nb_of_students_minor\", \"z_nb_of_students_major\", \"z_nb_youth\", \"z_nb_youth_major\", \"z_nb_youth_minor\"];\n        passengerParams.forEach(function(passengerParam) {\n            if (data[passengerParam]) {\n                z_passenger += parseInt(data[passengerParam]);\n            }\n        });\n        return z_passenger;\n    };\n\n    var setAncillaries = function(data) {\n        if (data.tx_e === 'o' &&\n            (data.ti.indexOf(\"booking.confirmation\") !== -1 ||\n                (!sessionStorage.getItem(\"tms_ancillary_flow\") && data.ti.indexOf(\"trip.details\") !== -1))) {\n            var flow_name = data.z_flow_name;\n            var booking_motive = data.z_booking_motive;\n            var seperator = booking_motive ? '.' + booking_motive : '';\n            sessionStorage.setItem(\"tms_ancillary_flow\", flow_name + seperator);\n        }\n    };\n\n    var setMandatoryParameterIncomplete = function(data, mandatoryParameters) {\n        var isMandatoryParameterMissing = isMandatoryParameterIncomplete(data, mandatoryParameters);\n        if (isMandatoryParameterMissing) {\n            if (data.z_converged === undefined || data.z_converged === '' || data.z_converged === 'BW') {\n                return {\n                    param_incomplete: true\n                };\n            } else {\n                return {\n                    param_incomplete: false\n                };\n            }\n        } else {\n            return {\n                param_incomplete: false\n            };\n        }\n    };\n\n    var isMandatoryParameterIncomplete = function(data, mandatoryParameters) {\n        var isParamEmpty = false;\n        mandatoryParameters.forEach(function(param) {\n            if (data[param] === undefined || data[param] === '') {\n                isParamEmpty = true;\n            }\n        });\n        return isParamEmpty;\n    };\n\n    var isAllMandatoryParameterMisssing = function(data, mandatoryParameters) {\n        var isMissingAll = true;\n        mandatoryParameters.forEach(function(param) {\n            if (data[param] !== undefined && data[param] !== '') {\n                isMissingAll = false;\n            }\n        });\n        return isMissingAll;\n    };\n\n    var ischeckInGroupIdAvailable = function() {\n        return (_st.util.getUrlParam('checkingroupid') || _st.util.getUrlParam('checkInGroupId')) ? true : false;\n    };\n\n    var sendDataToQmon = function(data, mandatoryParameters) {\n        var qmonData = {};\n        _st.util.extend(qmonData, data);\n        _st.util.extend(qmonData, getCorrelationId());\n        _st.util.extend(qmonData, setMandatoryParameterIncomplete(qmonData, mandatoryParameters));\n        var isMandatoryMissingAny = isMandatoryParameterIncomplete(data, mandatoryParameters);\n        var isMandatoryAllMissing = isAllMandatoryParameterMisssing(data, mandatoryParameters);\n        var UTMURLParameters = getUTMURLParameters();\n\n        if (ischeckInGroupIdAvailable() && isMandatoryMissingAny) {\n            callDasQmonAPI(qmonData, 'checkInGroupId');\n        } else if (UTMURLParameters && JSON.stringify(UTMURLParameters) !== '{}' && isMandatoryMissingAny) {\n            callDasQmonAPI(qmonData, 'hasUTM');\n        } else if (isMandatoryAllMissing) {\n            callDasQmonAPI(qmonData, 'All_Missing');\n        } else if (isMandatoryMissingAny) {\n            callDasQmonAPI(qmonData, 'Some_Missing');\n        }\n    };\n\n    var callDasQmonAPI = function(data, eventName) {\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", \"https://dynamic.dimml.io/_/prod!87Rt6wSw@das.klm.com.qa/data?dimml.concept=/DataAPI___dasqueue\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json; charset=UTF-8\");\n        var body = JSON.stringify({\n            queue: '___dasqueue',\n            event: eventName,\n            element: data,\n            url: location.href\n        });\n        xhr.send(body);\n    };\n\n    var sendData = function(data, type, tracker) {\n        if (type === 'pageview') {\n            sendPageView(data, tracker);\n        } else {\n            sendEventView(data, tracker);\n        }\n    };\n\n    var loadScriptGtag = function(tracker) {\n        var measurementID = tracker === 'login' ? loginMeasurementID : klmMeasurementID;\n        var scriptInjectID = window.document.getElementById(measurementID);\n        if (!scriptInjectID) {\n            _st.inject.script(\"//www.googletagmanager.com/gtag/js?id=\" + measurementID, {\n                id: measurementID,\n                callback: function() {}\n            });\n            window.dataLayer = window.dataLayer || [];\n            window.gtag = function() {\n                window.dataLayer.push(arguments);\n            };\n            window.gtag(\"js\", new Date());\n\n            var cookiepermission = _st.cookiepermission.getCookiePreferences()[3];\n            var clientId = _st.util.getCookie('klm_id');\n            var converged = _st.data.getProperty('z_converged');\n            var campaignData = getCampaignData(tracker);\n\n            var getGoogleSignals = function() {\n                var isGoogleSignalAllowed = false;\n                if (cookiepermission) {\n                    isGoogleSignalAllowed = true;\n                }\n                if (converged === 'LNGP') {\n                    isGoogleSignalAllowed = false;\n                }\n                return isGoogleSignalAllowed;\n            };\n            var config = {\n                send_page_view: false,\n                allow_google_signals: getGoogleSignals()\n            };\n\n            if (clientId) {\n                _st.util.extend(config, {\n                    client_id: clientId\n                });\n            }\n\n            if (campaignData) {\n                _st.util.extend(config, campaignData);\n            }\n\n            if (tracker !== 'login') {\n                _st.util.extend(config, getGA4CookieDomainConfig());\n            }\n            window.gtag('config', measurementID, config);\n        }\n    };\n\n    var getCampaignData = function(tracker) {\n        var urlParamStr = _st.util.getUrlParam('WT.mc_id') || _st.util.getUrlParam('wt.mc_id');\n        var urlgclid = _st.util.getUrlParam('gclid');\n        var refParamStr = _st.util.getRefParam('WT.mc_id') || _st.util.getRefParam('wt.mc_id');\n        var refgclid = _st.util.getRefParam('gclid');\n        var measurementID = tracker === 'login' ? loginMeasurementID : klmMeasurementID;\n\n        if (urlgclid) {\n            sessionStorage.setItem(\"gclid\", urlgclid);\n        } else if (refgclid) {\n            sessionStorage.setItem(\"gclid\", refgclid);\n        }\n        var UTMURLParameters = getUTMURLParameters();\n\n        if (UTMURLParameters && JSON.stringify(UTMURLParameters) !== '{}') {\n            return UTMURLParameters;\n        } else if (urlParamStr && urlParamStr.indexOf('undefined') === -1 && !urlgclid && _st.cookiepermission.getCookiePreferences()[2]) {\n            return mapCampaignData(urlParamStr);\n        } else if (refParamStr && refParamStr.indexOf('undefined') === -1 && !refgclid && _st.cookiepermission.getCookiePreferences()[2]) {\n            return mapCampaignData(refParamStr);\n        }\n    };\n\n    var mapCampaignData = function(paramStr) {\n        var params = paramStr.split('_');\n        return {\n            campaign_id: params[6],\n            campaign_name: params[6],\n            campaign_source: params[3],\n            campaign_medium: params[2],\n            campaign_term: params[4] + '|' + params[1] + '|' + params[0],\n            campaign_content: params[5] + '|' + params[7]\n        };\n    };\n\n    var getMappedUTMParameters = function(utmObject) {\n        var currentURL = new URL(location.href);\n        var existingParams = Array.from(currentURL.searchParams.entries());\n        var utmParams = Object.entries(utmObject);\n        var paramsArray = existingParams.concat(utmParams);\n        var new_params = new URLSearchParams(paramsArray).toString();\n        var new_url = new URL(currentURL.origin + currentURL.pathname + '?' + new_params);\n        return {\n            page_location: new_url.href\n        };\n    };\n\n    var getUTMParameters = function(data, tracker) {\n        if (data.z_tracking) {\n            var urlParamStr = data.z_tracking['WT.mc_id'] || data.z_tracking['wt.mc_id'];\n            var urlgclid = data.z_tracking.gclid;\n            var measurementID = tracker === 'login' ? loginMeasurementID : klmMeasurementID;\n            if (urlParamStr && urlParamStr.indexOf('undefined') === -1 && !urlgclid && _st.cookiepermission.getCookiePreferences()[2]) {\n                return getMappedUTMParameters(mapCampaignData(urlParamStr));\n            }\n            if (data.z_tracking.utm_campaign) {\n                return getMappedUTMParameters(data.z_tracking);\n            }\n        } else {\n            return {};\n        }\n    };\n\n    var getUTMURLParameters = function() {\n        var utmParams = {};\n        if (_st.util.getUrlParam('utm_id')) {\n            _st.util.extend(utmParams, {\n                campaign_id: _st.util.getUrlParam('utm_id')\n            });\n        }\n        if (_st.util.getUrlParam('utm_source')) {\n            _st.util.extend(utmParams, {\n                campaign_source: _st.util.getUrlParam('utm_source')\n            });\n        }\n        if (_st.util.getUrlParam('utm_medium')) {\n            _st.util.extend(utmParams, {\n                campaign_medium: _st.util.getUrlParam('utm_medium')\n            });\n        }\n        if (_st.util.getUrlParam('utm_campaign')) {\n            _st.util.extend(utmParams, {\n                campaign_name: _st.util.getUrlParam('utm_campaign')\n            });\n        }\n        if (_st.util.getUrlParam('utm_term')) {\n            _st.util.extend(utmParams, {\n                campaign_term: _st.util.getUrlParam('utm_term')\n            });\n        }\n        if (_st.util.getUrlParam('utm_content')) {\n            _st.util.extend(utmParams, {\n                campaign_content: _st.util.getUrlParam('utm_content')\n            });\n        }\n        return utmParams;\n    };\n\n    window.DAS.sendGA4Data = function(data, type, tracker) {\n        tracker = tracker || 'kl';\n        try {\n            if (!window.gtag) {\n                loadScriptGtag(tracker);\n            }\n            sendData(data, type, tracker);\n        } catch (err) {\n            DAS.errors.push([tagName, err, 'ga4']);\n        }\n    };\n    loadScriptGtag('kl');\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1234,"version":12,"content":"(function(window, document) {\n    var tagName = 'Analytics - Universal - Initialize';\n    try {\n        // Load Universal Analytics using Google codeblock\n        if (!(window.ga && ga.loaded)) {\n            (function(i, s, o, g, r, a, m) {\n            i.GoogleAnalyticsObject = r;i[r] = i[r] || function() {\n            (i[r].q = i[r].q || []).push(arguments);};i[r].l = 1 * new Date();a = s.createElement(o);\n            m = s.getElementsByTagName(o)[0];a.async = 1;a.src = g; m.parentNode.insertBefore(a, m);\n            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');\n        }\n\n        // Define siteSpeedSampleRate to 100 for Blueweb, 25 for B2C\n        var sampleRate = _st.data.getProperty('z_converged') === 'bw' ? 100 : 25;\n\n        // Setup Tracker\n        ga('create', 'UA-44698027-1', {\n            'clientId':  _st.util.getCookie('klm_id'),\n            'siteSpeedSampleRate': sampleRate,\n            'legacyHistoryImport': false,\n            'allowLinker': true\n        });\n\n        if(_st.cookiepermission.getCookiePreferences()[3]) {\n            // get client id from GA tracker\n            var GAcid = '';\n            ga(function(tracker) {\n                GAcid = tracker.get('clientId');\n                // execute storeMapping if there is any valid client id e.g. 1576731351.1495454236\n                var key = 2005; // partnerType - do not modify!!\n                var regexGAcid = RegExp('^[0-9]+.[0-9]+$');\n                if (GAcid !== '' && regexGAcid.test(GAcid)) {\n                    _st.tracking.storeMapping(key, GAcid);\n                    _st.debug.log(\n                        'storeMapping executed for key:' +\n                            key +\n                            ' and value:' +\n                            GAcid\n                    );\n                } else {\n                    throw \"GA clientId doesn't contain a correct value : \" + GAcid;\n                }\n            });\n        }\n\n        // Only allow GA ad features when marketing cookies are accepted.\n        ga('set', 'allowAdFeatures', _st.cookiepermission.getCookiePreferences()[3]);\n        \n        //Anonymize IP\n        ga('set', 'anonymizeIp', true);\n\n        // Set default values\n        ga('set', 'dimension149', 'No Analytics-Universal tag'); // Relay Script name\n        ga('set', 'dimension46', '-'); // z_converged\n\n        // Set Relay42 Path\n        ga('set', 'dimension50', _st.core.getPageStructureString());\n\n        var gaCustomTask = function gaCustomTask(tracker) {\n            // Set Page URL at time of measurement\n            tracker.set('dimension157', document.location.href.substr(0,150));\n        };\n\n        // Set CustomTask function\n        ga('set', 'customTask', gaCustomTask);\n\n        // Override the GA tracking based on legacy Webtrends parameters when gclid is not present.\n        var urlParamStr = _st.util.getUrlParam('WT.mc_id') || _st.util.getUrlParam('wt.mc_id');\n        var urlgclid = _st.util.getUrlParam('gclid');\n        var refParamStr = _st.util.getRefParam('WT.mc_id') || _st.util.getRefParam('wt.mc_id');\n        var refgclid = _st.util.getRefParam('gclid');\n\n        var mapWebtrendsParameters = function mapWebtrendsParameters(paramStr) {\n            var params = paramStr.split('_');\n            ga('set', 'campaignSource', params[3]);\n            ga('set', 'campaignMedium', params[2]);\n            ga('set', 'campaignName', params[6]);\n            ga('set', 'campaignContent', params[5]+ '|' + params[7]);\n            ga('set', 'campaignKeyword', params[4]+ '|'+ params[1]+ '|'+ params[0]);\n            ga('set', 'dimension105', paramStr);\n        };\n\n        if(urlParamStr && urlParamStr.indexOf('undefined') === -1 && !urlgclid && _st.cookiepermission.getCookiePreferences()[2]) {\n            mapWebtrendsParameters(urlParamStr);\n        // Check for parameters in referrer in case of Redirects\n        } else if (refParamStr && refParamStr.indexOf('undefined') === -1 && !refgclid && _st.cookiepermission.getCookiePreferences()[2]) {\n            mapWebtrendsParameters(refParamStr);\n        }\n\n        // Fill GA dimension 117 with the Webtrends Parameter wt.tsrc (trafficsource)\n        var urlTsrc = _st.util.getUrlParam('Wt.tsrc') || _st.util.getUrlParam('wt.tsrc');\n        var refTsrc = _st.util.getRefParam('Wt.tsrc') || _st.util.getRefParam('wt.tsrc');\n\n        if (urlTsrc && urlTsrc.indexOf('undefined') === -1) {\n            ga('set', 'dimension117', urlTsrc);\n        } else if (refTsrc && refTsrc.indexOf('undefined') === -1) {\n            ga('set', 'dimension117', refTsrc);\n        }\n\n        // Fill GA dimension 111 with the Webtrends Parameter wt.seg_3 (Segmentation klm nteherlands)\n        var urlParam_seg_3 = _st.util.getUrlParam('Wt.seg_3') || _st.util.getUrlParam('wt.seg_3');\n        if (urlParam_seg_3 && urlParam_seg_3.indexOf('undefined') === -1) {\n            ga('set', 'dimension111', urlParam_seg_3);\n        }\n    }\n    catch(e) {\n        DAS.errors.push([tagName, e, 'ga3']);\n    }\n})(window, document);\n","group":1},{"markerCondition":"[]","selector":"head","id":607,"version":714,"content":"(function(){var g={z_application:{ga:\"dimension9\",persistent:!0},ti:{ga:\"dimension10\",operation:function(b){ga(\"set\",\"title\",b);ga(\"set\",\"page\",\"/\"+b.split(\".\")[0].toUpperCase()+\"/\"+b);return b},persistent:!0},tms_bts_contract_name:{ga:\"dimension82\"},tms_ancillary_flow:{ga:\"dimension83\"},tms_value_in_miles:{ga:\"dimension94\"},z_country:{ga:\"dimension11\",operation:function(b){return b.toUpperCase()},persistent:!0},z_language:{ga:\"dimension12\",persistent:!0},z_day_before_flight:{ga:\"dimension13\"},z_parent_application:{ga:\"dimension3\"},\nz_parent_page_name:{ga:\"dimension41\"},z_stay_duration:{ga:\"dimension14\"},z_pos:{ga:\"dimension17\",operation:function(b){return b.toUpperCase()}},Region:{ga:\"dimension83\"},z_umnr:{ga:\"dimension87\"},z_reason:{ga:\"dimension87\"},cg_n:{ga:\"dimension18\",operation:function(b,a){return a.contentGroup1=b}},cg_s:{ga:\"dimension19\",operation:function(b,a){return a.contentGroup4=b}},z_cabin_code:{ga:\"dimension20\"},z_outbound_cabin_code:{ga:\"dimension20\"},z_inbound_cabin_code:{ga:\"dimension198\"},z_origin:{ga:\"dimension21\"},\nz_destination:{ga:\"dimension22\"},z_flight_nr:{ga:\"dimension23\"},z_subscription:{ga:\"dimension24\"},z_departure_date:{ga:\"dimension25\"},z_return_date:{ga:\"dimension26\"},z_trip_type:{ga:\"dimension27\"},z_nb_adults:{ga:\"dimension28\",operation:function(b,a){a.dimension132=a.dimension132+b||b;return b}},z_nb_children:{ga:\"dimension29\",operation:function(b,a){a.dimension132=a.dimension132+b||b;return b}},z_nb_infants:{ga:\"dimension30\"},z_haul:{ga:\"dimension31\"},pn_sku:{ga:\"dimension32\"},z_is_FB_logged_user:{ga:\"dimension33\"},\nz_is_MYA_logged_user:{ga:\"dimension34\"},z_error_errorcode:{ga:\"dimension35\"},z_error_errordescription:{ga:\"dimension36\"},z_pagetype:{ga:\"dimension39\"},z_impr_ref:{ga:\"dimension40\"},z_enrol_type:{ga:\"dimension45\"},z_converged:{ga:\"dimension46\",persistent:!0},z_payment_method:{ga:\"dimension47\"},z_perf_apisupport:{ga:\"dimension49\"},z_used_miles:{ga:\"dimension51\"},z_max_in_miles:{ga:\"dimension52\"},z_cash_amount:{ga:\"dimension53\"},z_available_miles:{ga:\"dimension54\"},dl:{ga:\"dimension55\"},z_event:{ga:\"dimension56\"},\nz_eventplace:{ga:\"dimension57\"},z_eventvalue:{ga:\"dimension58\",operation:function(b){return String(b).trim()}},z_eventtype:{ga:\"dimension59\"},event:{ga:\"dimension60\"},z_error_severity:{ga:\"dimension61\"},z_ffp_tier_level:{ga:\"dimension62\"},z_payment_type:{ga:\"dimension63\"},z_pay_currency:{ga:\"dimension64\"},z_outbound_fare_selected:{ga:\"dimension65\",operation:function(b,a){return a.dimension123=b}},tms_outboundfare:{ga:\"dimension65\",operation:function(b,a){return a.dimension123=b}},z_inbound_fare_selected:{ga:\"dimension66\",\noperation:function(b,a){return a.dimension124=b}},tms_inboundfare:{ga:\"dimension66\",operation:function(b,a){return a.dimension124=b}},z_outbound_best_fare_offered:{ga:\"dimension67\"},z_inbound_best_fare_offered:{ga:\"dimension68\"},z_checkin_passenger:{ga:\"dimension69\"},z_isproductissued:{ga:\"dimension70\"},z_outbound_subclass:{ga:\"dimension73\"},z_env:{ga:\"dimension79\"},z_inbound_subclass:{ga:\"dimension84\"},z_outbound_selected:{ga:\"dimension78\"},z_office:{ga:\"dimension89\"},z_host:{ga:\"dimension90\",persistent:!0},\nz_currency:{ga:\"dimension91\"},z_direct_flight:{ga:\"dimension92\"},z_itics_legs:{ga:\"dimension93\"},z_evoucherused:{ga:\"dimension95\"},z_pnr_total_value:{ga:\"dimension96\"},z_carrier_surcharge:{ga:\"dimension97\",operation:function(b,a){_st.data.getProperty(\"tms_converted_to_euros\").tms_net_traffic_revenue&&(a.metric37=_st.data.getProperty(\"tms_converted_to_euros\").tms_net_traffic_revenue);return b}},tx_e:{ga:\"dimension98\"},tx_u:{ga:\"dimension99\"},z_evouchercurrency:{ga:\"dimension100\"},tx_i:{ga:\"dimension101\"},\ntx_s:{ga:\"dimension102\"},z_pnr_sales_value:{ga:\"dimension104\"},\"wt.mc_id\":{ga:\"dimension105\",operation:function(b){var a=_st.data.getProperty(\"z_tracking\"),c=0<Object.keys(a).filter(function(f){return f.toLowerCase().match(\"utm_\")}).length;b&&!c&&!a.gclid&&_st.cookiepermission.getCookiePreferences()[2]&&(a=b.split(\"_\"),ga(\"set\",\"campaignSource\",a[3]),ga(\"set\",\"campaignMedium\",a[2]),ga(\"set\",\"campaignName\",a[6]),ga(\"set\",\"campaignContent\",a[5]+\"|\"+a[7]),ga(\"set\",\"campaignKeyword\",a[4]+\"|\"+a[1]+\"|\"+\na[0]));return b}},z_pnr_number:{ga:\"dimension106\"},z_pnr_code:{ga:\"dimension106\"},ad:{ga:\"dimension107\"},ac:{ga:\"dimension108\"},z_promo_click:{ga:\"dimension108\"},z_promo_display:{ga:\"dimension107\"},z_itics_cabin:{ga:\"dimension109\"},param_incomplete:{ga:\"dimension110\"},seg_3:{ga:\"dimension111\"},\"wt.seg_3\":{ga:\"dimension111\"},z_itics_stay_duration:{ga:\"dimension112\"},z_login:{ga:\"dimension113\"},z_evoucherremaining:{ga:\"dimension114\"},z_identification_type:{ga:\"dimension115\"},z_xtag:{ga:\"dimension116\"},\n\"wt.tsrc\":{ga:\"dimension117\"},z_login_method:{ga:\"dimension118\"},z_login_partner:{ga:\"dimension119\"},z_tax:{ga:\"dimension121\"},z_outbound_marketing_carrier:{ga:\"dimension71\"},z_outbound_operating_carrier:{ga:\"dimension72\"},z_inbound_marketing_carrier:{ga:\"dimension74\"},z_inbound_operating_carrier:{ga:\"dimension76\"},z_base_fare:{ga:\"dimension122\",operation:function(b,a){_st.data.getProperty(\"tms_converted_to_euros\").tms_net_traffic_revenue&&(a.metric37=_st.data.getProperty(\"tms_converted_to_euros\").tms_net_traffic_revenue);\nreturn b}},z_fare_attribute:{ga:\"dimension123\"},z_fare_type:{ga:\"dimension124\"},z_payment_status:{ga:\"dimension125\"},z_emd:{ga:\"dimension126\"},cg_s1:{ga:\"dimension127\",operation:function(b,a){return a.contentGroup5=b}},cg_s2:{ga:\"dimension128\"},z_booking_fee:{ga:\"dimension129\"},z_fare_basis:{ga:\"dimension130\"},z_sellingclass:{ga:\"dimension131\"},z_passenger:{ga:\"dimension132\"},z_issued_voucher:{ga:\"dimension133\"},officeid:{ga:\"dimension134\"},z_captcha:{ga:\"dimension136\"},si_n:{ga:\"dimension137\"},si_x:{ga:\"dimension138\"},\nz_inbound_selected:{ga:\"dimension139\"},tx_id:{ga:\"dimension141\"},tx_it:{ga:\"dimension142\"},tms_evouchertotalvalue:{ga:\"dimension143\"},z_evoucher:{ga:\"dimension144\"},z_evouchernbr:{ga:\"dimension145\"},z_evouchervalue:{ga:\"dimension146\"},tms_evouchertotalused:{ga:\"dimension147\"},tx_m:{ga:\"dimension150\"},z_widget:{ga:\"dimension153\"},z_outbound_flight_value:{ga:\"dimension154\"},z_app_version:{ga:\"dimension155\"},z_inbound_flight_value:{ga:\"dimension156\"},z_impression:{ga:\"dimension159\"},z_impr_price:{ga:\"dimension160\"},\nz_impr_status:{ga:\"dimension161\"},z_impr_miles:{ga:\"dimension162\"},z_type_of_contract:{ga:\"dimension163\"},z_recovery_type:{ga:\"dimension164\"},z_client_id:{ga:\"dimension165\"},z_flow_name:{ga:\"dimension166\"},z_signin:{ga:\"dimension167\"},z_contract_name:{ga:\"dimension168\"},z_corporate_contract:{ga:\"dimension169\"},z_fare_accuracy:{ga:\"dimension170\"},z_flowtype:{ga:\"dimension171\"},z_captcha_type:{ga:\"dimension174\"},z_msp:{ga:\"dimension176\"},z_channel:{ga:\"dimension177\"},z_booking_motive:{ga:\"dimension178\"},\nz_referrer:{ga:\"dimension179\"},z_referer:{ga:\"dimension179\"},z_redir:{ga:\"dimension180\"},z_flexibility_waiver:{ga:\"dimension191\"},z_booking_date:{ga:\"dimension197\"},tms_testcase:{ga:\"dimension199\"},tms_eventname:{ga:\"dimension38\"},utm_campaign:{ga:\"campaignName\"},utm_source:{ga:\"campaignSource\"},utm_medium:{ga:\"campaignMedium\"},utm_content:{ga:\"campaignContent\"},utm_term:{ga:\"campaignKeyword\"},z_perf_total:{ga:\"metric6\"},z_perf_dom_processing:{ga:\"metric7\"},z_perf_network:{ga:\"metric8\"},z_perf_page_rendering:{ga:\"metric9\"},\nz_perf_request_queuing:{ga:\"metric10\"},z_perf_web_application:{ga:\"metric11\"},gclid:{ga:null,operation:function(b,a){a.location=d(\"gclid\",b,a);sessionStorage.setItem(\"gclid\",b)}},gclsrc:{ga:null,operation:function(b,a){a.location=d(\"gclsrc\",b,a)}},dclid:{ga:null,operation:function(b,a){a.location=d(\"dclid\",b,a)}},z_tracking:{ga:null,operation:function(b,a){_st.cookiepermission.getCookiePreferences()[2]&&_st.util.extend(a,DAS.UniversalAnalyticsMapping(b))}},z_correlation_id:{ga:\"dimension148\"},bw_correlation_id:{ga:\"dimension120\"},\nz_conversion_rates:{ga:null,operation:function(b,a){_st.data.getProperty(\"tms_conversion_rate_selected\")&&(a.metric32=_st.data.getProperty(\"tms_conversion_rate_selected\"))}},z_state_id:{ga:\"dimension195\"},z_seat_nr:{ga:\"dimension197\"},z_aircraft_config:{ga:\"dimension192\"}},d=function(b,a,c){b=b+\"\\x3d\"+a;a=document.location;c=c.location||a.protocol+\"//\"+a.hostname+a.pathname+a.search;a=-1!==c.indexOf(\"?\")?\"\\x26\":\"?\";ga(\"set\",\"location\",c+a+b);return c+a+b},e=function(){return g};DAS.mapping=DAS.mapping||\n{};DAS.mapping[\"default\"]=DAS.mapping[\"default\"]||{};DAS.mapping[\"default\"].getMapping=e;DAS.mapping.serverCookieTracker=DAS.mapping.serverCookieTracker||{};DAS.mapping.serverCookieTracker.getMapping=e})();"},{"markerCondition":"[]","selector":"head","id":1024,"version":76,"content":"(function(){var h=function(a){return String(a).split(\";\").reduce(function(b,d){return Number(b)+(Number(d)?Number(d):0)},0)},k=function(a){var b=_st.data.getProperty(\"tms_converted_to_euros\"),d=\"booking\"===a.z_flow_name;ga(\"ec:setAction\",\"purchase\",{id:d?a.z_pnr_number:Date.now(),affiliation:a.z_flow_name||a.z_flowtype||\"unknown\",revenue:a.z_currency?d?b.z_pnr_total_value:h(b.tx_s)||0:0,shipping:0,tax:a.z_currency?b.z_tax||0:0});g(a)},l=function(a){g(a);ga(\"ec:setAction\",\"click\",{list:a.z_flow_name})},\nm=function(){var a=[],b=[],d=[];try{var e=JSON.parse(sessionStorage.getItem(\"bwc-AncillariesShoppingCart\"))}catch(c){DAS.errors.push([tagName,c,\"ga3\"])}e&&Array.isArray(e.cartProducts)&&(e=e.cartProducts.map(function(c){if(c.sku&&c.priceGroup&&c.priceGroup.currentPrice&&c.priceGroup.currentPrice.amount&&c.priceGroup.currentPrice.currencyCode||c.displayPrice&&c.displayPrice.currencyCode)a.push(c.sku),d=c.bagCount?d.concat(c.bagCount):d.concat(1),b=c.priceGroup&&c.priceGroup.currentPrice?b.concat(c.priceGroup.currentPrice.amount):\nc.displayPrice?b.concat(c.displayPrice.amount):b.concat(0)}));return{tx_s:b.join(\";\"),tx_u:d.join(\";\"),pn_sku:a.join(\";\")}},g=function(a,b){var d=_st.data.getProperty(\"tms_converted_to_euros\");String(a.pn_sku).split(\";\").forEach(function(e,c){if(\"AIR\"===e)ga(\"ec:addProduct\",{id:e,name:e,category:\"booking\",price:a.z_currency?d.z_base_fare:0,brand:a.z_host,variant:a.z_booking_motive||\"OTHER\",quantity:1});else{var f=String(a.tx_u).split(\";\")[c]||0;c=\"checkout\"==b?String(a.tx_s).split(\";\")[c]||0:String(d.tx_s).split(\";\")[c]||\n0;ga(\"ec:addProduct\",{id:e,name:e,category:\"ancillary\",price:a.z_currency?Number(c)/Number(f)||0:0,brand:a.z_host,quantity:Number(f)})}})},n=function(a){ga(\"require\",\"ec\");a.z_currency?ga(\"set\",\"currencyCode\",\"EUR\"):DAS.errors.push([\"ecommerce\",\"Missing z_currency parameter in purchase related tag\",\"ga3\"])};DAS.handleEcommerce=function(a){if(a.pn_sku&&a.tx_s&&a.tx_u){n(a);\"p\"===a.tx_e&&(a.z_flowtype||\"booking\"===a.z_flow_name)&&k(a);if(\"a\"===a.tx_e)if(\"ancillaries\"===a.z_application)l(a);else if(a.ti&&\n-1!==a.ti.indexOf(\"payment\")&&\"0\"==a.dl){var b=Object.create(a),d=m(),e;for(e in d)b[e]=d[e];-1!==a.pn_sku.split(\";\").indexOf(\"AIR\")&&(a.pn_sku.split(\";\").map(function(c,f){\"AIR\"===c&&(b.price=a.tx_s.split(\";\")[f],b.quantity=a.tx_u.split(\";\")[f],b.z_base_fare=a.z_base_fare)}),b.pn_sku=b.pn_sku?b.pn_sku.split(\";\").concat(\"AIR\").join(\";\"):\"AIR\",b.tx_s=b.tx_s?b.tx_s.split(\";\").concat(b.price).join(\";\"):b.price,b.tx_u=b.tx_u?b.tx_u.split(\";\").concat(b.quantity).join(\";\"):b.quantity,b.z_currency=_st.data.getProperty(\"z_currency\"));\nd=DAS.convertMonetaryParams(b);b.tx_s=d.tx_s;b.z_base_fare=d.z_base_fare;g(b,\"checkout\");ga(\"ec:setAction\",\"checkout\",{id:9})}\"d\"!==a.tx_e||\"ancillaries\"!==a.z_application||!a.z_flowtype&&\"booking\"!==a.z_flow_name||(g(a),ga(\"ec:setAction\",\"remove\"))}}})();"},{"markerCondition":"[]","selector":"head","id":146,"version":12,"content":"(function(){\n\t//if(document.location.href.indexOf('spreading') != -1){\n\t//\t\t_st.data.setMarker('landing','prospecting',+new Date() + (1000 * 60 * 60 * 24 * 30));\n\t//}\n\tif(document.location.href.indexOf('mc_id') != -1){\n\t\tvar urlParam;\n\t\t   \n\t\tif(_st.util.getUrlParam('WT.mc_id') && _st.util.getUrlParam('WT.mc_id').indexOf('undefined') < 0){\n\t\t\turlParam = _st.util.getUrlParam('WT.mc_id').split('_');\n\t\t}\n\t\telse if(_st.util.getUrlParam('wt.mc_id').indexOf('undefined') < 0) {\n\t\t\turlParam = _st.util.getUrlParam('wt.mc_id').split('_');\n\t\t}\n\t\tif (urlParam[2] !== undefined)\n\t\t{\n\t\t\tvar medium = urlParam[2].toLowerCase();\n\t\t\tif (medium == \"display\" || medium == \"video\")\n\t\t\t{\n\t\t\t\tif(document.location.href.indexOf('spreading') != -1){\n\t\t\t\t\t_st.data.setMarker('landing','prospecting',+new Date() + (1000 * 60 * 60 * 24 * 30));\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t_st.data.setMarker('landing','prospecting',+new Date() + (1000 * 60 * 60 * 24 * 30));\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t_st.data.setMarker('landing','prospecting',+new Date() + (1000 * 60 * 60 * 24 * 30));\n\t\t}\n\t}\n\telse\n\t{\n\t\t_st.data.setMarker('landing','prospecting',+new Date() + (1000 * 60 * 60 * 24 * 30));\n\t}\n})();"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":558,"version":119,"content":"if (!window.lightningjs) {\n    (function (c) {\n        function g(b, d) {\n            if (d) {\n                (d += (/\\?/.test(d) ? \"&\" : \"?\") + \"lv=1\");\n            }\n            if (!c[b]) {\n                (function () {\n                    var i = window,\n                        h = document,\n                        j = b,\n                        g = h.location.protocol,\n                        l = \"load\",\n                        k = 0;\n                    (function () {\n                        function b() {\n                            a.P(l);\n                            a.w = 1;\n                            c[j](\"_load\");\n                        }\n                        c[j] = function () {\n                            function m() {\n                                m.id = e;\n                                return c[j].apply(m, arguments);\n                            }\n                            var b, e = ++k;\n                            b = this && this != i ? this.id || 0 : 0;\n                            (a.s = a.s || []).push([e, b, arguments]);\n                            m.then = function (b, c, h) {\n                                var d = a.fh[e] = a.fh[e] || [],\n                                    j = a.eh[e] = a.eh[e] || [],\n                                    f = a.ph[e] = a.ph[e] || [];\n                                if (b) {\n                                    d.push(b);\n                                }\n                                if (c) {\n                                    j.push(c);\n                                }\n                                if (h) {\n                                    f.push(h);\n                                }\n                                return m;\n                            };\n                            return m;\n                        };\n                        var a = c[j]._ = {};\n                        a.fh = {};\n                        a.eh = {};\n                        a.ph = {};\n                        a.l = d ? d.replace(/^\\/\\//, (g == \"https:\" ? g : \"http:\") + \"//\") : d;\n                        a.p = {\n                            0: +new Date()\n                        };\n                        a.P = function (b) {\n                            a.p[b] = new Date() - a.p[0];\n                        };\n                        if (a.w) {\n                            b();\n                        }\n                        if (i.addEventListener) {\n                            i.addEventListener(l, b, !1);\n                        } else {\n                            i.attachEvent(\"on\" + l, b);\n                        }\n                        var q = function () {\n                            function b() {\n                                return [\"<head></head><\", c, ' onload=\"var d=', n, \";d.getElementsByTagName('head')[0].\", d, \"(d.\", g, \"('script')).\", i, \"='\", a.l, \"'\\\"></\", c, \">\"].join(\"\");\n                            }\n                            var c = \"body\",\n                                e = h[c];\n                            if (!e) return setTimeout(q, 100);\n                            a.P(1);\n                            var d = \"appendChild\",\n                                g = \"createElement\",\n                                i = \"src\",\n                                k = h[g](\"div\"),\n                                l = k[d](h[g](\"div\")),\n                                f = h[g](\"iframe\"),\n                                n = \"document\",\n                                p;\n                            k.style.display = \"none\";\n                            e.insertBefore(k, e.firstChild).id = o + \"-\" + j;\n                            f.frameBorder = \"0\";\n                            f.id = o + \"-frame-\" + j;\n                            if (/MSIE[ ]+6/.test(navigator.userAgent)) {\n                                (f[i] = \"javascript:false\");\n                            }\n                            f.allowTransparency = \"true\";\n                            l[d](f);\n                            try {\n                                f.contentWindow[n].open();\n                            } catch (s) {\n                                a.domain = h.domain;\n                                p = \"javascript:var d=\" + n + \".open();d.domain='\" + h.domain + \"';\";\n                                f[i] = p + \"void(0);\";\n                            }\n                            try {\n                                var r = f.contentWindow[n];\n                                r.write(b());\n                                r.close();\n                            } catch (t) {\n                                f[i] = p + 'd.write(\"' + b().replace(/\"/g, String.fromCharCode(92) + '\"') + '\");d.close();';\n                            }\n                            a.P(2);\n                        };\n                        if (a.l) {\n                            setTimeout(q, 0);\n                        }\n                    })();\n                })();\n            }\n            c[b].lv = \"1\";\n            return c[b];\n        }\n        var o = \"lightningjs\",\n            k = window[o] = g(o);\n        k.require = g;\n        k.modules = c;\n    })({});\n}\nif (_st.data.getProperty('z_language') === 'en') {\n    if (!navigator.userAgent.match(/Android|BlackBerry|BB10|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {\n        window.usabilla_live = lightningjs.require('usabilla_live', '//w.usabilla.com/' + '5279a42319e3' + '.js');\n    } else {\n        window.usabilla_live = lightningjs.require('usabilla_live', '//w.usabilla.com/' + '76564bba65bf' + '.js');\n    }\n} else if (_st.data.getProperty('z_language') === 'nl'){\n    if (!navigator.userAgent.match(/Android|BlackBerry|BB10|iPhone|iPad|iPod|Opera Mini|IEMobile/i)) {\n        window.usabilla_live = lightningjs.require('usabilla_live', '//w.usabilla.com/' + '896c4764dc93' + '.js');\n    } else {\n        window.usabilla_live = lightningjs.require('usabilla_live', '//w.usabilla.com/' + '62fdc4d6d625' + '.js');\n    }\n}\n_st.exec.delayed(function () {\n    var gaClientId;\n    if (window.ga) {\n        window.ga(function (tracker) { gaClientId = tracker.get('clientId'); });\n    }\n    window.usabilla_live(\"data\", {\n        'custom': {\n            'SessionID': _st.util.getCookie(\"AFKL_VISITOR_ID\"),\n            'PageTitle': _st.data.getProperty('ti'),\n            'z_country': _st.data.getProperty('z_country'),\n            'z_language': _st.data.getProperty('z_language'),\n            'z_application': _st.data.getProperty('z_application'),\n            'KLM_Tracking_ID': _st.util.getCookie('klm_tracking_id'),\n            'z_converged': _st.data.getProperty('z_converged'),\n            'TierLevel': _st.data.getProperty('z_ffp_tier_level'),\n            'Google Analytics Client ID': gaClientId || ''\n        }\n    });\n}, 4000);\n\nwindow.usabilla_live(\"setEventCallback\", function (category, action, label, value, userData) {\n    ga('dasTracker.set', 'dimension4', _st.data.getProperty('z_country'));\n    ga('dasTracker.set', 'dimension12', _st.data.getProperty('z_language'));\n    ga('dasTracker.set', 'dimension2', _st.data.getProperty('z_application'));\n    ga('dasTracker.set', 'dimension6', _st.data.getProperty('ti'));\n    ga('dasTracker.set', 'dimension17', _st.data.getProperty('z_converged'));\n    ga('dasTracker.set', 'dimension20', document.location.href.substr(0,150));\n    if (action === 'Feedback:Open') {   \n        ga('dasTracker.send', {\n                    'hitType': 'event',\n                    'eventCategory': 'Usabilla Live',\n                    'eventAction': action,\n                    'eventLabel': maskPersonalData(label),\n                    'eventValue': value,\n                    'dimension149': 'Usabilla'\n        });\n    }\n    if (action === 'Feedback:Success') {\n        ga('dasTracker.send', {\n                    'hitType': 'event',\n                    'eventCategory': 'Usabilla Live',\n                    'eventAction': action,\n                    'eventLabel': maskPersonalData(label),\n                    'eventValue': value,\n                    'dimension149': 'Usabilla'\n        });\n    }\n    if (action === 'Campaign:Open') {\n        ga('dasTracker.send', {\n                    'hitType': 'event',\n                    'eventCategory': 'Usabilla Live',\n                    'eventAction': action,\n                    'eventLabel': maskPersonalData(label),\n                    'eventValue': value,\n                    'dimension149': 'Usabilla'\n        });\n    }\n    if (action === 'Campaign:Success') {\n        ga('dasTracker.send', {\n                    'hitType': 'event',\n                    'eventCategory': 'Usabilla Live',\n                    'eventAction': action,\n                    'eventLabel': maskPersonalData(label),\n                    'eventValue': value,\n                    'dimension149': 'Usabilla'\n        });\n    }\n    \n    // Google Analytics Additional Campaign Integration\n    if (window.ga) {\n        if (action === 'Campaign:Page Switch' && userData && userData.data) {\n            Object.keys(userData.data).forEach(function (answer) {\n                ga('send', {\n                    'hitType': 'event',\n                    'eventCategory': 'Usabilla Live',\n                    'eventAction': 'Campaign:Answers',\n                    'eventLabel': label + ' - ' + answer + ': ' + userData.data[answer],\n                    'dimension149': 'Usabilla BW'\n                });\n            });\n        }\n    }\n    function maskPersonalData(comment) {\n        if(!comment) {\n            return comment;\n        }\n        // Concat Regex\n        var ibanValidatorRegex = /AL\\d{10}[0-9A-Z]{16}$|^AD\\d{10}[0-9A-Z]{12}$|^AT\\d{18}$|^BH\\d{2}[A-Z]{4}[0-9A-Z]{14}$|^BE\\d{14}$|^BA\\d{18}$|^BG\\d{2}[A-Z]{4}\\d{6}[0-9A-Z]{8}$|^HR\\d{19}$|^CY\\d{10}[0-9A-Z]{16}$|^CZ\\d{22}$|^DK\\d{16}$|^FO\\d{16}$|^GL\\d{16}$|^DO\\d{2}[0-9A-Z]{4}\\d{20}$|^EE\\d{18}$|^FI\\d{16}$|^FR\\d{12}[0-9A-Z]{11}\\d{2}$|^GE\\d{2}[A-Z]{2}\\d{16}$|^DE\\d{20}$|^GI\\d{2}[A-Z]{4}[0-9A-Z]{15}$|^GR\\d{9}[0-9A-Z]{16}$|^HU\\d{26}$|^IS\\d{24}$|^IE\\d{2}[A-Z]{4}\\d{14}$|^IL\\d{21}$|^IT\\d{2}[A-Z]\\d{10}[0-9A-Z]{12}$|^[A-Z]{2}\\d{5}[0-9A-Z]{13}$|^KW\\d{2}[A-Z]{4}22!$|^LV\\d{2}[A-Z]{4}[0-9A-Z]{13}$|^LB\\d{6}[0-9A-Z]{20}$|^LI\\d{7}[0-9A-Z]{12}$|^LT\\d{18}$|^LU\\d{5}[0-9A-Z]{13}$|^MK\\d{5}[0-9A-Z]{10}\\d{2}$|^MT\\d{2}[A-Z]{4}\\d{5}[0-9A-Z]{18}$|^MR13\\d{23}$|^MU\\d{2}[A-Z]{4}\\d{19}[A-Z]{3}$|^MC\\d{12}[0-9A-Z]{11}\\d{2}$|^ME\\d{20}$|^NL\\d{2}[A-Z]{4}\\d{10}$|^NO\\d{13}$|^PL\\d{10}[0-9A-Z]{,16}n$|^PT\\d{23}$|^RO\\d{2}[A-Z]{4}[0-9A-Z]{16}$|^SM\\d{2}[A-Z]\\d{10}[0-9A-Z]{12}$|^SA\\d{4}[0-9A-Z]{18}$|^RS\\d{20}$|^SK\\d{22}$|^SI\\d{17}$|^ES\\d{22}$|^SE\\d{22}$|^CH\\d{7}[0-9A-Z]/gm;\n        var phoneValidatorRegex = /\\(?([0-9]{3})\\)?([ .-]?)([0-9]{3})\\2([0-9]{4})/gm;\n        var emailValidator = /[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\\.[a-zA-Z0-9-]+)*/gm;\n        var pnrValidator = /[\\s|\\.|\\-|\\:][A-Z0-9]{5,6}[\\s|\\.]/gm;\n        var label = comment.replace(ibanValidatorRegex, \"IbanMasked\");\n        label = label.replace(phoneValidatorRegex, \"PhoneNumberMasked\");\n        label = label.replace(emailValidator, \"EmailMasked\");\n        label = label.replace(pnrValidator, \"PnrMasked\");\n        return label;\n    }\n    function sendReplacement(vData) {\n        var data = JSON.parse(vData);\n        data.comment = maskPersonalData(data.comment);\n        vData = JSON.stringify(data);\n        realSend.apply(this, arguments);\n    }\n\n    /**\n     * Send replacement request to Usabilla that contains the masked feedback.\n     */\n    var realSend = XMLHttpRequest.prototype.send;\n    ub_window = document.getElementById(\"lightningjs-frame-usabilla_live_feedback\").contentWindow;\n    ub_window.XMLHttpRequest.prototype.send = sendReplacement;\n    if (window.XDomainRequest) {\n        realSend = XDomainRequest.prototype.send;\n        ub_window.XDomainRequest.prototype.send = sendReplacement;\n    }\n});","group":2},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":41,"version":274,"content":"(function () {\n\t'use strict';\n    var tagName = 'Analytics - Universal - Pageview';\n\t\n\tvar loadGA3Pageview = function() {\n\t\tvar property = { tracker: '', tagNameDim: 'dimension149'};\n\t\tDAS.sendPageView(property);\n\t};\n\t\n\tloadGA3Pageview();\n})();\n","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":602,"version":412,"content":"_st.event.subscribe('', '', function (category, name, data) {\n\tvar property = { tracker: '', tagNameDim: 'dimension149'};\n\tif(['QM/', 'gtm_configured/', 'ignore_domains/'].indexOf(category) === -1) {\n\t\tDAS.sendEvents(category, name, data, property);\n\t}\n});","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1251,"version":19,"content":"(function () {\n\n    var tagName = 'Analytics-GA4-Ecommerce';\n\n\n    var sumTx_s = function sumTx_s(tx_s) {\n        return String(tx_s).split(';').reduce(function (total, current) {\n            return Number(total) + (Number(current) ? Number(current) : 0);\n        }, 0);\n    };\n\n    var ecommercePurchase = function(data, ga4MappedData) {\n        var convertedValues = _st.data.getProperty('tms_converted_to_euros');\n        var isBooking = data.z_flow_name === 'booking';\n        var isRewardMotiveBooking = data.z_booking_motive === 'REWARD';\n        var transcationValue = data.z_currency ? getTranscationValue(isBooking, isRewardMotiveBooking, convertedValues) : 0;\n\n        var items = ecommerceProducts(data);\n        var purchaseData = {\n            'transaction_id': isBooking ? data.z_pnr_number : Date.now(),\n            'value': transcationValue,\n            'shipping': 0,\n            'tax': data.z_currency ? convertedValues.z_tax || 0 : 0,\n            'currency': 'EUR',\n            'items': items\n        };\n\n        gtag(\"event\", \"purchase\", _st.util.extend(purchaseData, ga4MappedData));\n    };\n\n    var getTranscationValue = function(isBooking, isRewardMotiveBooking, convertedValues) {\n        if(isBooking && isRewardMotiveBooking) {\n            return sumTx_s(convertedValues.tx_s); \n        }\n        if(isBooking) {\n            return convertedValues.z_pnr_total_value;\n        } else {\n            return sumTx_s(convertedValues.tx_s); \n        }\n    };\n\n    var ecommerceProductClick = function ecommerceProductClick(data, ga4MappedData) {\n        var items = ecommerceProducts(data);\n        var productClickData = {\n          'item_list_id': data.z_flow_name,\n          'item_list_name': data.z_flow_name,\n          'items':items\n        };\n        gtag(\"event\", \"select_item\", _st.util.extend(productClickData, ga4MappedData));\n    };\n\n    var ecommerceProductCheckout = function ecommerceProductCheckout(data, ga4MappedData) {\n        var isBooking = data.z_flow_name === 'booking';\n        var convertedValues = _st.data.getProperty('tms_converted_to_euros');\n        var items = ecommerceProducts(data);\n        var beginCheckoutData = {\n            'currency': 'EUR',\n            'value': data.z_currency ? isBooking ? convertedValues.z_pnr_total_value : sumTx_s(convertedValues.tx_s) || 0 : 0,\n            'items': items\n        };\n        gtag(\"event\", \"begin_checkout\", _st.util.extend(beginCheckoutData, ga4MappedData));\n    };\n\n    var ecommerceRemoveFromCart = function ecommerceRemoveFromCart(data, ga4MappedData) {\n        var isBooking = data.z_flow_name === 'booking';\n        var convertedValues = _st.data.getProperty('tms_converted_to_euros');\n        var items = ecommerceProducts(data);\n        var removeCartData = {\n            'currency': 'EUR',\n            'value': data.z_currency ? isBooking ? convertedValues.z_pnr_total_value : sumTx_s(convertedValues.tx_s) || 0 : 0,\n            'items': items\n        };\n        gtag(\"event\", \"remove_from_cart\", _st.util.extend(removeCartData, ga4MappedData));\n    };\n\n    var ecommerceProducts = function ecommerceProducts(data, action) {\n        // Get converted value for revenue & tax\n        var items = [];\n        var convertedValues = _st.data.getProperty('tms_converted_to_euros');\n        String(data.pn_sku).split(';').forEach(function (product, index) {\n            if (product === 'AIR') {\n                // Bookings\n\n                items.push({\n                    'item_id': product,\n                    'item_name': product,\n                    'affiliation': data.z_flow_name || data.z_flowtype || 'unknown',\n                    'item_category': 'booking',\n                    'currency': 'EUR',\n                    'price': data.z_currency ? convertedValues.z_base_fare: 0,\n                    'item_brand': data.z_host,\n                    'item_variant': data.z_booking_motive || 'OTHER',\n                    'quantity': 1\n                });\n\n            } else {\n                var quantity = String(data.tx_u).split(';')[index] || 0;\n                var price = 0;\n                // Ancillaries get the values from the euro converted object.\n                if (action == 'checkout') {\n                    price = String(data.tx_s).split(';')[index] || 0;\n                } else {\n                    price = String(convertedValues.tx_s).split(';')[index] || 0;\n                }\n                items.push({\n                    'item_id': product,\n                    'item_name': product,\n                    'affiliation': data.z_flow_name || data.z_flowtype || 'unknown',\n                    'item_category': 'ancillary',\n                    'currency': 'EUR',\n                    'price': data.z_currency ? (Number(price) / Number(quantity)) || 0 : 0,\n                    'item_brand': data.z_host,\n                    'item_variant': data.z_booking_motive || 'OTHER',\n                    'quantity': Number(quantity)\n                });\n            }\n        });\n        return items;\n    };\n\n    DAS.handleGA4Ecommerce = function handleGA4Ecommerce(data, ga4MappedData) {\n\n        if (data.pn_sku && data.tx_s && data.tx_u) {\n            if (!data.z_currency) {\n                DAS.errors.push(['Analytics-GA4-Ecommerce', 'Missing z_currency parameter in purchase related tag', 'ga4']);\n            }\n            if (data.tx_e === 'p') {\n                if (data.z_flowtype || data.z_flow_name === 'booking') {\n                    // Blueweb ticket & ancillary purchases                    \n                    ecommercePurchase(data, ga4MappedData);\n                }\n            }\n            if (data.tx_e === 'a') {\n                if (data.z_application === 'ancillaries') {\n                    // Blueweb ancillary product clicks\n                    ecommerceProductClick(data, ga4MappedData);\n                } else if (data.ti && data.ti.indexOf('payment') !== -1 && data.dl == \"0\") {\n                    // Blueweb ticket & ancillary product checkout\n                    ecommerceProductCheckout(data, ga4MappedData);\n                }\n            } \n            if (data.tx_e === 'd' && (data.z_application === 'ancillaries')) {\n                if (data.z_flowtype || data.z_flow_name === 'booking') {\n                    // Blueweb ticket & ancillary product clicks\n                    ecommerceRemoveFromCart(data, ga4MappedData);\n                }\n            }\n        }\n\n    };\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1247,"version":23,"content":"(function() {\n\tvar data = _st.util.extend(_st.util.extend({}, _st.data._localTagProperties), _st.data._tagProperties);\n\tdata.tms_testcase = 'GA3-GA4_1';\n\t//data.tms_custom_timestamp = new Date().getTime();\n\tvar tracker = 'kl';\n\tDAS.sendGA4Data(data, 'pageview', tracker);\n})();\n","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1248,"version":12,"content":"(function() {\n    _st.event.subscribe('', '', function (category, name, data) {\n\t\tdata.tms_testcase = 'GA3-GA4_1';\n\t\t//data.tms_custom_timestamp = new Date().getTime();\n\t\tvar tracker = 'kl';\n\t\tif(['QM/', 'gtm_configured/', 'ignore_domains/'].indexOf(category) === -1) {\n\t\t\tDAS.sendGA4Data(data, 'event', tracker);\n\t\t}\n\t});\n})();\n        ","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":671,"version":7,"content":"(function() {\n\tif (Boolean(_st.data.getProperty('z_gin'))) {\n\t\t_st.tracking.storeMapping(2002, _st.data.getProperty('z_gin'), 2);\n\t}\n})();\n        ","group":1},{"execValue2":"visit_calendar","markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":771,"execValue":"EBT7.calendar.visit_calendar","version":16,"content":"(function(){\n\t \n\tvar CAPI=false;\n\t\n\tif(_st.data.getCustomMarker('customer','yes')){\n\t\tCAPI=true;\n\t}\n\t\n_st.inject.script(\"//www.googletagmanager.com/gtag/js?id=AW-980474582\", { callback: function() {\n\t  \twindow.dataLayer = window.dataLayer || [];\n \t\tfunction gtag(){dataLayer.push(arguments);}\n  \t\tgtag('js', new Date());\n\n\tfunction checkPrice(x){ \n\t\tif(x <=250) {\n\t\t\treturn 'A';\n\t\t} else if(x > 250 && x <= 500){\n\t\t\treturn 'B';\n\t\t} else if(x > 500 && x <= 1000){\n\t\t\treturn 'C';\n\t\t} else if(x > 1000 && x <= 1500){\n\t\t\treturn 'D';\n\t\t} else if(x > 1500 && x <= 2500){\n\t\t\treturn 'E';\n\t\t} else if(x > 2500 && x <= 5000){\n\t\t\treturn 'F';\n\t\t} else if(x > 5000){\n\t\t\treturn 'G';\n\t\t}\n\t}\n\tvar perAdult = checkPrice((parseFloat(_st.data.getProperty('z_deeplink_actualprice'))) / (parseFloat(_st.data.getProperty('z_nb_adults'))));\n\tvar total = checkPrice(parseFloat(_st.data.getProperty('z_deeplink_actualprice')));\n\t\n\tif(!perAdult){perAdult = 'N/A';}\n\tif(!total){total = 'N/A';}\n\t//get experiment data\n\tvar experimentId = '149';\n\tvar groups = {};\n\tgroups['150'] = 'Control_Group';\n\tgroups['151'] = 'Display_Group';\n\tgroups['152'] = 'GDN_Group';\n\tgroups['153'] = 'Display-GDN_Group';\n\tvar store_group = \"\";\n\t\n\tif(_st.data.getUserData() !== undefined &&\n\t   _st.data.getUserData().e !== undefined &&\n\t   _st.data.getUserData().e[experimentId] !== undefined) {\n\n\t\tvar groupName = groups[_st.data.getUserData().e[experimentId].group];\n\t\tif(groupName !== undefined) {\n\t\t\tstore_group = groupName;\n\t\t}\n\t}\n\t\n\t  gtag('event', 'page_view', {\n    \t\t'send_to': 'AW-1068849169',\n\t\t\t'flight_pagetype': 'home',\n\t\t\t'POS': _st.data.getProperty('country')+\"_\"+_st.data.getProperty('language'),\n\t\t\t'flight_destid': _st.data.getProperty('z_destination'),\n\t\t\t'flight_originid': _st.data.getProperty('z_origin'),\n\t\t\t'numberAdults':_st.data.getProperty('z_nb_adults'),\n\t\t\t'numberChildren':_st.data.getProperty('z_nb_children'),\n\t\t\t'numberInfant':_st.data.getProperty('z_nb_infants'),\n\t\t\t'bookingClass':_st.data.getProperty('z_Travel_class'),\n\t\t\t'departureDate':_st.data.getProperty('z_departure_date'),\n\t\t\t'returnDate':_st.data.getProperty('z_return_date'),\n\t\t\t'flight_startdate': _st.data.getProperty('z_departure_date'),\n\t\t\t'flight_enddate':_st.data.getProperty('z_return_date'),\n\t\t\t'flight_totalvalue': _st.data.getProperty('pnr_sales_value'),\n\t\t\t'duration':_st.data.getProperty('z_stay_duration'),\n\t\t\t'potentialBookingValuePerAdult':perAdult,\n\t\t\t'potentialBookingValueTotal':total,\n\t\t\t'CAPI': CAPI,\n\t\t\t'GDN_Exp': store_group\n\t\t});\n}});\n})();","exec":"event","group":3},{"execValue2":"play_now","markerCondition":"[]","selector":"head","id":786,"execValue":"home","version":4,"content":"(function(){\n\n\tvar elements = _st.util.getElements(\".orange:eq(0)\");\n\tvar publishFunction = function(event) {\n\t\t_st.event.publish('home', 'play_now', { elements: elements, clicked:this,event:event});\n\t};\n\t\n\tif( typeof elements != 'undefined' && elements.length > 0 ){\n\t\tfor(var i = 0; i < elements.length; i++){\n\t\t\tvar e = elements[i];\n\t\t\tif( e.addEventListener ){\n\t\t\t\te.addEventListener( \"click\", publishFunction, false );\n\t\t\t} else if( e.attachEvent ){\n\t\t\t\te.attachEvent( \"onclick\", publishFunction );\n\t\t\t}\n\t\t}\n\t}\n})();","exec":"event"},{"markerCondition":"[]","loadDefault":true,"groupReverse":false,"selector":"head","id":794,"version":3,"content":"(function(){\n\n\tvar elements = _st.util.getElements(\".orange\");\n\tvar publishFunction = function(event) {\n\t\t_st.event.publish('Souvenier', 'go_to_klm.com', { elements: elements, clicked:this,event:event});\n\t};\n\t\n\tif( typeof elements != 'undefined' && elements.length > 0 ){\n\t\tfor(var i = 0; i < elements.length; i++){\n\t\t\tvar e = elements[i];\n\t\t\tif( e.addEventListener ){\n\t\t\t\te.addEventListener( \"click\", publishFunction, false );\n\t\t\t} else if( e.attachEvent ){\n\t\t\t\te.attachEvent( \"onclick\", publishFunction );\n\t\t\t}\n\t\t}\n\t}\n})();","exec":"onready","group":2},{"execValue2":"changeCookiePref","markerCondition":"[]","selector":"head","id":1006,"execValue":"cookiepref/","version":59,"content":"(function () {\n    _st.event.subscribe('cookiepref/', 'changeCookiePref', function (name, category, data) {\n        var app_clientID = [\n            'dj2pn954nny34g93w5u3m3ev', //Android ITE1\n            'dj2p****************m3ev', //Android ITE1\n            'nfuf9p2s6wm3cgh4xnyw6pw2', //Android UTE1\n            'nfuf****************6pw2', //Android UTE1\n            'fm8nf4uyszqe76fbrmxxqwzg', //Android UTE1\n            '8snm499z956xgpj686t38c9m', //Android UTE1  \n            '8snm****************8c9m', //Android UTE1\n            'cvt9ezsd7n7b2n6qbz83czzw', //Android UTE2\n            'cvt9****************czzw', //Android UTE2\n            '56jg6p29emu5as8gqh3gduuk', //Android UTE2\n            'auvfdyhp8vjwcbfsdq95x9aq', //Android UTE2\n            'auvf****************x9aq', //Android UTE2\n            'n7anb953xmqvfvercad4evtf', //Android UTE3\n            'n7an****************evtf', //Android UTE3\n            '6hqrts4uwhq5unrsfrjh2kus', //Android UTE3\n            'dmgbnz8qhr34xbb9rpzr7etr', //Android UTE3\n            'dmgb****************7etr', //Android UTE3\n            '3pnkwn76s6r7y3twx772yjuf', //Android Huawei B2C\n            '4u4cm6vec593385qfqpk9ajh', //LE\n            'q2cbejvwc4zcsxzq9qkj4tv7', //LE\n            'q2cb****************4tv7', //LE\n            '4pm9rktn3a689dy6593r29vr', //LE\n            '4pm9****************29vr', //LE\n            'x4cacjmgjre7qrkcc5ky8zdk', //LE\n            'x4ca****************8zdk', //LE\n            '7h7cgfa9qdr5d9hw9jcwrzjc', //iOS UTE1\n            '7h7c****************rzjc', //iOS UTE1\n            'wye5g8mt9k9jwmqnrbd69xqd', //iOS UTE1\n            '8qjabpqf4n8xpeerxnctmcr3', //iOS UTE1\n            '8qja****************mcr3', //iOS UTE1\n            'd8bmwu4c4htw9gqehdtg4rpk', //iOS UTE2\n            'd8bm****************4rpk', //iOS UTE2\n            'cagpmk6h2gq3efp4yq6ud8eg', //iOS UTE2\n            'ma583ge29vbmg7fpd8f8xazr', //iOS UTE2\n            'ma58****************xazr', //iOS UTE2\n            '72xk3fxvenybcm4hkvrv38r3', //iOS UTE3\n            '72xk****************38r3', //iOS UTE3\n            'yp3xpcx47crvgwnakrvsdw25', //iOS UTE3\n            'wtp7h7uvfzj9nwqvscbgmf5z', //iOS UTE3\n            'wtp7****************mf5z', //iOS UTE3\n            'pq94bkm87y78s9xq2frrwbgp', //iOS APP Prod\n            'pq94****************wbgp', //iOS APP Prod\n            'w53y7kv97nbcdmgmkr9watkj', //iOS APP Prod\n            'w53y****************atkj', //iOS APP Prod\n            'kkb62wfgeggk469t6htbhfus', //iOS APP Prod\n            'w53y7kv97nbcdmgmkr9watkj',\n        ];\n        if (app_clientID.indexOf(_st.data.getProperty('z_client_id')) === -1) {\n            var cookieBarCheck = document.getElementById('cookiebarModal');\n            var cookieBarJs = document.getElementById('cookie-bar-js');\n            var cookieBarCss = document.getElementById('cookie-bar-css');\n            if (!cookieBarCheck || cookieBarCheck === undefined || cookieBarCheck === null) {\n                if(!cookieBarCss) {\n                    _st.inject.style(\"https://a.svtrd.com/media/s/135/24/cookiebar_tls.css\", {id:'cookie-bar-css'});\n                }\n                _st.inject.html('<!DOCTYPE html><html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\"><head> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> </head><body> <div class=\"cookiebar-modal\" id=\"cookiebarModal\"> <div class=\"cookiebar-container\" id=\"cookiebarContainer\"> <div class=\"klm-logo-section\"> <header id=\"logo\"> <img src=\"https://www.klm.com/travel/generic/images/klmroyaldutchairlines_tcm169-352905.png\" alt=\"klmlogo\"/> <img src=\"https://www.klm.com/travel/generic/images/skyteam_tcm169-352908.png\" alt=\"skyteamlogo\"/> </header> </div><div class=\"cookiebar-description\" id=\"cookiebarTitle\"> </div><div class=\"cookiebar-cookies\" id=\"cookiebarCookieSetting\"> </div><div class=\"cookiebar-agree-content\" id=\"cookiebarAgreeContent\"> </div></div></div></body></html>');\n\n                if(!cookieBarJs) {\n                    _st.inject.script('https://a.svtrd.com/media/s/135/24/cookiebar_tls.js', {\n                        id: 'cookie-bar-js',\n                        callback: function () {\n                        }\n                    });\n                }\n                else {\n                    window.AFKL.cookie.init(window);\n                }\n            }\n        }\n        else { //For KLM iOS app\n            //TODO: check this condition can be moved\n            _st.cookiepermission.setCookiePreferences({ 1: true, 2: true, 3: true });\n        }\n    });\n})();","exec":"event"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1066,"version":8,"content":"(function() {\n  (function(e, t, n) {\n    if (e.snaptr) return;\n    var a = e.snaptr = function() {\n       var p = a.handleRequest ? a.handleRequest.apply(a, arguments) : a.queue.push(arguments);\n     };\n    a.queue = [];\n    var s = 'script';\n    r = t.createElement(s);\n    r.async = !0;\n    r.src = n;\n    var u = t.getElementsByTagName(s)[0];\n    u.parentNode.insertBefore(r, u);\n})(window, document,\n    'https://sc-static.net/scevent.min.js');\n\nsnaptr('init', '0fbe1b8b-2860-4be3-8770-b5ded325e8e2', {\n});\n\nsnaptr('track', 'PAGE_VIEW', {'item_category': ' ', 'item_ids':('' + _st.data.getProperty('z_country') + '-' + _st.data.getProperty('z_language') + '').toLowerCase() + ('_' + _st.data.getProperty('z_origin') + '-' + _st.data.getProperty('z_destination') + '').toUpperCase() });\n})();\n        ","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1096,"version":8,"content":"window.uetq = window.uetq || [];\nwindow.uetq.push ('event', '' + _st.data.getProperty('cg_s') + '', {'event_category': '' + _st.data.getProperty('cg_n') + '', 'event_label': '' + _st.data.getProperty('ti') + '', 'event_value': 0 }); \n\n/* jshint ignore:start */  \n\n(function(w, d, t, r, u) {\n\tvar f, n, i;\n\tw[u] = w[u] || [];\n\tf = function() {\n\t\tvar o = {\n\t\t\tti: '4055700'\n\t\t};\n\t\to.q = w[u];\n\t\tw[u] = new UET(o);\n\t\tw[u].push(\"pageLoad\");\n\t};\n\tn = d.createElement(t);\n\tn.src = r;\n\tn.async = 1;\n\tn.onload = n.onreadystatechange = function() {\n\t\tvar s = this.readyState;\n\t\tif (!(s && s !== \"loaded\" && s !== \"complete\")) {\n\t\t\tf();\n\t\t\tn.onload = n.onreadystatechange = null;\n\t\t}\n\t};\n\ti = d.getElementsByTagName(t)[0];\n\ti.parentNode.insertBefore(n, i);\n})(window, document, \"script\", \"//bat.bing.com/bat.js\", \"uetq\");\n\n/* jshint ignore:end */","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1100,"version":13,"content":"(function() {\n  \n\t_st.inject.pixel(\"https://ct.pinterest.com/v3/?tid=2612468968485&event=pagevisit&ed[property]=\"+ _st.data.getProperty('ti')+\n\t\t\t\t\t\"&ed[country]=\"+ _st.data.getProperty('z_country') + \"&noscript=1\");\n})();\n        ","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1145,"version":28,"content":"(function () {\n\tvar application = _st.data.getProperty(\"z_application\").toLowerCase();\n\t//Application list where the session storage should not be removed.\n\tvar regex = /^((?!(trip|ancillaries|logon|checkout)).)*$/;\n\t//The application name for this page is \"blueweb\" so adding this page as an exception.\n\tvar pageName = 'trip-details-view.component';\n\tif(typeof (sessionStorage) !== \"undefined\" && sessionStorage.getItem('tms_ancillary_flow') && ((_st.data.getProperty(\"tx_e\") == 'p' && _st.data.getProperty(\"ti\")==\"ancillary.confirmation\") || (application.match(regex) && _st.data.getProperty(\"ti\") !== pageName))) {\n\t\tsessionStorage.removeItem('tms_ancillary_flow');\n\t}\n})();","group":1},{"markerCondition":"[{\"groupName\":\"QualifiedVisit\",\"markers\":[\"Landing\"]}]","loadDefault":false,"groupReverse":false,"selector":"head","id":1193,"version":11,"content":"(function() {\n    // private function scope, add your code here\n\tif (!_st.data.getMarker('QualifiedVisit','SecondPage')){\n\t\t_st.inject.script(\"https://www.googletagmanager.com/gtag/js?id=DC-4232724\", {\n\t\tcallback: function() {\n\t\t\twindow.dataLayer = window.dataLayer || [];\n\n\t\t\tfunction gtag() {\n\t\t\t\tdataLayer.push(arguments);\n\t\t\t}\n\t\t\tgtag('js', new Date());\n\t\t\tgtag('event', 'conversion', {\n\t\t\t\t'allow_custom_scripts': true,\n\t\t\t\t'u1': _st.data.getProperty('z_country'),\n\t\t\t\t'u2': _st.data.getProperty('z_language'),\n\t\t\t\t'send_to': 'DC-4232724/klm_q0/klm_q0+standard'\n\t\t\t});\n\t\t}\n\t});\n\t//console.log(\"Qualified visit\")\n\t_st.data.setMarker('QualifiedVisit', 'SecondPage', new Date().getTime() + 24 * 60 * 60 * 1000);\n}\n\n\t\n})();\n        ","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1195,"version":10,"content":"(function() {\n    _st.event.subscribe('gtm_configured', '', function(category, eventName, data) {\n\t\t//console.log('gtm loaded event')\n    });\n})();\n","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1197,"version":5,"content":"(function() {\n    // private function scope, add your code here\n_st.data.setMarker('QualifiedVisit', 'Landing', new Date().getTime() + 24 * 60 * 60 * 1000);\n})();\n        ","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1208,"version":64,"content":"(function(){\n\t//try {\n\t\tvar queryString = window.location.search;\n\t\tvar today = new Date();\n\t\tvar paramsPageview = {};\n\t\t\n\t\tparamsPageview.url = document.location.href;\n\t\tparamsPageview.userAgent = window.navigator.userAgent;\n\t\tparamsPageview.timestamp = +new Date();\n\t\tparamsPageview.doc_referrer = document.referrer;\n\t\tparamsPageview.os = window.navigator.platform;\n\t\tparamsPageview.utm_source = _st.util.getUrlParam('utm_source') !== null ? _st.util.getUrlParam('utm_source') : \"\";\n\t\tparamsPageview.utm_medium = _st.util.getUrlParam('utm_medium') !== null ? _st.util.getUrlParam('utm_medium') : \"\";\n\t\tparamsPageview.utm_campaign = _st.util.getUrlParam('utm_campaign') !== null ? _st.util.getUrlParam('utm_campaign') : \"\";\n\t\tparamsPageview.utm_content = _st.util.getUrlParam('utm_content') !== null ? _st.util.getUrlParam('utm_content') : \"\";\n\t\tparamsPageview.utm_term = _st.util.getUrlParam('utm_term') !== null ? _st.util.getUrlParam('utm_term') : \"\";\n\t\tparamsPageview.country = _st.data.getProperty('z_country');\n\t\tparamsPageview.date = today.getFullYear()+'-'+(today.getMonth()+1)+'-'+today.getDate();\n\t\n\t\t_st.tracking.sendEngagement('Pageview', paramsPageview);\n\t\t\n\t\tvar noProps = 0;\n\t\t  for(var i in paramsPageview)\n\t\t\t\tif(paramsPageview.hasOwnProperty(i))\n\t\t\t\t\tnoProps++;\n\t\t\t\t\n\t\t\n\t\tif(noProps > 32) \n\t\t\tthrow 'Warning; Engagements can only contain 32 properties at a time';\n\t\t\n\t\tif(encodeURI(_st.util.encodeJson(paramsPageview)).length > 1900)\n\t\t\tthrow 'Engagement Parameter character length > 1900. This might indicate (partial) loss of data';\n\t//} catch(e){_st.debug.log(e);}\n\n})();","exec":"onready","group":3},{"markerCondition":"[]","selector":"head","id":1218,"version":7,"content":"var ignore_domains = [\n\t\t\"klm.com\", \"securesuite.co.uk\",\"abnamro.nl\",\"ing.nl\",\"rabobank.nl\",\n\t\t\"arcot.com\",\"secure.barclaycard.co.uk\",\"icscards.nl\",\n\t\t\"lloydstsb.com\",\"securecode.com\",\"verifiedbyvisa.barclays.co.uk\",\n\t\t\"edb.com\",\"cafis-paynet.jp\",\"snsbank.nl\",\"asnbank.nl\",\"triodos.nl\",\n\t\t\"vanlanschot.com\",\"klm.nl\",\"securesuite.net\",\"cardcenter.ch\",\"visa.com\",\n\t\t\"wlp-acs.com\",\"mycardsecure.com\",\"sofort.com\",\"sparebank1.no\",\"verifiedbyvisa.com\",\n\t\t\"viseca.ch\",\"bpce.fr\",\"alignet-acs.com\",\"lcl.fr\",\"cic.fr\",\"paypal.com\",\"netcetera.ch\",\n\t\t\"sia.eu\",\"bnpparibas.com\",\"nccc.com.tw\",\"swisscard.ch\",\"creditmutuel.fr\",\n\t\t\"maybank.com.my\",\"deutsche-bank.de\",\"swedbank.se\",\"fnb.co.za\",\"hsbc.com.my\",\n\t\t\"sermepa.es\",\"commerzbank.de\",\"hsbc.com.hk\",\"luottokunta.fi\",\"handelsbanken.modirum.com\",\n\t\t\"citibank.com\",\"cardcomplete.com\",\"payment.amadeus.com\",\"ing.be\",\"bankserv.co.za\",\n\t\t\"eglobal.com.mx\",\"dnp-cdms.jp\",\"nedsecure.co.za\",\"alfabank.ru\",\"sbrf.ru\",\"bkm.com.tr\",\n\t\t\"cap.attempts.securecode.com\",\"3d-secure-code.de\",\"3dsg.dbs.com\",\"3dsecure.klikbca.com\",\n\t\t\"3dsecure.monext.fr\",\"cimb-securee-pay.cimb.com\",\"americanexpress.com\",\n\t\t\"unitradeprod.alipay.com\",\"vcas02c.visa3dsecure.com\",\"aacs.amexsafekey.com\",\n\t\t\"epmt.nordea.fi\",\"postecommerce.bancoposta.it\",\"tpeweb1.paybox.com\",\"cashier.95516.com\",\n\t\t\"secure.przelewy24.pl\",\"gfs.nb.se\",\"3dsecure.cartasi.it\",\"mastercardsecurecode.sparkassen-kreditkarten.de\",\n\t\t\"ideal.knab.nl\",\"3d-secure.pluscard.de\",\"monetaonline.it\",\"wwws.klm.co.uk\",\"wwws.klm.no\",\n\t\t\"wwws.klm.de\",\"wwws.klm.us\",\"wwws.klm.se\",\"wwws.klm.dk\",\"authentication.cardinalcommerce.com\",\n\t\t\"wwws.klm.it\",\"live.adyen.com\",\"wwws.klm.es\",\"wwws.klm.ca\",\"wwws.klm.ru\",\"wwws.klm.ch\",\n\t\t\"wwws.klm.fr\",\"wwws.klm.pl\",\"wwws.klm.co.kr\",\"wwws.klm.cn\",\"wwws.klm.be\",\"wwws.klm.fi\",\n\t\t\"wwws.klm.co.jp\",\"secure.dkb.de\",\"wwws.klm.gr\",\"3dsecure.ing.ro\",\"wwws.klm.at\",\"ideal.bunq.com\",\n\t\t\"wwws.klm.ie\",\"secure5gw.ro\",\"wwws.klm.co.ke\",\"wwws.klm.co.za\",\"wwws.klm.sg\",\"3dsecure-cardprocess.de\",\n\t\t\"wwws.klm.ae\",\"wwws.klm.pt\",\"wwws.klm.co.id\",\"secure2gw.ro\",\"wwws.klm.cz\",\"wwws.klm.ro\",\"wwws.klm.lu\",\n\t\t\"netsafe.hdfcbank.com\",\"uob3ds.uobgroup.com\",\"wwws.klm.hu\",\"enets.sg\",\"wwws.klm.cl\",\n\t\t\"wwws.klm.ua\",\"wwws.klm.cw\",\"3dsec.postfinance.ch\",\"secureshopping.usaa360.com\",\n\t\t\"optar.com.ec\",\"acs.privatbank.ua\",\"thepaymentsplace.com.au\",\"securepay.hsbc.com.sg\",\n\t\t\"3dsecure.hsbc.co.id\",\"3dssg.ocbc.com\",\"diensten.regiobank.nl\",\"online.ingbank.pl\",\n\t\t\"wwws.klm.aw\",\"wwws.klm.co.ug\",\"wwws.klm.co.in\",\"3dsecure.bni.co.id\",\"acs1.3ds.modirum.com\",\n\t\t\"wwws.klm.co.th\",\"3debspay.boc.cn\",\"klm.co.uk\",\"klm.us\",\"klm.de\",\"klm.se\",\"klm.co.jp\",\n\t\t\"klm.ch\",\"klm.be\",\"klm.no\",\"klm.es\",\"klm.fr\",\"klm.ru\",\"klm.ca\",\"klm.it\",\"klm.co.kr\",\n\t\t\"klm.dk\",\"klm.fi\",\"klm.co.cr\",\"klm.pl\",\"klm.cn\",\"klm.hu\",\"klm.ie\",\"klm.co.za\",\"klm.at\",\n\t\t\"klm.co.in\",\"klm.pt\",\"klm.co.th\",\"klm.ro\",\"klm.ae\",\"klm.sg\",\"klm.cw\",\"klm.co.id\",\n\t\t\"klm.cl\",\"klm.ua\",\"klm.co.ke\",\"klm.lu\",\"klm.cz\",\"klm.co.il\",\"klm.aw\",\"klm.gr\",\"klm.sr\",\n\t\t\"klm.sx\",\"klm.co.ug\",\"klm.co.tz\",\"klm.hr\",\"klm.lv\",\"klm.bg\",\"klm.co.ao\",\"klm.by\",\"klm.lt\",\n\t\t\"klm.sk\",\"klm.kz\",\"klm.co.nz\",\"klm.ge\",\"klm.ml\",\"klm.nc\",\"klm.lk\",\"3dsecure.ecobank.com\",\n\t\t\"3dspayment.paylife.at\",\"secure.3ds.bonuscard.ch\",\"3dsecure.bnpparibas.pl\",\"3ds.banquemisr.com:4443\",\n\t\t\"3dspayment.easybank.at\",\"3ds.consorsfinanz.de\",\"3ds.capitecbank.co.za\",\"cbao3ds.sn\",\n\t\t\"3ds-b.live.ext.prod.enfuce.com\",\"3dsecure.raiffeisen.sk\",\"3dsecureweb.euronetworldwide.com\",\n\t\t\"isg-3dsecure.in\",\"acs.netsgroup.com\",\"acs.attijaripaymentprocessing.com\",\"cacs.icard.com\",\n\t\t\"acs.alfabank.kiev.ua\",\"trustly.com\",\"sas.redsys.es\",\"ps4acs-mc-1.netcetera-payment.ch\",\n\t\t\"3ds.bov.com\",\"3dsp.vtb.ru\",\"e.ingbank.pl\",\"balkan.kiwi.com\",\"idcheck.acs.touchtechpayments.com\",\n\t\t\"mepsfpx.com.my\",\"verifiedbyvisa.acs.touchtechpayments.com\",\"mc-id-check.firstdata.de\",\n\t\t\"acs.sibs.pt\",\"acs.mercurypaymentservices.it\",\"dontpayfull.com\",\"3dsecure-1.wirecard.com\",\n\t\t\"ecclients.btrl.ro\",\"secure.3ds.cornercard.ch\",\"esp.secure.investec.com\",\"r.srvtrck.com\",\n\t\t\"secure.tinkoff.ru\",\"eblik.pl\",\"mtransfer.mbank.pl\",\"mclient.alipay.com\",\"bofp.erstebank.hu\",\n\t\t\"3ds-n2.nbg.gr\",\"3dsecure.garanti.com.tr\",\"3dsecure.icicibank.com\",\"acs.airplus.com\",\n\t\t\"3dsecure-2.wirecard.com\",\"3ds-n1.nbg.gr\",\"acs1.icicibank.com\",\"3dsecure.mbank.pl\",\n\t\t\"pay.activa-card.com\",\"rt03.kasikornbank.com\",\"acs1-3dsecure.cm-cic.com\",\"acs2-3dsecure.cm-cic.com\",\n\t\t\"3ds.e-cartebleue.com\",\"3ds.jccsecure.com\",\"acssv.otpbank.hu\",\"acs2-3dsecure.targobank.de\",\n\t\t\"evgr-securepay.hsbc.co.in\",\"3dsecure.bankmega.com\",\"acs.bdo.com.ph\",\"acs.unifiedpaymentsnigeria.com\",\n\t\t\"cardsecurity.standardchartered.com\",\"3dsecure.vinea.es\",\"3dsecure.slsp.sk\",\"acs.quipugmbh.com\",\n\t\t\"acs2.onlinesbi.com\",\"cardsecurity.nab.com.au\",\"santander.cl\",\"secure.lastminute.com\",\n\t\t\"3dauthentication.bankcomm.com\",\"3ds.rpc-raiffeisen.com\",\"3dsecure.bankmandiri.co.id\",\n\t\t\"3dsecure.ukrsibbank.com\",\"acs.bradescocartoes.com.br\",\"acs.cardstandard.ru\",\n\t\t\"acs.gpesecure.com\",\"acs.kbcard.com\",\"acs.upc.ua\",\"adfs.voestalpine.com\",\n\t\t\"3ds.alfabank.by\",\"3ds.open.ru\",\"3ds.priorbank.by\",\"3dsecure.btpn.com\",\n\t\t\"3dsecure.csas.cz\",\"3dsecure.hlb.com.my\",\"3dsecure.maybank.co.id\",\"3dsecure.santander.com.br\",\n\t\t\"3dsecureprd.fnbnamibia.com.na\",\"acs.arca.am\",\"acs.bspb.ru\",\"acs.fio.cz\",\n\t\t\"acs.techcombank.com.vn\",\"acs1-3dsecure.targobank.de\",\"acs1.bradescocartoes.com.br\",\n\t\t\"acs1.unicredit.ru\",\"acs7.enstage-sas.com\",\"acsforae.icbc.com.cn\",\"b2-kotak-pdc.enstage-sas.com\",\n\t\t\"test.adyen.com\",\"3dsecure-vrp.de\",\"mastercardidentitycheck.sparkassen-kreditkarten.de\",\n\t\t\"mcconsumer.alahli.com\",\"sicher-bezahlen.sparkasse.at\",\"3d-secure1.sbanken.no\",\n\t\t\"cardinalcommerce.com\",\"acs2.gpesecure.com\",\"bankmillennium.pl\",\"acs2.3ds.modirum.com\",\n\t\t\"visa-secure-bxl.ing.de\",\"ipko.pl\",\"bezpecneplatby.rb.cz\",\"3ds.pl.ing.com\",\n\t\t\"secure-acs2ui-b1-indblr-blrtdc.wibmo.com\",\"secure22gw.ro\",\"secure-acs2ui-b1-indmum-mumrdc.wibmo.com\",\n\t\t\"pekao24.pl\",\"citibank.co.in\",\"visasecure2.comdirect.de\",\"acs.raiffeisen.ru\",\"api.secure-code.bunq.com\",\n\t\t\"vbv.shinhancard.com\",\"vbv.scb.co.th\",\"acsv.centrum24.pl\",\"verifiedbyvisa.sparkassen-kreditkarten.de\",\n\t\t\"acs.hanacard.co.kr\",\"3dsecure.no\",\"online.tingg.africa\",\"acs.icicibank.com\",\n\t\t\"foriseu-vbv.mycardplace.com\",\"3dsecure1.icicibank.com\",\"trides-cld.asseco-see.hr\",\"3dsecure.pl.ing.com\",\"adyen.com\"];\n\n//console.log(\"ignore_domains loaded\");\n_st.event.publish('ignore_domains', 'loaded', {});"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1237,"version":7,"content":"(function(){\n\tvar key = 3002;\n\tvar value = _st.tracking.getUserIdentifier();\n\tif(typeof value !== 'undefined' && value !== '' && value !== 'undefined' && !!value) {\n\t\t_st.tracking.storeMapping(key,value);\n\t} else {\n\t\tthrow 'Storemapping value contains no correct value : ' + value;\n\t}\n})();","exec":"onload","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1250,"version":19,"content":"(function() {\n\t\t\n\t\tif (sessionStorage.getItem('paramsTrafficsources_Stored')!=undefined && sessionStorage.getItem('paramsTrafficsources_Stored')!='' \n\t\t\t&& !!sessionStorage.getItem('TrafficSourceStoring') == '') {\n\t\t\tsessionStorage.setItem('TrafficSourceStoring','1');\n\t\t\t\n\t\t\tvar paramsTrafficsources = JSON.parse(\n\t\t\t\tsessionStorage.getItem('paramsTrafficsources_Stored')\n\t\t\t\t);\n\t\t\t\n\t\t\t_st.tracking.sendEngagement('trafficsources', paramsTrafficsources);\n\t\t\t\n\t\t\t//update totaalscore in audience\n\t\t\t_st.tracking.sendExternalFact('Scoringmodel', 7776000, paramsTrafficsources, true);\n\t\t\t\n\t\t\tsessionStorage.setItem('paramsTrafficsources_Stored','');\n\t\t}\n})();","exec":"onready","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1257,"version":52,"content":"window.DAS = window.DAS || {};\nwindow.DAS.webChat = window.DAS.webChat || {};\n(function () {\n    var salesforceScriptID = document.getElementById(\"salesforceChatEmbeddedservice\");\n    if(!window.DAS.webChat.isSalesforceChatInitialized && !salesforceScriptID) {\n        _st.inject.script('https://afkl.my.salesforce.com/embeddedservice/5.0/esw.min.js', {\n\t\t\tid: \"salesforceChatEmbeddedservice\",\n            callback: function () {\n                    window.DAS.webChat.isSalesforceChatInitialized = true; \n                    var hideChatButton = false;                  \n                    var initESW = function (gslbBaseURL) {\n                        embedded_svc.settings.language = 'en';\n                        embedded_svc.settings.displayHelpButton = false;\n                        embedded_svc.settings.defaultMinimizedText = ' ';\n                        embedded_svc.settings.loadingText = 'Loading...';\n                        embedded_svc.settings.avatarImgURL = 'https://afkl--uat.sandbox.my.salesforce-sites.com/resource/KLMChatLogo';\n                        if (typeof (sessionStorage) !== \"undefined\") {\n                            tms_ffp_tier_level = sessionStorage.getItem('tms_ffp_tier_level');\n                        }\n                        embedded_svc.settings.prepopulatedPrechatFields = {\n                            Encrypted_GIN__c: _st.data.getProperty('z_gin')\n                        }; \n                        embedded_svc.settings.extraPrechatFormDetails = [ {\n                            \"label\": \"Website\",\n                            \"value\": _st.data.getProperty('z_host'),\n                            \"transcriptFields\":[ \"Webchat_Website__c\" ],\n                            \"displayToAgent\": false\n                        },{\n                            \"label\": \"Webpageurl\",\n                            \"value\": window.location.href,\n                            \"transcriptFields\":[ \"Webchat_webpage__c\" ],\n                            \"displayToAgent\": true\n                        },{\n                            \"label\": \"Market\",\n                            \"value\": _st.data.getProperty('z_country') + '-' + _st.data.getProperty('z_language'),\n                            \"transcriptFields\":[ \"Webchat_market__c\" ],\n                            \"displayToAgent\": true\n                        } ];\n                        embedded_svc.settings.extraPrechatInfo = [{\n                            \"entityName\": \"Case\",\n                            \"showOnCreate\": true,\n                            \"saveToTranscript\": \"CaseId\",\n                            \"entityFieldMaps\": [{\n                                \"isExactMatch\": false,\n                                \"fieldName\": \"Subject\",\n                                \"doCreate\": true,\n                                \"doFind\": false,\n                                \"label\": \"Subject\"\n                            }]\n                        }, {\n                            \"entityName\": \"Account\",\n                            \"showOnCreate\": true,\n                            \"saveToTranscript\": \"AccountId\",\n                            \"linkToEntityName\": \"Case\",\n                            \"linkToEntityField\": \"AccountId\",\n                            \"entityFieldMaps\": [{\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"Name\",\n                                \"doCreate\": true,\n                                \"doFind\": false,\n                                \"label\": \"Last Name\"\n                            }, {\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"PersonEmail\",\n                                \"doCreate\": true,\n                                \"doFind\": false,\n                                \"label\": \"Email\"\n                            }, {\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"Flying_Blue_Number__c\",\n                                \"doCreate\": true,\n                                \"doFind\": true,\n                                \"label\": \"Flying Blue number\"\n                            },{\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"GIN__c\",\n                                \"doCreate\": true,\n                                \"doFind\": true,\n                                \"label\": \"GIN\"\n                            },{\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"Phone\",\n                                \"doCreate\": true,\n                                \"doFind\": false,\n                                \"label\": \"Phone\"\n                            },{\n                                \"isExactMatch\": true,\n                                \"fieldName\": \"Customer_Id__c\",\n                                \"doCreate\": true,\n                                \"doFind\": true,\n                                \"label\": \"Customer Id\"\n                            }]\n                        }];\n                        embedded_svc.addEventHandler(\"onAvailability\", function (data) {\n                            window.DAS.webChat.isAgentAvlb = data.isAgentAvailable ? true : false;\n                            if (window.DAS.webChat.isAgentAvlb && !hideChatButton) {\n                                checkButtonAvailability(_st.data._tagProperties);\n                            } else {\n                                hideButton();\n                            }\n                        });\n                        embedded_svc.addEventHandler(\"onInviteAccepted\", function(data) {\n                            tagWebchatInteraction('clicked');\n                        });\n                        embedded_svc.addEventHandler(\"onChatEstablished\", function(data) {\n                            hideChatButton = true;\n                            hideButton();\n                        });\n\t\t\t\t\t\tembedded_svc.addEventHandler('onSettingsCallCompleted', function(data) {\n\t\t\t             window.DAS.webChat.isAgentAvlb = data.isAgentAvailable ? true : false;\n\t\t\t\t\t\t if (window.DAS.webChat.isAgentAvlb && !hideChatButton) {\n\t\t\t             checkButtonAvailability(_st.data._tagProperties);\n\t\t\t             } else {\n\t\t\t\t\t\t\t\thideButton();\n\t\t\t\t\t\t}\n\t\t\t            });\n                        embedded_svc.settings.enabledFeatures = ['LiveAgent'];\n                        embedded_svc.settings.entryFeature = 'LiveAgent';\n                        embedded_svc.init(\n                                'https://afkl.my.salesforce.com',\n                                'https://afkl.my.salesforce-sites.com/webChat',\n                                gslbBaseURL,\n                                '00D20000000CPM3',\n                                'KLM_Chat_NL',\n                                {\n                                    baseLiveAgentContentURL: 'https://c.la3-c1-fra.salesforceliveagent.com/content',\n                                    deploymentId: '57220000000L00O',\n                                    buttonId: '5736M000000sXtv',\n                                    baseLiveAgentURL: 'https://d.la3-c1-fra.salesforceliveagent.com/chat',\n                                    eswLiveAgentDevName: 'EmbeddedServiceLiveAgent_Parent04I6M000000oLkuUAE_18263e2433c',\n                                    isOfflineSupportEnabled: false\n                                }\n                            );\n                        };\n\n                    if (!window.embedded_svc) {\n                        var s = document.createElement('script');\n                        s.setAttribute('src', 'https://afkl.my.salesforce.com/embeddedservice/5.0/esw.min.js');\n                        s.onload = function () {\n                            initESW(null);\n                        };\n                        document.body.appendChild(s);\n                    } else {\n                        initESW('https://afkl.my.salesforce.com');\n                        _st.inject.css('.embeddedServiceHelpButton .uiButton{font-weight:700;font-size:16px;margin:2px 3px;padding:3px 5px;min-width:3em;max-width:12em;text-decoration:none;text-align:center;border:0;background:#dddfe1}.embeddedServiceHelpButton .helpButton .uiButton{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:25px;isolation:isolate;position:absolute;width:50px;height:50px;left:-143px;top:-43px;background:#003145;box-shadow:0 0 8px rgba(0,0,0,.12),0 8px 8px rgba(0,0,0,.24);border-radius:39px}.embeddedServiceHelpButton .helpButton .uiButton .embeddedServiceIcon{font-family:\"embeddedserviceiconfont\";font-size:2.05em;content:attr(data-icon);speak:none;text-rendering:auto;font-weight:400;font-variant:normal;text-transform:none;padding-left:10px}.embeddedServiceHelpButton .uiButton .helpButtonLabel{position:absolute;width:10px;height:9px;left:calc(90% - 16px/2);top:calc(20% - 16px/2);background:linear-gradient(33.23deg,#56B36A 16.8%,#6CEA88 95.05%);border-radius:10px;text:linear-gradient(33.23deg,#56B36A 16.8%,#6CEA88 95.05%)}.embeddedServiceHelpButton .helpButton .uiButton:focus{outline:1px solid #051039}');\n                    }\n            }\n        });\n        _st.event.subscribe('', '', function (category, name, data) {\n            if(data.z_application === 'contact' && data.z_eventplace !== 'webchat') {\n                window.DAS.webChat.pageEventValue = data.z_eventvalue;\n                checkButtonAvailability(data); \n            }\n        });\n    } else {\n        _st.event.subscribe('', '', function (category, name, data) {\n            if(data.z_application === 'contact' && data.z_eventplace !== 'webchat') {\n                window.DAS.webChat.pageEventValue = data.z_eventvalue;\n                checkButtonAvailability(data); \n            }\n        });\n    }\n    \n    var relayData = _st.data._tagProperties;\n    hideButton();\n    checkButtonAvailability(relayData);\n    var impressionCounter = 0;\n\n    function checkButtonAvailability(data) {\n        if (document.getElementsByClassName('embeddedServiceHelpButton').item(0)) {\n            if (shouldShowButton(data)) {\n                document.getElementsByClassName('embeddedServiceHelpButton').item(0).style.display = \"block\";\n                _st.inject.css('.embeddedServiceHelpButton .uiButton{font-weight:700;font-size:16px;margin:2px 3px;padding:3px 5px;min-width:3em;max-width:12em;text-decoration:none;text-align:center;border:0;background:#dddfe1}.embeddedServiceHelpButton .helpButton .uiButton{display:flex;flex-direction:row;justify-content:center;align-items:center;padding:25px;isolation:isolate;position:absolute;width:50px;height:50px;left:-143px;top:-43px;background:#003145;box-shadow:0 0 8px rgba(0,0,0,.12),0 8px 8px rgba(0,0,0,.24);border-radius:39px}.embeddedServiceHelpButton .helpButton .uiButton .embeddedServiceIcon{font-family:\"embeddedserviceiconfont\";font-size:2.05em;content:attr(data-icon);speak:none;text-rendering:auto;font-weight:400;font-variant:normal;text-transform:none;padding-left:10px}.embeddedServiceHelpButton .uiButton .helpButtonLabel{position:absolute;width:10px;height:9px;left:calc(90% - 16px/2);top:calc(20% - 16px/2);background:linear-gradient(33.23deg,#56B36A 16.8%,#6CEA88 95.05%);border-radius:10px;text:linear-gradient(33.23deg,#56B36A 16.8%,#6CEA88 95.05%)}.embeddedServiceHelpButton .helpButton .uiButton:focus{outline:1px solid #051039}');\n                //setPositioning();\n\n                if (impressionCounter === 0) {\n                    tagWebchatInteraction('impression');\n                    impressionCounter += 1;\n\t\t\t\t\tdocument.getElementsByClassName('embeddedServiceHelpButton')[0]\n                    .addEventListener('click', function (event) {\n                        tagWebchatInteraction('clicked');\n                    });\n                    \n                }\n            }\n            else {\n                hideButton();\n            }\n        }\n    }\n    \n    function shouldShowButton(data) {\n        var allowedFlowNames = ['booking', 'check-in', 'trip'];\n        var contactPages = ['BAGGAGE;EXTRA_BAGGAGE', 'TRIP_CHECKIN;HELP_CHECKIN', 'TRIP_CHECKIN;CHANGE_BOOKING_OPTION', 'BOOKING;BOOK_FLIGHT_OPTION', 'BOOKING;HELP_ONLINE_BOOKING'];\n        var contactDeepLinkPaths = [\n\t\t\t'/contact/booking/book-flight-option',\n            '/contact/booking/help-online-booking',\n            '/contact/trip-checkin/change-booking-option',\n            '/contact/trip-checkin/help-checkin',\n            '/contact/baggage/extra-baggage',\n            '/en/contact/booking/book-flight-option',\n            '/en/contact/booking/help-online-booking',\n            '/en/contact/trip-checkin/change-booking-option',\n            '/en/contact/trip-checkin/help-checkin',\n            '/en/contact/baggage/extra-baggage'\n        ];\n         return window.DAS.webChat.isSalesforceChatInitialized &&\n            window.DAS.webChat.isAgentAvlb && data &&\n            (\n                (data.z_flow_name && (allowedFlowNames.indexOf(data.z_flow_name) > -1)) ||\n                (\n                    data.z_application && data.z_application === 'contact' &&\n                    ((window.DAS.webChat.pageEventValue && contactPages.find(findContactPage)) || contactDeepLinkPaths.indexOf(location.pathname) > -1)\n                ) ||\n                (data.z_application && (data.z_application === 'trip' || data.ti === 'checkin.entryform' || data.z_application === 'search'))\n            ) &&\n            (data.ti && (data.ti.indexOf('payment') === -1 && data.ti.indexOf('seatmap') === -1) || data.ti.indexOf('checkin') > -1 );\n    }\n\n    function findContactPage(contactPage) {\n        return window.DAS.webChat.pageEventValue && window.DAS.webChat.pageEventValue.indexOf(contactPage) > -1;\n    }\n    \n    function hideButton() {\n        if (document.getElementsByClassName('embeddedServiceHelpButton').item(0)) {\n            document.getElementsByClassName('embeddedServiceHelpButton').item(0).style.display = \"none\";\n        }\n    }\n    function setPositioning() {\n        var webchatButton = document.querySelector('.embeddedServiceHelpButton .helpButton .uiButton');\n        if (screen.height < 867) {\n            webchatButton.style.top = '27%';\n        } if (screen.width < 1025) {\n            webchatButton.style.left = '89%';\n        }\n    }\n\n    // GA Show & Click event tagging\n    function tagWebchatInteraction(interaction) {\n        DAS.webchat.setWebchatStatus(interaction);\n        var webchatData = _st.util.extend(_st.data._tagProperties, {\n            z_eventplace: 'webchat',\n            z_eventtype: interaction,\n            z_eventvalue: '',\n            z_event: interaction,\n            dl: interaction === 'impression' ? 'impression' : 'userevent'\n        });\n        _st.event.publish('webchat', 'webchat_' + interaction, webchatData);\n    }\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":263,"version":12,"content":"_linkedin_partner_id = \"7508\";\nwindow._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];\nwindow._linkedin_data_partner_ids.push(_linkedin_partner_id);\n\n(function() {\n  var s = document.getElementsByTagName(\"script\")[0];\n  var b = document.createElement(\"script\");\n  b.type = \"text/javascript\";\n  b.async = true;\n  b.src = \"https://snap.licdn.com/li.lms-analytics/insight.min.js\";\n  s.parentNode.insertBefore(b, s);\n})();","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":697,"version":33,"content":"if (!_st.util.getCookie('MetrixLab_p23101_klm')) {\n/* jshint ignore:start */\n    (function() {\n        var g = function(e, h, f, g) {\n            this.get = function(a) {\n                for (var a = a + \"=\", c = document.cookie.split(\";\"), b = 0, e = c.length; b < e; b++) {\n                    for (var d = c[b];\n                        \" \" == d.charAt(0);) d = d.substring(1, d.length);\n                    if (0 == d.indexOf(a)) return d.substring(a.length, d.length)\n                }\n                return null\n            };\n            this.set = function(a, c) {\n                var b = \"\",\n                    b = new Date;\n                b.setTime(b.getTime() + 6048E5);\n                b = \"; expires=\" + b.toGMTString();\n                document.cookie = a + \"=\" + c + b + \"; path=/; \"\n            };\n            this.check = function() {\n                var a = this.get(f);\n                if (a) a = a.split(\":\");\n                else if (100 != e) \"v\" == h && (e = Math.random() >= e / 100 ? 0 : 100), a = [h, e, 0], this.set(f, a.join(\":\"));\n                else return !0;\n                var c = a[1];\n                if (100 == c) return !0;\n                switch (a[0]) {\n                    case \"v\":\n                        return !1;\n                    case \"r\":\n                        return c = a[2] % Math.floor(100 / c), a[2]++, this.set(f, a.join(\":\")), !c\n                }\n                return !0\n            };\n            this.go = function() {               \n                    var a = document.createElement(\"script\");\n                    a.type = \"text/javascript\";\n                    a.src = g + \"&t=\" + (new Date()).getTime();\n                    document.body && document.body.appendChild(a)                \n            };\n            this.start = function() {\n                var a = this;\n\t\t\t\ta.go();\n                //window.addEventListener ? window.addEventListener(\"load\", function() {\n                //    a.go()\n                //}, !1) : window.attachEvent && window.attachEvent(\"onload\", function() {\n                //    a.go()\n                //})\n            }\n        };\n        try {\n            (new g(100, \"r\", \"QSI_S_ZN_eJ7k4EpLQ9fdF8F\", \"https://znej7k4eplq9fdf8f-afklm.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_eJ7k4EpLQ9fdF8F&Q_LOC=\" + encodeURIComponent(window.location.href))).start()\n        } catch (i) {throw i;}\n    })();\n\n/* jshint ignore:end */\n}","group":2},{"markerCondition":"[]","selector":"head","id":1233,"version":43,"content":"(function() {\n    window.DAS = window.DAS || {};\n    window.DAS.qualtrics = window.DAS.qualtrics || {};\n\n    var pages = getPageUrls();\n    window.DAS.previousPage = pages ? pages.currentPage : document.location.href;\n    window.DAS.currentPage = document.location.href;\n\n    window.DAS.previousTIName = pages ? pages.currentTIName : _st.data.getProperty(\"ti\");\n    window.DAS.currentTIName = _st.data.getProperty(\"ti\");\n\n\n    writePageUrls(window.DAS.previousPage, window.DAS.currentPage, window.DAS.previousTIName, window.DAS.currentTIName);\n    writePageName();\n    writeOriginCode();\n\n    function writePageName() {\n        if (Object.keys(window.DAS.qualtrics).length === 0) {\n            var qualtrics = getQualtricsSessionValue();\n            if (qualtrics) {\n                window.DAS.qualtrics.isBookingConfirmed = qualtrics.isBookingConfirmed;\n                window.DAS.qualtrics.isBookingFlowEntered = qualtrics.isBookingFlowEntered;\n            }\n        }\n\n        if (_st.data.getProperty('z_flow_name') === \"booking\") {\n            window.DAS.qualtrics.isBookingFlowEntered = true;\n            window.DAS.qualtrics.isBookingConfirmed = false;\n            writeQualtricsSession(true, false);\n        }\n\n        if (_st.data.getProperty('ti') === \"booking.confirmation\") {\n            window.DAS.qualtrics.isBookingConfirmed = true;\n            writeQualtricsSession(true, true);\n        }\n    }\n\n\n    function writeOriginCode() {\n        var originCode = sessionStorage.getItem('tms_origin');\n        if(originCode) {\n                window.DAS.qualtrics.flight_origin = originCode;\n            } else {\n                window.DAS.qualtrics.flight_origin = undefined;\n            } \n    }\n\n    function writeQualtricsSession(isBookingFlowEntered, isBookingConfirmed) {\n        var qualtrics = {};\n        qualtrics.isBookingFlowEntered = isBookingFlowEntered;\n        qualtrics.isBookingConfirmed = isBookingConfirmed;\n        sessionStorage.setItem('qualtrics', JSON.stringify(qualtrics));\n    }\n\n    function getQualtricsSessionValue() {\n        var qualtrics = sessionStorage.getItem('qualtrics');\n        return qualtrics && JSON.parse(qualtrics);\n    }\n\n    function writePageUrls(previousPage, currentPage, previousTIName, currentTIName) {\n        var pages = {};\n        pages.previousPage = previousPage;\n        pages.currentPage = currentPage;\n\n        pages.previousTIName = previousTIName;\n        pages.currentTIName = currentTIName;\n\n        sessionStorage.setItem('qualtricsPages', JSON.stringify(pages));\n    }\n\n    function getPageUrls() {\n        var pages = sessionStorage.getItem('qualtricsPages');\n        return pages && JSON.parse(pages);\n    }\n})();"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":311,"version":9,"content":"(function() {\n\tif (window.ga)\n\t{\n\t\tvar experimentId = '134';\n\t\tvar groups = {};\n\t\tgroups['135'] = 'display_a_group';\n\t\tgroups['136'] = 'display_b_group';\n\n\t\tif(_st.data.getUserData() !== undefined &&\n\t\t   _st.data.getUserData().e !== undefined &&\n\t\t   _st.data.getUserData().e[experimentId] !== undefined) {\n\n\t\t\tvar groupName = groups[_st.data.getUserData().e[experimentId].group];\n\t\t\tif(groupName !== undefined) {\n\t\t\t\tga('set', 'dimension16', groupName);\n\t\t\t} else {\n\t\t\t\tthrow \"Unknown experiment group in Analytics integration\";\n\t\t\t}\n\t\t}\n\t}\n})();","group":1},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1209,"version":200,"content":"(function() {\n    try {\n        var referrer = (document.referrer.replace(/(^\\w+:|^)\\/\\//, '')\n            .replace('www.', '')\n            .split('\\/')[0]).toLowerCase();\n\n        if (![].forEach) {\n            Array.prototype.forEach = function(callback) {\n                for (var i = 0, l = this.length; i < l; i++) callback(this[i]);\n            };\n        }\n\n        var medium = _st.util.getUrlParam('utm_medium');\n        var utm_term = _st.util.getUrlParam('utm_term');\n\n        var tracking_used = false;\n\n        if (!medium && _st.data.getProperty('z_tracking')) {\n            medium = _st.data.getProperty('z_tracking').utm_medium;\n            tracking_used = true;\n        } else if (medium) {\n            _st.data.setProperty('z_tracking', {\n                'utm_medium': medium\n            });\n            tracking_used = true;\n        }\n\t\t_st.debug.log(\"medium: \" + medium);\n\n        if (utm_term)\n            _st.data.setProperty('z_tracking', {\n                'utm_term': utm_term\n            });\n\n        function calcCatagories(audienceData, trafficSource,\n            currenttrafficSource, groupweight) {\n\n            var trafficSourcescore = 0;\n            groupweight = parseInt(groupweight);\n\n            //Check if scoring group is in audience data and get score. Add groupweight to stored score.\n            if (Object.keys(audienceData).length != 0 && trafficSource in audienceData) {\n\n                if (trafficSource == \"last10_trafficsources\") {\n\n                    trafficSourcescoreArr = [];\n                    trafficSourcescoreArr = audienceData[trafficSource].split(\",\");\n                    trafficSourcescoreArr.push(currenttrafficSource);\n\n                    if (trafficSourcescoreArr.length > 10) {\n                        trafficSourcescoreArr = trafficSourcescoreArr.slice(\n                            trafficSourcescoreArr.length - 10,\n                            trafficSourcescoreArr.length\n                        );\n                    }\n\n                    trafficSourcescore = trafficSourcescoreArr.join(\",\");\n                } else {\n                    trafficSourcescore = parseInt(audienceData[trafficSource]);\n\n                    if (trafficSource == currenttrafficSource) {\n                        trafficSourcescore += groupweight;\n                        _st.debug.log(\"Current trafficSource: \" + trafficSource + \"; Added score: \" + trafficSourcescore);\n                    } else _st.debug.log(\"trafficSource: \" + trafficSource + \"; Added score: \" + trafficSourcescore);\n                }\n\n            } else if (trafficSource == currenttrafficSource) trafficSourcescore = groupweight;\n\n\n            return trafficSourcescore;\n        }\n\n        function scoringsmodel(storedscore, audienceData) {\n\n            var newScoringData = {};\n            var categoryDictListWS = [\n                \"affiliation\",\n                \"display\",\n                \"email\",\n                \"influencer\",\n                \"direct\",\n                \"localchannel\",\n                \"loyaltyemail\",\n                \"metasearch\",\n                \"mobilepush\",\n                \"organicsearch\",\n                \"other\",\n                \"otherreferer\",\n                \"paidsearch\",\n                \"programmaticaudio\",\n                \"referral\",\n                \"searchengineorganic\",\n                \"socialadvertising\",\n                \"socialassistance\",\n                \"socialorganic\",\n                \"socialservicing\",\n                \"video\",\n            ];\n\n            //types without score\n            var categoryDictListWOS = [\n                \"top3trafficscore\",\n                \"last10_trafficsources\",\n                \"last_trafficsource\",\n                \"toptrafficscore\",\n            ];\n\n            var categoryDictList = [];\n            categoryDictList = categoryDictList.concat(categoryDictListWS).concat(categoryDictListWOS);\n\n            if (categoryDictList.indexOf(storedscore.trafficSource) == -1) {\n                if (storedscore.trafficSource == undefined ||\n                    storedscore.trafficSource == '')\n\n                    throw ('TrafficSource definition missing.');\n\n            }\n\n            calculatedPropertiesstoreList = [];\n\n            var topscore = 0;\n\n            // iterate through stored scores and set new scores and label/group scoring\n            for (var i = 0; i < categoryDictList.length; i++) {\n\n                var score = 0;\n                var weight = 1;\n                score = calcCatagories(audienceData,\n                    categoryDictList[i],\n                    storedscore.trafficSource,\n                    weight);\n\n                newScoringData[categoryDictList[i]] = score;\n\n                if (typeof score == \"number\" &&\n                    topscore < score || score == 0) {\n                    topscore = score;\n                }\n\n            }\n\n            var sortedScoringKV = [];\n\n            for (var newScoreKey in newScoringData)\n                if (categoryDictListWS.includes(newScoreKey) && newScoringData[newScoreKey] !== 0)\n                    sortedScoringKV.push([newScoreKey,\n                        newScoringData[newScoreKey]\n                    ]);\n            sortedScoringKV.sort(\n                function(a, b) {\n                    return b[1] - a[1];\n                });\n\n            newScoringData.top3trafficscore = [];\n\n            for (i in sortedScoringKV.slice(0, 3))\n                newScoringData.top3trafficscore.push(sortedScoringKV[i][0]);\n\n\n            newScoringData.last_trafficsource = \"\";\n            newScoringData.toptrafficscore = \"\";\n\t\t\tnewScoringData.toptrafficscoreValue = 0;\n            newScoringData.last_trafficsource = storedscore.trafficSource;\n\n            if (sortedScoringKV.length > 0) {\n                newScoringData.toptrafficscore = sortedScoringKV[0][0];\n            \tnewScoringData.toptrafficscoreValue = sortedScoringKV[0][1];\n\t\t\t}\n\n            return newScoringData;\n\n        }\n\n        if (ignore_domains.indexOf(referrer) == -1) {\n            var searchengines = [\n                \"100searchengines.com\", \"20searchengines.com\", \"21searchengines.com\",\n                \"22searchengines.com\", \"23searchengines.com\", \"24searchengines.com\",\n                \"25searchengines.com\", \"26searchengines.com\", \"27searchengines.com\",\n                \"28searchengines.com\", \"29searchengines.com\", \"30searchengines.com\",\n                \"31searchengines.com\", \"32searchengines.com\", \"33searchengines.com\",\n                \"34searchengines.com\", \"35searchengines.com\", \"36searchengines.com\",\n                \"37searchengines.com\", \"38searchengines.com\", \"39searchengines.com\",\n                \"40searchengines.com\", \"41searchengines.com\", \"42searchengines.com\",\n                \"43searchengines.com\", \"44searchengines.com\", \"45searchengines.com\",\n                \"46searchengines.com\", \"47searchengines.com\", \"48searchengines.com\",\n                \"49searchengines.com\", \"4loot.com\", \"50searchengines.com\", \"51searchengines.com\",\n                \"52searchengines.com\", \"53searchengines.com\", \"54searchengines.com\", \"55searchengines.com\",\n                \"56searchengines.com\", \"57searchengines.com\", \"58searchengines.com\", \"59searchengines.com\",\n                \"60searchengines.com\", \"61searchengines.com\", \"62searchengines.com\", \"63searchengines.com\",\n                \"64searchengines.com\", \"65searchengines.com\", \"66searchengines.com\", \"67searchengines.com\",\n                \"68searchengines.com\", \"69searchengines.com\", \"70searchengines.com\", \"71searchengines.com\",\n                \"72searchengines.com\", \"73searchengines.com\", \"74searchengines.com\", \"75searchengines.com\",\n                \"76searchengines.com\", \"77searchengines.com\", \"78searchengines.com\", \"79searchengines.com\",\n                \"80searchengines.com\", \"81searchengines.com\", \"82searchengines.com\", \"83searchengines.com\",\n                \"84searchengines.com\", \"85searchengines.com\", \"86searchengines.com\", \"87searchengines.com\",\n                \"88searchengines.com\", \"89searchengines.com\", \"90searchengines.com\", \"91searchengines.com\",\n                \"92searchengines.com\", \"93searchengines.com\", \"94searchengines.com\", \"95searchengines.com\",\n                \"96searchengines.com\", \"97searchengines.com\", \"98searchengines.com\", \"99searchengines.com\",\n                \"alhea.com\", \"alot.com\", \"aol.com\", \"aolsearch.com\", \"ask.com\", \"avg.com\", \"b1.org\", \"babylon.com\",\n                \"baidu.cn\", \"baidu.co.th\", \"baidu.com\", \"bing.com\", \"blackle.com\", \"blekko.com\", \"blindsearch.fejus.com\",\n                \"bt.com\", \"centurylink.net\", \"charter.net\", \"clearch.org\", \"cnn.com\", \"daum.net\", \"devilfinder.com\",\n                \"dmoz.org\", \"dogpile.com\", \"duckduckgo.com\", \"ekolay.net\", \"entireweb.com\", \"excite.com\", \"fast.ng\",\n                \"findgala.com\", \"findsmarter.com\", \"findsmarter.ru\", \"g.cn\", \"genieo.com\", \"go.speedbit.com\",\n                \"goofram.com\", \"google.ac\", \"google.ad\", \"google.ae\", \"google.al\", \"google.am\", \"google.as\",\n                \"google.at\", \"google.az\", \"google.ba\", \"google.be\", \"google.bf\", \"google.bg\", \"google.bi\",\n                \"google.bj\", \"google.bs\", \"google.bt\", \"google.by\", \"google.ca\", \"google.cat\", \"google.cc\",\n                \"google.cd\", \"google.cf\", \"google.cg\", \"google.ch\", \"google.ci\", \"google.cl\", \"google.cm\",\n                \"google.cn\", \"google.co.ao\", \"google.co.bw\", \"google.co.ck\", \"google.co.cr\", \"google.co.id\",\n                \"google.co.il\", \"google.co.in\", \"google.co.jp\", \"google.co.ke\", \"google.co.kr\", \"google.co.ls\",\n                \"google.co.ma\", \"google.co.mz\", \"google.co.nz\", \"google.co.th\", \"google.co.tz\", \"google.co.ug\",\n                \"google.co.uk\", \"google.co.uz\", \"google.co.ve\", \"google.co.vi\", \"google.co.za\", \"google.co.zm\",\n                \"google.co.zw\", \"google.com\", \"google.com.af\", \"google.com.ag\", \"google.com.ai\", \"google.com.ar\",\n                \"google.com.au\", \"google.com.bd\", \"google.com.bh\", \"google.com.bn\", \"google.com.bo\",\n                \"google.com.br\", \"google.com.by\", \"google.com.bz\", \"google.com.co\", \"google.com.cu\", \"google.com.cy\",\n                \"google.com.do\", \"google.com.ec\", \"google.com.eg\", \"google.com.et\", \"google.com.fj\", \"google.com.gh\",\n                \"google.com.gi\", \"google.com.gt\", \"google.com.hk\", \"google.com.jm\", \"google.com.kh\", \"google.com.kw\",\n                \"google.com.lb\", \"google.com.lc\", \"google.com.ly\", \"google.com.mm\", \"google.com.mt\", \"google.com.mx\",\n                \"google.com.my\", \"google.com.na\", \"google.com.nf\", \"google.com.ng\", \"google.com.ni\", \"google.com.np\",\n                \"google.com.om\", \"google.com.pa\", \"google.com.pe\", \"google.com.pg\", \"google.com.ph\", \"google.com.pk\",\n                \"google.com.pr\", \"google.com.py\", \"google.com.qa\", \"google.com.sa\", \"google.com.sb\", \"google.com.sg\",\n                \"google.com.sl\", \"google.com.sv\", \"google.com.tj\", \"google.com.tn\", \"google.com.tr\", \"google.com.tw\",\n                \"google.com.ua\", \"google.com.uy\", \"google.com.vc\", \"google.com.vn\", \"google.cv\", \"google.cz\", \"google.de\",\n                \"google.dj\", \"google.dk\", \"google.dm\", \"google.dz\", \"google.ee\", \"google.es\", \"google.fi\", \"google.fm\",\n                \"google.fr\", \"google.ga\", \"google.gd\", \"google.ge\", \"google.gf\", \"google.gg\", \"google.gl\", \"google.gm\",\n                \"google.gp\", \"google.gr\", \"google.gy\", \"google.hn\", \"google.hr\", \"google.ht\", \"google.hu\", \"google.ie\",\n                \"google.im\", \"google.io\", \"google.iq\", \"google.is\", \"google.it\", \"google.it.ao\", \"google.je\", \"google.jo\",\n                \"google.kg\", \"google.ki\", \"google.kz\", \"google.la\", \"google.li\", \"google.lk\", \"google.lt\", \"google.lu\",\n                \"google.lv\", \"google.md\", \"google.me\", \"google.mg\", \"google.mk\", \"google.ml\", \"google.mn\", \"google.ms\",\n                \"google.mu\", \"google.mv\", \"google.mw\", \"google.ne\", \"google.nl\", \"google.no\", \"google.nr\", \"google.nu\",\n                \"google.pl\", \"google.pn\", \"google.ps\", \"google.pt\", \"google.ro\", \"google.rs\", \"google.ru\", \"google.rw\",\n                \"google.sc\", \"google.se\", \"google.sh\", \"google.si\", \"google.sk\", \"google.sm\", \"google.sn\", \"google.so\",\n                \"google.st\", \"google.td\", \"google.tg\", \"google.tk\", \"google.tl\", \"google.tm\", \"google.tn\", \"google.to\",\n                \"google.tt\", \"google.us\", \"google.vg\", \"google.vu\", \"google.ws\", \"heapr.com\",\n                \"hotbot.com\", \"iboogie.com\", \"inbox.com\", \"incredibar.com\", \"info.com\", \"infospace.com\",\n                \"isearch-123.com\", \"iseek.com\", \"izito.com\", \"k9safesearch.com\", \"kidrex.org\", \"kvasir.no\",\n                \"lycos.com\", \"mamma.com\", \"monstercrawler.com\", \"myallsearch.com\", \"mynet.com\",\n                \"mysearchresults.com\", \"myway.com\", \"mywebsearch.com\", \"naver.com\", \"out1000.com\", \"pageset.com\",\n                \"portal.tds.net\", \"qone8.com\", \"qrobe.it\", \"rambler.ru\", \"redz.com\", \"safehomepage.com\", \"safesearch.net\",\n                \"search-results.com\", \"search.centurylink.com\", \"search.com\", \"search.comcast.net\", \"search.earthlink.net\",\n                \"search.frontier.com\", \"search.iminent.com\", \"search.incredimail.com\", \"search.juno.com\", \"search.mail.com\",\n                \"search.orange.co.uk\", \"search.pch.com\", \"search.peoplepc.com\", \"search.quebles.com\", \"search.snap.do\",\n                \"search.snapdo.com\", \"search.sweetim.com\", \"search.thunderstone.com\", \"search.toolbars.alexa.com\",\n                \"search.twcc.com\", \"search.walla.co.il\", \"search.zonealarm.com\", \"searchalot.com\", \"searchassist.verizon.com\",\n                \"searchfunmoods.com\", \"searchlock.com\", \"searchresults.verizon.com\", \"searchtool.com\", \"seznam.cz\",\n                \"similarsitesearch.com\", \"so.com\", \"sogou.com\", \"spacetime3d.com\", \"spezify.com\", \"start.funmoods.com\",\n                \"start.iminent.com\", \"start.toshiba.com\", \"startgoogle.startpagina.nl\", \"startpage.com\", \"startsiden.no\",\n                \"surfcanyon.com\", \"swagbucks.com\", \"terra.com\", \"thenet1.com\", \"torcho.com\", \"tuvaro.com\", \"ustart.org\",\n                \"virgilio.it\", \"voila.fr\", \"web.canoe.ca\", \"webcache.googleusercontent.com\", \"webcrawler.com\",\n                \"webhelper.centurylink.com\", \"webssearches.com\", \"windstream.net\", \"wolframalpha.com\", \"wow.com\",\n                \"wowway.net\", \"wp.pl\", \"www1.dlinksearch.com\", \"yabigo.com\", \"yahoo.co.jp\", \"yahoo.com\", \"yaimo.com\",\n                \"yam.com\", \"yandex.by\", \"yandex.com\", \"yandex.com.tr\", \"yandex.kz\", \"yandex.ru\", \"yandex.ua\",\n                \"yippy.com\", \"zapmeta.com\"\n            ];\n\n            var cleanMedium = {\"affiliate\": \"affiliation\",\"affiliation\": \"affiliation\",\"cpm\": \"display\",\"e-mail\": \"email\",\"mail\": \"email\",\"loyalty email\": \"loyaltyemail\",\"local channel\": \"localchannel\",\"mobile push\": \"mobilepush\",\"mobile\": \"mobilepush\",\"organic search\": \"organicsearch\",\"paid search\": \"paidsearch\",\"cpc\": \"paidsearch\",\"sea\": \"paidsearch\",\"programmatic audio\": \"programmaticaudio\",\"social advertising\": \"socialadvertising\",\"socialad\": \"socialadvertising\",\"socialcampaign\": \"socialadvertising\",\"social assistance\": \"socialassistance\",\"socialast\": \"socialassistance\",\"social organic\": \"socialorganic\",\"socialorg\": \"socialorganic\",\"social servicing\": \"socialservicing\",\"socialserv\": \"socialservicing\",\"misc\": \"other\",\"msc\": \"other\"};\n\n            var cleanMediumContains = {\"checkinreminder\": \"socialservicing\"};\n            var paramsTrafficsources = {};\n            paramsTrafficsources.trafficSource = \"direct\";\n\t\t\t\n            if (!!sessionStorage.getItem(\"gclid\")) {sessionStorage.setItem(\"gclid\", \"\");paramsTrafficsources.trafficSource = \"paidsearch\";tracking_used = false;}\n            else if(!!referrer) {\n                if (searchengines.includes(referrer)) paramsTrafficsources.trafficSource = \"searchengineorganic\";\n                else paramsTrafficsources.trafficSource = \"otherreferer\";\n            }\n\n            if (!!medium) {\n                paramsTrafficsources.trafficSource = medium.replace(/%20/g, \" \");\n\n\t\t\t\t//Standardizing medium notations by using cleanMedium mapping dictionary\n                if ((paramsTrafficsources.trafficSource.toLowerCase() in cleanMedium))\n                    paramsTrafficsources.trafficSource = cleanMedium[paramsTrafficsources.trafficSource.toLowerCase()].toLowerCase();\n                else\n                    Object.keys(cleanMediumContains).forEach(function(key) {\n                        if (medium.toLowerCase().includes(key)) paramsTrafficsources.trafficSource = cleanMediumContains[key];\n                    });\n\t\t\t\t\n            }\n\n            paramsTrafficsources.trafficSource = paramsTrafficsources.trafficSource.toLowerCase();\n\t\t\t\n\n\t\t\t//No sources tracking on below list\n            var noStoreCategoryList = [\"direct\",\"organicsearch\",\"other\",\"otherreferer\",\"referral\",\"searchengineorganic\",\"socialassistance\",\"socialservicing\"];\n\n           function StoringSources(paramsTrafficsources, tracking_used) {\n                if (sessionStorage.getItem('trafficSourceStored') !== '1' || !tracking_used) {\n                    if ((paramsTrafficsources.trafficSource == \"direct\" &&\n                            _st.segmenting.data['135_701'].last_trafficsource != undefined &&\n                            _st.segmenting.data['135_701'].last_trafficsource != \"direct\") || paramsTrafficsources.trafficSource != \"direct\") {\n\t\t\t\t\t\t\n\t\t\t\t\t\t//retrieves trafficeSources scores from audience\n                        paramsTrafficsources = scoringsmodel(paramsTrafficsources,_st.segmenting.data['135_701']);\n\n                        //added last_utmterm for affiliation clickref (Partnerize connector attribute)\n                        if (_st.data.getProperty('z_tracking') !== '' && typeof _st.data.getProperty('z_tracking').utm_term !== 'undefined') {\n                            paramsTrafficsources.last_utmterm = _st.data.getProperty('z_tracking').utm_term;\n                            paramsTrafficsources.last_clickref = _st.data.getProperty('z_tracking').utm_term.split('_')[2];\n                        } else if (_st.util.getUrlParam('utm_term') !== '') {\n                            paramsTrafficsources.last_utmterm = _st.util.getUrlParam('utm_term');\n                            paramsTrafficsources.last_clickref = _st.util.getUrlParam('utm_term').split('_')[2];\n                        }\n\n\t\t\t\t\t\t//A special mapping for the Partnerize connector.\n\t\t\t\t\t\tif(medium === 'affiliation'){\n\t\t\t\t\t\t\t\tvar key = 2006;\n\t\t\t\t\t\t\t\tvar value = paramsTrafficsources.last_utmterm.split('_')[2] +'_' + new Date().valueOf();\n\t\t\t\t\t\t\t\tif(typeof value !== 'undefined' && value !== '' && value !== 'undefined' && !!value) _st.tracking.storeMapping(key,value,0,1);\n\t\t\t\t\t\t\t\telse throw 'Storemapping value contains no correct value : ' + value;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t//Stores data for next pageview. Ignores sources from noStoreCategoryList.\n                        if (noStoreCategoryList.indexOf(paramsTrafficsources.last_trafficsource) == -1 && !!sessionStorage.getItem('paramsTrafficsources_Stored' == '') && !!sessionStorage.getItem('TrafficSourceStoring') == '') {\n                            sessionStorage.setItem('paramsTrafficsources_Stored', JSON.stringify(paramsTrafficsources));\n                        } else {\n                            if (noStoreCategoryList.indexOf(paramsTrafficsources.last_trafficsource) == -1) {\n                                _st.tracking.sendEngagement('trafficsources', paramsTrafficsources);\n                                _st.tracking.sendExternalFact('Scoringmodel', 7776000, paramsTrafficsources, true);\n                            }\n                            sessionStorage.setItem('paramsTrafficsources_Stored', '');\n                        }\n                        sessionStorage.setItem('trafficSourceStored', '1');\n                    }\n                }\n\t\t}\n \t\t_st.inject.script('https://tdn.r42tag.com/data/segment/135/' + _st.tracking.getUserIdentifier() + '/135_701',  {\n\t\t\t\t\tcallback: function(e) {\n                        StoringSources(paramsTrafficsources, tracking_used);\n\t\t\t\t\t}\n\t\t\t});\n        }\n    } catch (e) {_st.debug.log('trafficsources catch: ' + JSON.stringify(e));}\n})();","exec":"onready","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":1340,"version":4,"content":"_st.tracking.syncPartner(7,{'process_consent':'T'});","group":3},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":385,"version":5,"content":"(function(){\n    var r42Cookie = _st.tracking.getUserIdentifier();\n    var trackUrl = _st.settings.trackUrl;\n    var clientId = '80d24f51-e37d-4439-b9a6-076a5bff3179';\n    var siteId = '96e2bde0-3bd1-40e7-b847-5502707f1a77';\n    \n\tvar uData = _st.data.getUserData();\n\tvar now = new Date().getTime();\n\tuData.p = uData.p || {};\n\t\n\tif(!uData.p[4242] || uData.p[4242] < (now - 3600000)) {\n    \tvar img = new Image();\n    \timg.src='//' + trackUrl + '/collect/' + clientId + '/sync/' + siteId + '/' + r42Cookie;\n\t\tuData.p[4242] = now;\n\t\t_st.data.saveUserData();\n\t}\n})();","exec":"onload","group":3},{"markerCondition":"[]","selector":"head","id":1187,"version":15,"content":"(function() {\n\n\tvar etId = '';   \n\tvar cookieTtl = 395; // defines the time to live for the \"ETR\" cookie\n\tvar tracking = _st.data.getProperty('z_tracking'); // extract z_tracking from datalayer (for BW pages)\n\n\tif(tracking !== undefined && tracking[\"WT.i_vid\"] !== undefined ){\n        etId = tracking[\"WT.i_vid\"];\t\t\t\t// extract Exact Target id from datalayer\n    }\n    else{\n     \tetId = _st.util.getUrlParam('WT.i_vid');\t// extract Exact Target id from URL\n      }\n\n    var etMatch = /^[0-9]+$/.test(etId);   // check whether the URL-based Exact Target id is an integer\n\tvar etCookie = _st.util.getCookie(\"ETR\"); // gets (salted) Exact Target id from a \"ETR\" cookie\n\n\tfunction randomString(length, chars) {  // function that generates a random string to salt the Exact Target id in the \"ETR\" cookie  \n\t\tvar result = '';\n\t\tfor (var i = length; i > 0; --i) result += chars[Math.round(Math.random() * (chars.length - 1))];\n\t\treturn result;\n\t}\n\n\tfunction defineETIdentity(){  // function that triggers storeMapping for ET (with safe merge) with the URL-based Exact Target id and stores this value (with salt) in the \"ETR\" cookie \n\t\t_st.tracking.storeMapping(1009, etId, 2, 1);\n\t\t_st.util.setCookie(\"ETR\", randomString(10, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ')+etId+randomString(10, '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), cookieTtl);\n\t}\n\n\tif(typeof etId !== 'undefined' && etId !== '' && etId !== 'undefined' && !!etId && etMatch === true) { // if the URL-based Exact Target id is valid\n\t\tif (typeof etCookie !== 'undefined' && etCookie !== '' && !!etCookie){  // if the cookie-based Exact Target id exists and is not empty\n\t\t\tif (etCookie.substr(10,etCookie.length-20) !== etId){  // checks if the cookie-based Exact Target id is different from the URL-based Exact Target id\n\t\t\t\t_st.tracking.resetUserIdentifier();\n\t\t        defineETIdentity();\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tdefineETIdentity();\n\t\t}\n\t} \n\telse{\n\t\t\n\t}\n})();\n\n/*\n(function() {\n\tvar etId = _st.util.getUrlParam('WT.i_vid');\n\t\n\t// Empty strings disallowed\n\tif(etId === \"\") throw \"Found empty ExactTarget id, not synced\";\n\t\n\t// Only accept numbers\n\tif(etId.match(/^[0-9]+$/) === null) throw \"Found non-numeric ExactTarget id, not synced\";\n\t\n\t_st.tracking.storeMapping(1009, etId,0);\n})();\n*/","exec":"onload"},{"markerCondition":"[]","loadDefault":false,"groupReverse":false,"selector":"head","id":802,"version":49,"content":"//Prevent reloading of the script for BW.\nif(typeof(adv_lib) === \"undefined\" && (_st.data.getProperty('z_converged'))){\n\t(function(){ \n\tvar a=document.getElementsByTagName('script')[0], b=document.createElement('script'); b.async=!0;b.src='//cdn.dimml.io/dimml.js'; a.parentNode.insertBefore(b,a);\n\t// DCF lib v1.7\n\t// DCF lib v1.7\n\twindow.adv_global = window.adv_global || {};\n\twindow.adv_event = window.adv_event || [];\n\twindow.adv_lib = window.adv_lib || {};\n\t(function(g, b, e) {\n\t\tvar d = location.hostname.split(\".\"),\n\t\t\tf = d[d.length - 1];\n\t\tif (1 < d.length) {\n\t\t\tvar h = d[d.length - 2],\n\t\t\t\tf = h + \".\" + f;\n\t\t\tif (\"com\" === h || \"co\" === h) f = d[d.length - 3] + \".\" + f\n\t\t}\n\t\tg.page_top_domain = f;\n\t\te.setCookie = function(a, m, c, e, b, d) {\n\t\t\td = \"\";\n\t\t\tif (c) {\n\t\t\t\tc = Number(c);\n\t\t\t\tswitch (e) {\n\t\t\t\t\tcase \"y\":\n\t\t\t\t\t\tc *= 365;\n\t\t\t\t\tcase \"d\":\n\t\t\t\t\t\tc *= 1440;\n\t\t\t\t\tcase \"m\":\n\t\t\t\t\t\tc *= 60\n\t\t\t\t}\n\t\t\t\tb = new Date;\n\t\t\t\tb.setSeconds(b.getSeconds() + c);\n\t\t\t\td = \";expires=\" + b.toUTCString()\n\t\t\t}\n\t\t\tc = \"\";\n\t\t\t// Workaround to solve expected an assignment or function call instead saw an expression. Adding a assignment variable. (Error due to ES5)\n\t\t\tvar test1 = (0 < g.page_top_domain.indexOf(\".\") && (c = \";domain=.\" + g.page_top_domain));\n\t\t\tdocument.cookie = a + \"=\" + encodeURIComponent(m) + d + \";path=/\" + c\n\t\t};\n\t\te.delCookie =\n\t\t\tfunction(a) {\n\t\t\t\te.setCookie(a, \"\", -1)\n\t\t\t};\n\t\te.getCookie = function(a, b) {\n\t\t\treturn (b = document.cookie.match(\"(^|;)\\\\s*\" + a + \"\\\\s*=\\\\s*([^;]+)\")) ? decodeURIComponent(b.pop()) : null\n\t\t};\n\t\tb.store = function(a) {\n\t\t\tif (e.isArray(a)) {\n\t\t\t\tvar b = e.getCookie(\"adv_ev\");\n\t\t\t\ttry {\n\t\t\t\t\tvar c = JSON.parse(b) || [];\n\t\t\t\t\tc.push(a);\n\t\t\t\t\te.setCookie(\"adv_ev\", JSON.stringify(c))\n\t\t\t\t} catch (l) {}\n\t\t\t}\n\t\t};\n\t\te.isArray = function(a) {\n\t\t\treturn a ? \"[object Array]\" === Object.prototype.toString.call(a) : !1\n\t\t};\n\t\te.copy = function(a) {\n\t\t\tvar b = {};\n\t\t\ttry {\n\t\t\t\tb = JSON.parse(JSON.stringify(a))\n\t\t\t} catch (c) {}\n\t\t\treturn b\n\t\t};\n\t\ttry {\n\t\t\tvar k = JSON.parse(e.getCookie(\"adv_ev\"));\n\t\t\tif (e.isArray(k)) {\n\t\t\t\tfor (; 0 < k.length;) b.push(k.shift());\n\t\t\t\te.delCookie(\"adv_ev\")\n\t\t\t}\n\t\t} catch (a) {}\n\t\tb.listener = [];\n\t\tb.history = [];\n\t\tb.on = function(a, d, c) {\n\t\t\tif (\"string\" == typeof a && \"function\" == typeof d) {\n\t\t\t\tif (this.listener.push([a, d]), c)\n\t\t\t\t\tfor (c = 0; c < this.history.length; c++)\n\t\t\t\t\t\tif (\"all\" == a || a == this.history[c][0]) try {\n\t\t\t\t\t\t\td(this.history[c][0], e.copy(this.history[c][1]))\n\t\t\t\t\t\t} catch (l) {\n\t\t\t\t\t\t\t// Workaround to solve expected an assignment or function call instead saw an expression. Adding a assignment variable.(Error due to ES5)\n\t\t\t\t\t\t\tvar test2 = \"dcf error\" != this.history[c][0] && b.push([\"dcf error\", {\n\t\t\t\t\t\t\t\ttype: \"listener\",\n\t\t\t\t\t\t\t\tevent: this.history[c][0],\n\t\t\t\t\t\t\t\tid: this.listener.length - 1,\n\t\t\t\t\t\t\t\terror: l.toString()\n\t\t\t\t\t\t\t}]);\n\t\t\t\t\t\t}\n\t\t\t} else b.push([\"dcf error\",\n\t\t\t\t{\n\t\t\t\t\ttype: \"on\",\n\t\t\t\t\terror: \"invalid syntax\",\n\t\t\t\t\thelp: \".on(STR,FUNC,BOOL)\"\n\t\t\t\t}\n\t\t\t])\n\t\t};\n\t\tfor (b.push = function(a) {\n\t\t\t\tif (!e.isArray(a) || \"string\" != typeof a[0] || \"undefined\" != typeof a[1] && \"object\" != typeof a[1]) b.push([\"dcf error\", {\n\t\t\t\t\ttype: \"push\",\n\t\t\t\t\terror: \"invalid syntax\",\n\t\t\t\t\thelp: \".push([STR,OBJ])\"\n\t\t\t\t}]);\n\t\t\t\telse {\n\t\t\t\t\tvar d = a[0],\n\t\t\t\t\t\tc = a[1] || {};\n\t\t\t\t\tthis.history.push(e.copy(a));\n\t\t\t\t\ta = 0;\n\t\t\t\t\tfor (var f = this.listener.length; a < f; a++)\n\t\t\t\t\t\tif (d == this.listener[a][0] || \"all\" == this.listener[a][0]) try {\n\t\t\t\t\t\t\tthis.listener[a][1](d, e.copy(c))\n\t\t\t\t\t\t} catch (n) {\n\t\t\t\t\t\t\t// Workaround to solve expected an assignment or function call instead saw an expression. Adding a assignment variable.(Error due to ES5)\n\t\t\t\t\t\t\tvar test3 = \"dcf error\" != d && b.push([\"dcf error\", {\n\t\t\t\t\t\t\t\ttype: \"listener\",\n\t\t\t\t\t\t\t\tevent: d,\n\t\t\t\t\t\t\t\tid: a,\n\t\t\t\t\t\t\t\terror: n.toString()\n\t\t\t\t\t\t\t}]);\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}; 0 < b.length;) b.push(b.shift())\n\t})(adv_global, adv_event, adv_lib);\n})();\n}\n","group":2}],"experiments":[],"dataCollectionRate":500});